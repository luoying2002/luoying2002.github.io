
  <!DOCTYPE html>
  <html lang="zh-CN"  >
  <head>
  <meta charset="utf-8">
  

  

  

  <script>window.REIMU_CONFIG = {};window.REIMU_CONFIG.icon_font = '4552607_tq6stt6tcg';window.REIMU_CONFIG.clipboard_tips = {"success":"复制成功(*^▽^*)","fail":"复制失败 (ﾟ⊿ﾟ)ﾂ","copyright":{"enable":false,"count":50,"content":"本文版权：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处！"}};window.REIMU_CONFIG.outdate = {"enable":true,"daysAgo":730,"message":"本文最后更新于 {time}，请注意文中内容可能已经发生变化。"};window.REIMU_CONFIG.code_block = {"expand":30};</script>
  
  <title>
    scGPT：利用生成式AI构建单细胞多组学基础模型 |
    
    小小白的笔记屋
  </title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin><link rel="preload" as="style" href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7CNoto%20Serif%20SC:400,400italic,700,700italic%7CJetBrains%20Mono:400,400italic,700,700italic&display=swap"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7CNoto%20Serif%20SC:400,400italic,700,700italic%7CJetBrains%20Mono:400,400italic,700,700italic&display=swap" media="print" onload="this.media&#x3D;&#39;all&#39;">
  
    <link rel="preload" href="//at.alicdn.com/t/c/font_4552607_tq6stt6tcg.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  
  
    
<link rel="stylesheet" href="/css/loader.css">

  
  
    <meta name="description" content="文章链接  Cui, H., Wang, C., Maan, H., Pang, K., Luo, F., Duan, N., &amp; Wang, B. (2024). scGPT: toward building a foundation model for single-cell multi-omics using generative AI. Nature Methods, 21,14">
<meta property="og:type" content="article">
<meta property="og:title" content="scGPT：利用生成式AI构建单细胞多组学基础模型">
<meta property="og:url" content="https://luoying.netlify.app/2024/12/16/vazgz0k2/index.html">
<meta property="og:site_name" content="小小白的笔记屋">
<meta property="og:description" content="文章链接  Cui, H., Wang, C., Maan, H., Pang, K., Luo, F., Duan, N., &amp; Wang, B. (2024). scGPT: toward building a foundation model for single-cell multi-omics using generative AI. Nature Methods, 21,14">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://luoying.netlify.app/images/assets//image-20241217213225509.png">
<meta property="og:image" content="https://luoying.netlify.app/images/assets//image-20241217213253221.png">
<meta property="og:image" content="https://luoying.netlify.app/images/assets//image-20241217213352057.png">
<meta property="og:image" content="https://luoying.netlify.app/images/assets//image-20241217213453682.png">
<meta property="og:image" content="https://luoying.netlify.app/images/assets//image-20241217213552997.png">
<meta property="og:image" content="https://luoying.netlify.app/images/assets//image-20241217213726866.png">
<meta property="og:image" content="https://luoying.netlify.app/images/banner.webp">
<meta property="article:published_time" content="2024-12-16T15:38:25.000Z">
<meta property="article:modified_time" content="2025-10-01T10:48:10.474Z">
<meta property="article:author" content="LuoYing">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://luoying.netlify.app/images/assets//image-20241217213225509.png">
  
  
  
    <link rel="shortcut icon" href="/images/favicon.ico">
  
  
<link rel="stylesheet" href="/css/style.css">

  <link rel="preload" href="https://npm.webcache.cn/photoswipe@5.4.4/dist/photoswipe.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
  
    
      
        
<link rel="stylesheet" href="https://npm.webcache.cn/katex@0.16.11/dist/katex.min.css">

      
    
  
  
  
  
    
<script src="https://npm.webcache.cn/pace-js@1.2.4/pace.min.js" integrity="sha384-k6YtvFUEIuEFBdrLKJ3YAUbBki333tj1CSUisai5Cswsg9wcLNaPzsTHDswp4Az8" crossorigin="anonymous"></script>

  
  
    
<link rel="stylesheet" href="https://npm.webcache.cn/@reimujs/aos@0.1.0/dist/aos.css">

  
<meta name="generator" content="Hexo 7.3.0"></head>

  <body>
    
  <div id='loader'>
    <div class="loading-left-bg loading-bg"></div>
    <div class="loading-right-bg loading-bg"></div>
    <div class="spinner-box">
      <div class="loading-taichi">
        
          <svg width="150" height="150" viewBox="0 0 1024 1024" class="icon" version="1.1" xmlns="https://www.w3.org/2000/svg" shape-rendering="geometricPrecision">
            <path d="M303.5 432A80 80 0 0 1 291.5 592A80 80 0 0 1 303.5 432z" fill="var(--red-1, #ff5252)" />
            <path d="M512 65A447 447 0 0 1 512 959L512 929A417 417 0 0 0 512 95A417 417 0 0 0 512 929L512 959A447 447 0 0 1 512 65z 
           M512 95A417 417 0 0 1 929 512A208.5 208.5 0 0 1 720.5 720.5L720.5 592A80 80 0 0 0 720.5 432A80 80 0 0 0 720.5 592L720.5 720.5A208.5 208.5 0 0 1 512 512A208.5 208.5 0 0 0 303.5 303.5A208.5 208.5 0 0 0 95 512A417 417 0 0 1 512 95z" fill="var(--red-1, #ff5252)" />
          </svg>
        
      </div>
      <div class="loading-word">小小白祈祷中...</div>
    </div>
  </div>
  </div>
  <script>
    var time = null;
    var startLoading = () => {
      time = Date.now();
      document.getElementById('loader').classList.remove("loading");
    }
    var endLoading = () => {
      if (!time) {
        document.body.style.overflow = 'auto';
        document.getElementById('loader').classList.add("loading");
      } else {
        if (Date.now() - time > 500) {
          time = null;
          document.body.style.overflow = 'auto';
          document.getElementById('loader').classList.add("loading");
        } else {
          setTimeout(endLoading, 500 - (Date.now() - time));
          time = null;
        }
      }
    }
    window.addEventListener('DOMContentLoaded', endLoading);
    document.getElementById('loader').addEventListener('click', endLoading);
  </script>

<div id="copy-tooltip" style="pointer-events: none; opacity: 0; transition: all 0.2s ease; position: fixed;top: 50%;left: 50%;z-index: 999;transform: translate(-50%, -50%);color: white;background: rgba(0, 0, 0, 0.5);padding: 10px 15px;border-radius: 10px;">
</div>


    <div id="container">
      <div id="wrap">
        <div id="header-nav">
  <nav id="main-nav">
    
      
        <span class="main-nav-link-wrap">
          <div class="main-nav-icon icon rotate">
            &#xe62b;
          </div>
          <a class="main-nav-link" href="/">首页</a>
        </span>
      
        <span class="main-nav-link-wrap">
          <div class="main-nav-icon icon rotate">
            &#xe62b;
          </div>
          <a class="main-nav-link" href="/archives">归档</a>
        </span>
      
        <span class="main-nav-link-wrap">
          <div class="main-nav-icon icon rotate">
            &#xe62b;
          </div>
          <a class="main-nav-link" href="/about">关于</a>
        </span>
      
        <span class="main-nav-link-wrap">
          <div class="main-nav-icon icon rotate">
            &#xe62b;
          </div>
          <a class="main-nav-link" href="/friend">友链</a>
        </span>
      
    
    <a id="main-nav-toggle" class="nav-icon"></a>
  </nav>
  <nav id="sub-nav">
    
    
    
      <a id="nav-search-btn" class="nav-icon popup-trigger" title="搜索"></a>
    
  </nav>
</div>
<header id="header">
  
    
      <img fetchpriority="high" src="/images/banner.webp" alt="scGPT：利用生成式AI构建单细胞多组学基础模型">
    
  
  <div id="header-outer">
    <div id="header-title">
      
        
        
          <a href="/" id="logo">
            <h1 data-aos="slide-up">scGPT：利用生成式AI构建单细胞多组学基础模型</h1>
          </a>
        
      
      
        
        <h2 id="subtitle-wrap" data-aos="slide-down">
          
        </h2>
      
    </div>
  </div>
</header>

        <div id="content">
          
            <aside id="sidebar">
  <div class="sidebar-wrapper wrap-sticky">
    <div class="sidebar-wrap" data-aos="fade-up">
      
        <div class="sidebar-toc-sidebar"><div class="sidebar-toc">
  <h3 class="toc-title">文章目录</h3>
  <div class="sidebar-toc-wrapper toc-div-class" >
      
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%96%87%E7%AB%A0%E9%93%BE%E6%8E%A5"><span class="toc-number">1.</span> <span class="toc-text"> 文章链接</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-number">2.</span> <span class="toc-text"> 简介</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%91%98%E8%A6%81"><span class="toc-number">3.</span> <span class="toc-text"> 摘要</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%9B%E6%96%B0%E7%82%B9"><span class="toc-number">4.</span> <span class="toc-text"> 创新点</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%BB%E8%A6%81%E5%86%85%E5%AE%B9"><span class="toc-number">5.</span> <span class="toc-text"> 主要内容</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%BB%E5%89%8D%E9%A1%BB%E7%9F%A5"><span class="toc-number">5.1.</span> <span class="toc-text"> 读前须知</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%95%E8%A8%80"><span class="toc-number">5.2.</span> <span class="toc-text"> 引言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E6%9E%9C"><span class="toc-number">5.3.</span> <span class="toc-text"> 结果</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E7%BB%86%E8%83%9E-transformer-%E5%9F%BA%E7%A1%80%E6%A8%A1%E5%9E%8B%E6%A6%82%E8%BF%B0"><span class="toc-number">5.3.1.</span> <span class="toc-text"> 单细胞 transformer 基础模型概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#scgpt%E6%8F%90%E9%AB%98%E7%BB%86%E8%83%9E%E7%B1%BB%E5%9E%8B%E6%B3%A8%E9%87%8A%E7%9A%84%E7%B2%BE%E7%A1%AE%E5%BA%A6"><span class="toc-number">5.3.2.</span> <span class="toc-text"> scGPT提高细胞类型注释的精确度</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#scgpt%E9%A2%84%E6%B5%8B%E6%9C%AA%E8%A7%81%E8%BF%87%E7%9A%84%E5%9F%BA%E5%9B%A0%E6%89%B0%E5%8A%A8%E5%93%8D%E5%BA%94"><span class="toc-number">5.3.3.</span> <span class="toc-text"> scGPT预测未见过的基因扰动响应</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%AA%E8%A7%81%E8%BF%87%E7%9A%84%E5%9F%BA%E5%9B%A0%E6%89%B0%E5%8A%A8%E9%A2%84%E6%B5%8B"><span class="toc-number">5.3.3.1.</span> <span class="toc-text"> 未见过的基因扰动预测</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%93%E5%A4%96%E9%80%86%E5%90%91%E6%89%B0%E5%8A%A8%E9%A2%84%E6%B5%8B"><span class="toc-number">5.3.3.2.</span> <span class="toc-text"> 体外逆向扰动预测</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#scgpt%E5%AE%9E%E7%8E%B0%E5%A4%9A%E6%89%B9%E6%AC%A1%E5%92%8C%E5%A4%9A%E7%BB%84%E5%AD%A6%E6%95%B4%E5%90%88"><span class="toc-number">5.3.4.</span> <span class="toc-text"> scGPT实现多批次和多组学整合</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E6%89%B9%E6%AC%A1scrna-seq%E6%95%B4%E5%90%88"><span class="toc-number">5.3.4.1.</span> <span class="toc-text"> 多批次scRNA-seq整合</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E7%BB%86%E8%83%9E%E5%A4%9A%E7%BB%84%E5%AD%A6%E6%95%B4%E5%90%88"><span class="toc-number">5.3.4.2.</span> <span class="toc-text"> 单细胞多组学整合</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#scgpt%E6%8F%AD%E7%A4%BA%E7%89%B9%E5%AE%9A%E7%BB%86%E8%83%9E%E7%8A%B6%E6%80%81%E7%9A%84%E5%9F%BA%E5%9B%A0%E7%BD%91%E7%BB%9C"><span class="toc-number">5.3.5.</span> <span class="toc-text"> scGPT揭示特定细胞状态的基因网络</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%81%E7%A7%BB%E5%AD%A6%E4%B9%A0%E4%B8%AD%E7%9A%84%E8%A7%84%E6%A8%A1%E5%92%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E6%95%88%E5%BA%94"><span class="toc-number">5.3.6.</span> <span class="toc-text"> 迁移学习中的规模和上下文效应</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%A8%E8%AE%BA"><span class="toc-number">5.4.</span> <span class="toc-text"> 讨论</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%A8%E7%BA%BF%E5%86%85%E5%AE%B9"><span class="toc-number">5.5.</span> <span class="toc-text"> 在线内容</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B9%E6%B3%95"><span class="toc-number">5.6.</span> <span class="toc-text"> 方法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BE%93%E5%85%A5%E5%B5%8C%E5%85%A5"><span class="toc-number">5.6.1.</span> <span class="toc-text"> 输入嵌入</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E5%9B%A0%E6%A0%87%E8%AE%B0"><span class="toc-number">5.6.1.1.</span> <span class="toc-text"> 基因标记</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A1%A8%E8%BE%BE%E5%80%BC"><span class="toc-number">5.6.1.2.</span> <span class="toc-text"> 表达值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E6%A0%87%E8%AE%B0"><span class="toc-number">5.6.1.3.</span> <span class="toc-text"> 条件标记</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B5%8C%E5%85%A5%E5%B1%82"><span class="toc-number">5.6.1.4.</span> <span class="toc-text"> 嵌入层</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%86%E8%83%9E%E5%92%8C%E5%9F%BA%E5%9B%A0%E8%A1%A8%E8%BE%BE%E5%BB%BA%E6%A8%A1%E7%9A%84transformer"><span class="toc-number">5.6.2.</span> <span class="toc-text"> 细胞和基因表达建模的transformer</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#scgpt-transformer"><span class="toc-number">5.6.2.1.</span> <span class="toc-text"> scGPT transformer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%86%E8%83%9E%E8%A1%A8%E7%A4%BA"><span class="toc-number">5.6.2.2.</span> <span class="toc-text"> 细胞表示</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%B9%E6%AC%A1%E5%92%8C%E6%A8%A1%E6%80%81%E7%9A%84%E8%A1%A8%E7%A4%BA"><span class="toc-number">5.6.2.3.</span> <span class="toc-text"> 批次和模态的表示</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E5%BC%8F%E9%A2%84%E8%AE%AD%E7%BB%83"><span class="toc-number">5.6.3.</span> <span class="toc-text"> 生成式预训练</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E6%A8%A1%E5%9E%8B%E9%A2%84%E8%AE%AD%E7%BB%83"><span class="toc-number">5.6.3.1.</span> <span class="toc-text"> 基础模型预训练</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%A8%E4%BA%8E%E7%94%9F%E6%88%90%E5%BC%8F%E9%A2%84%E8%AE%AD%E7%BB%83%E7%9A%84%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%8E%A9%E7%A0%81"><span class="toc-number">5.6.3.2.</span> <span class="toc-text"> 用于生成式预训练的注意力掩码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%A6%E4%B9%A0%E7%9B%AE%E6%A0%87%E5%92%8C%E9%A2%84%E8%AE%AD%E7%BB%83"><span class="toc-number">5.6.3.3.</span> <span class="toc-text"> 学习目标和预训练</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%AE%E8%B0%83%E7%9B%AE%E6%A0%87"><span class="toc-number">5.6.4.</span> <span class="toc-text"> 微调目标</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E5%9B%A0%E8%A1%A8%E8%BE%BE%E9%A2%84%E6%B5%8B"><span class="toc-number">5.6.4.1.</span> <span class="toc-text"> 基因表达预测</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%A8%E4%BA%8E%E7%BB%86%E8%83%9E%E5%BB%BA%E6%A8%A1%E7%9A%84%E5%9F%BA%E5%9B%A0%E8%A1%A8%E8%BE%BE%E9%A2%84%E6%B5%8B"><span class="toc-number">5.6.4.2.</span> <span class="toc-text"> 用于细胞建模的基因表达预测</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%B9%E6%80%A7%E7%BB%86%E8%83%9E%E7%9B%B8%E4%BC%BC%E5%BA%A6"><span class="toc-number">5.6.4.3.</span> <span class="toc-text"> 弹性细胞相似度</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E5%8F%8D%E5%90%91%E5%8F%8D%E5%90%91%E4%BC%A0%E6%92%AD%E8%BF%9B%E8%A1%8C%E5%9F%9F%E9%80%82%E5%BA%94"><span class="toc-number">5.6.4.4.</span> <span class="toc-text"> 通过反向反向传播进行域适应</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%86%E8%83%9E%E7%B1%BB%E5%9E%8B%E5%88%86%E7%B1%BB"><span class="toc-number">5.6.4.5.</span> <span class="toc-text"> 细胞类型分类</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8B%E6%B8%B8%E4%BB%BB%E5%8A%A1%E7%9A%84%E5%BE%AE%E8%B0%83"><span class="toc-number">5.6.5.</span> <span class="toc-text"> 下游任务的微调</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%86%E8%83%9E%E7%B1%BB%E5%9E%8B%E6%B3%A8%E9%87%8A"><span class="toc-number">5.6.5.1.</span> <span class="toc-text"> 细胞类型注释</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E5%9B%A0%E6%89%B0%E5%8A%A8%E5%93%8D%E5%BA%94%E9%A2%84%E6%B5%8B"><span class="toc-number">5.6.5.2.</span> <span class="toc-text"> 基因扰动响应预测</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B4%E5%90%88%E5%A4%9A%E4%B8%AAscrna-seq%E6%95%B0%E6%8D%AE%E9%9B%86%E7%9A%84%E6%89%B9%E6%AC%A1%E6%A0%A1%E6%AD%A3"><span class="toc-number">5.6.5.3.</span> <span class="toc-text"> 整合多个scRNA-seq数据集的批次校正</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#scmultiomic%E6%95%B0%E6%8D%AE%E7%9A%84%E6%95%B4%E5%90%88%E8%A1%A8%E7%A4%BA%E5%AD%A6%E4%B9%A0"><span class="toc-number">5.6.5.4.</span> <span class="toc-text"> scMultiomic数据的整合表示学习</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E5%9B%A0%E8%B0%83%E6%8E%A7%E7%BD%91%E7%BB%9C%E6%8E%A8%E6%96%AD"><span class="toc-number">5.6.5.5.</span> <span class="toc-text"> 基因调控网络推断</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E9%9B%86"><span class="toc-number">5.6.6.</span> <span class="toc-text"> 数据集</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#cellxgene-scrna-seq%E9%9B%86%E5%90%88"><span class="toc-number">5.6.6.1.</span> <span class="toc-text"> CELLxGENE scRNA-seq集合</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E5%8F%91%E6%80%A7%E7%A1%AC%E5%8C%96%E7%97%87"><span class="toc-number">5.6.6.2.</span> <span class="toc-text"> 多发性硬化症</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%AA%A8%E9%AB%93%E6%A0%B7%E7%BB%86%E8%83%9E"><span class="toc-number">5.6.6.3.</span> <span class="toc-text"> 骨髓样细胞</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%BA%E8%83%B0%E8%85%BA"><span class="toc-number">5.6.6.4.</span> <span class="toc-text"> 人胰腺</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pbmc-10k"><span class="toc-number">5.6.6.5.</span> <span class="toc-text"> PBMC 10k</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%BA%E7%B1%BB%E5%85%8D%E7%96%AB"><span class="toc-number">5.6.6.6.</span> <span class="toc-text"> 人类免疫</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%91%E5%97%85%E7%9A%AE%E5%B1%82perirhinal-cortex"><span class="toc-number">5.6.6.7.</span> <span class="toc-text"> 近嗅皮层（Perirhinal cortex）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#covid-19"><span class="toc-number">5.6.6.8.</span> <span class="toc-text"> COVID-19</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#adamson"><span class="toc-number">5.6.6.9.</span> <span class="toc-text"> Adamson</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#norman"><span class="toc-number">5.6.6.10.</span> <span class="toc-text"> Norman</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#replogle"><span class="toc-number">5.6.6.11.</span> <span class="toc-text"> Replogle</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#multiome-pbmc"><span class="toc-number">5.6.6.12.</span> <span class="toc-text"> Multiome PBMC</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#bmmc"><span class="toc-number">5.6.6.13.</span> <span class="toc-text"> BMMC</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#asap-pbmc"><span class="toc-number">5.6.6.14.</span> <span class="toc-text"> ASAP PBMC</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#lung-kim"><span class="toc-number">5.6.6.15.</span> <span class="toc-text"> Lung-Kim</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E5%87%86%E6%B5%8B%E8%AF%95%E5%AE%9E%E9%AA%8C%E8%AE%BE%E7%BD%AE"><span class="toc-number">5.6.7.</span> <span class="toc-text"> 基准测试实验设置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E7%BB%86%E8%83%9Erna%E6%B5%8B%E5%BA%8F%E7%BB%86%E8%83%9E%E7%B1%BB%E5%9E%8B%E6%B3%A8%E9%87%8A"><span class="toc-number">5.6.7.1.</span> <span class="toc-text"> 单细胞RNA测序细胞类型注释</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E7%BB%86%E8%83%9Erna%E6%B5%8B%E5%BA%8F%E6%89%B0%E5%8A%A8"><span class="toc-number">5.6.7.2.</span> <span class="toc-text"> 单细胞RNA测序扰动</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E7%BB%86%E8%83%9Erna%E6%B5%8B%E5%BA%8F%E6%89%B9%E6%AC%A1%E6%95%B4%E5%90%88"><span class="toc-number">5.6.7.3.</span> <span class="toc-text"> 单细胞RNA测序批次整合</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E7%BB%86%E8%83%9E%E5%A4%9A%E7%BB%84%E5%AD%A6%E6%95%B4%E5%90%88-2"><span class="toc-number">5.6.7.4.</span> <span class="toc-text"> 单细胞多组学整合</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E5%9B%A0%E8%B0%83%E6%8E%A7%E7%BD%91%E7%BB%9C%E6%8E%A8%E6%96%AD-2"><span class="toc-number">5.6.7.5.</span> <span class="toc-text"> 基因调控网络推断</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E7%BB%86%E8%8A%82"><span class="toc-number">5.6.8.</span> <span class="toc-text"> 实现细节</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%8F%AF%E7%94%A8%E6%80%A7"><span class="toc-number">5.7.</span> <span class="toc-text"> 数据可用性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%8F%AF%E7%94%A8%E6%80%A7"><span class="toc-number">5.8.</span> <span class="toc-text"> 代码可用性</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%A1%A5%E5%85%85%E4%BF%A1%E6%81%AF"><span class="toc-number">6.</span> <span class="toc-text"> 补充信息</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE"><span class="toc-number">7.</span> <span class="toc-text"> 参考文献</span></a></li></ol>
      
  </div>
</div>
</div>
        <div class="sidebar-common-sidebar hidden"><div class="sidebar-author">
  <img data-src="/avatar/avatar.webp" data-sizes="auto" alt="LuoYing" class="lazyload">
  <div class="sidebar-author-name">LuoYing</div>
  <div class="sidebar-description">一方小筑，与君共勉</div>
</div>
<div class="sidebar-state">
  <div class="sidebar-state-article">
    <div>文章</div>
    <div class="sidebar-state-number">119</div>
  </div>
  <div class="sidebar-state-category">
    <div>分类</div>
    <div class="sidebar-state-number">15</div>
  </div>
  <div class="sidebar-state-tag">
    <div>标签</div>
    <div class="sidebar-state-number">2</div>
  </div>
</div>
<div class="sidebar-social">
  
</div>
<div class="sidebar-menu">
  
    
      <div class="sidebar-menu-link-wrap">
        <a class="sidebar-menu-link-dummy" href="/" aria-label="首页"></a>
        <div class="sidebar-menu-icon icon rotate">
          &#xe62b;
        </div>
        <div class="sidebar-menu-link">首页</div>
      </div>
    
      <div class="sidebar-menu-link-wrap">
        <a class="sidebar-menu-link-dummy" href="/archives" aria-label="归档"></a>
        <div class="sidebar-menu-icon icon rotate">
          &#xe62b;
        </div>
        <div class="sidebar-menu-link">归档</div>
      </div>
    
      <div class="sidebar-menu-link-wrap">
        <a class="sidebar-menu-link-dummy" href="/about" aria-label="关于"></a>
        <div class="sidebar-menu-icon icon rotate">
          &#xe62b;
        </div>
        <div class="sidebar-menu-link">关于</div>
      </div>
    
      <div class="sidebar-menu-link-wrap">
        <a class="sidebar-menu-link-dummy" href="/friend" aria-label="友链"></a>
        <div class="sidebar-menu-icon icon rotate">
          &#xe62b;
        </div>
        <div class="sidebar-menu-link">友链</div>
      </div>
    
  
</div>
</div>
      
      
        <div class="sidebar-btn-wrapper" style="position:static">
          <div class="sidebar-toc-btn current"></div>
          <div class="sidebar-common-btn"></div>
        </div>
      
    </div>
  </div>

  
</aside>

          
          <section id="main"><article id="post-vazgz0k2" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner" data-aos="fade-up">
    <div class="article-meta">
      <div class="article-date">
  <a href="/2024/12/16/vazgz0k2/" class="article-date-link" data-aos="zoom-in">
    <time datetime="2024-12-16T15:38:25.000Z" itemprop="datePublished">2024-12-16</time>
    <time style="display: none;" id="post-update-time">2025-10-01</time>
  </a>
</div>

      
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%AE%BA%E6%96%87%E8%A7%A3%E8%AF%BB/" data-aos="zoom-in">论文解读</a>
  </div>


    </div>
    <div class="hr-line"></div>
    

    <div class="e-content article-entry" itemprop="articleBody">
      
        <blockquote id="outdate-blockquote" style="display: none;"><p></p></blockquote>
      
      
        <h1 id="文章链接"><a class="markdownIt-Anchor" href="#文章链接"></a> 文章链接</h1>
<blockquote>
<p>Cui, H., Wang, C., Maan, H., Pang, K., Luo, F., Duan, N., &amp; Wang, B. (2024). scGPT: toward building a foundation model for single-cell multi-omics using generative AI. Nature Methods, 21,1470-1480. <a target="_blank" rel="noopener" href="https://doi.org/10.1038/s41592-024-02201-0">https://doi.org/10.1038/s41592-024-02201-0</a></p>
</blockquote>
<h1 id="简介"><a class="markdownIt-Anchor" href="#简介"></a> 简介</h1>
<p><code>scGPT</code>：提出了一个利用<code>生成式AI</code>构建的单细胞多组学基础模型。</p>
<h1 id="摘要"><a class="markdownIt-Anchor" href="#摘要"></a> 摘要</h1>
<p>生成式预训练模型在语言和计算机视觉等多个领域取得了显著成功。具体而言，大规模多样化数据集与预训练<code>transformer</code>的结合已经成为开发基础模型的一种很有前景的方法。基于语言和细胞生物学之间的相似性（文本由词语组成；类似地，细胞由基因定义），我们的研究探索了基础模型在推进细胞生物学和遗传学研究方面的应用潜力。利用蓬勃发展的单细胞测序数据，我们基于生成式预训练<code>transformer</code>在超过<code>3300万</code>个细胞的数据库上构建了一个单细胞生物学基础模型<code>scGPT</code>。我们的研究表明，<code>scGPT</code>能有效提取关于基因和细胞的关键生物学见解。通过进一步采用迁移学习，<code>scGPT</code>可以针对各种下游应用进行优化以实现卓越性能。这包括细胞类型注释、多批次整合、多组学整合、扰动响应预测和基因网络推断等任务。</p>
<h1 id="创新点"><a class="markdownIt-Anchor" href="#创新点"></a> 创新点</h1>
<ol>
<li>首个单细胞组学领域的<code>基础模型</code></li>
</ol>
<ul>
<li>首次将大规模预训练<code>transformer</code>应用于单细胞组学数据分析</li>
<li>在超过3300万个细胞的数据集上进行预训练</li>
<li>可以通过微调适应多种下游任务</li>
</ul>
<ol start="2">
<li>创新的模型架构</li>
</ol>
<ul>
<li>设计了特殊的<code>注意力掩码机制</code>，可以处理<code>非序列</code>的基因表达数据</li>
<li>同时学习基因和细胞的嵌入表示</li>
<li>支持通过<code>基因提示</code>和<code>细胞提示</code>进行生成式预测</li>
</ul>
<ol start="3">
<li>多功能性和通用性</li>
</ol>
<ul>
<li>在多个下游任务中实现了最先进的性能，包括:
<ul>
<li>细胞类型注释</li>
<li>基因扰动响应预测</li>
<li>多批次整合</li>
<li>多组学整合</li>
<li>基因网络推断</li>
</ul>
</li>
<li>展现了强大的<code>零样本</code>和<code>少样本</code>迁移学习能力</li>
</ul>
<ol start="4">
<li>可解释性</li>
</ol>
<ul>
<li>通过注意力机制学习<code>基因-基因相互</code>作用</li>
<li>可以揭示特定细胞状态下的基因网络激活模式</li>
<li>发现的基因调控关系与已知生物学知识高度吻合</li>
</ul>
<h1 id="主要内容"><a class="markdownIt-Anchor" href="#主要内容"></a> 主要内容</h1>
<h2 id="读前须知"><a class="markdownIt-Anchor" href="#读前须知"></a> 读前须知</h2>
<ol>
<li>论文解读尽可能的还原原文，若有不恰当之处，还请见谅；</li>
<li>排版上，插图会尽量贴近出处，而<code>补充图表</code>均在文末“<code>补充信息</code>”的下载链接中；</li>
<li>左边👈有目录，可自行跳转至想看的部分；</li>
<li>部分专业术语翻译成中文可能不太恰当，此时会用括号标明它的英文原文，如感受野（<code>Receptive field</code>）。请注意，仅首次出现会标明；</li>
</ol>
<h2 id="引言"><a class="markdownIt-Anchor" href="#引言"></a> 引言</h2>
<p>单细胞RNA测序（<code>scRNA-seq</code>）通过实现对不同细胞类型的精细表征并推进我们对疾病发病机制的理解，为细胞异质性探索、谱系追踪、致病机制阐明以及最终的个性化治疗策略铺平了道路。<code>scRNA-seq</code>的广泛应用产生了诸如人类细胞图谱等全面的数据图谱，现在已经包含数千万个细胞。测序技术的最新进展促进了数据模态的多样性，并将我们的认知从基因组学扩展到表观遗传学、转录组学和蛋白质组学，从而提供多模态的见解。这些突破也带来了新的研究问题，如<code>参考映射</code>、<code>扰动预测</code>和<code>多组学整合</code>。开发能够有效利用、增强和适应测序数据快速扩张的方法是至关重要的。</p>
<blockquote>
<p><code>参考映射（Reference Mapping）</code>：将测序数据比对到已知的参考基因组序列上的过程；</p>
<p><code>扰动预测（Perturbation Prediction）</code>：预测对生物系统施加干扰后可能产生的变化或响应；</p>
<p><code>多组学整合（Multi-omics Integration）</code>：将不同层面的组学数据（如基因组学、转录组学、蛋白组学等）进行综合分析，以获得系统性的认识。</p>
</blockquote>
<p>解决这一挑战的一个有前景的方法是生成式预训练基础模型。基础模型通常基于<code>self-attention transformer</code>架构构建，因其在学习数据表征方面的有效性而被广泛采用，这类模型在大规模、多样化数据集上进行预训练，可以轻松适应各种下游任务。此类模型最近在多个领域取得了空前的成功，典型例子包括<code>计算机视觉</code>和<code>自然语言生成</code>领域的<code>DALL-E 2</code>和<code>GPT-4</code>，以及最近用于生物应用的<code>Enformer</code>。</p>
<blockquote>
<p><code>生成式预训练模型（Generative Pre-trained Models）</code>：先在大规模数据上进行无监督预训练，再针对特定任务微调的人工智能模型，能够生成文本、图像等内容。典型代表如GPT、BERT等。这类模型通过&quot;预训练-微调&quot;的范式，可以学习到通用的知识表示，并应用于各种下游任务。</p>
</blockquote>
<p>更有趣的是，这些生成式<code>预训练模型</code>始终优于从头训练的特定任务模型。这表明这些模型在相应领域获得了与任务无关的知识理解，启发我们探索其在单细胞组学研究中的应用。然而，当前单细胞研究中的机器学习方法较为分散，具体模型仅专注于特定的分析任务。因此，每项研究使用的数据集在广度和规模上往往受限。为了应对这一局限性，需要一个在大规模数据上预训练的基础模型，能够理解不同组织中基因之间的复杂相互作用。</p>
<p>为了增强单细胞测序数据的建模，我们从自然语言生成(<code>NLG</code>)中的自监督预训练工作流程获得灵感，其中<code>self-attention transformer</code>在建模输入词语标记方面表现出了强大的能力。正如文本由词语构成，细胞可以通过基因及其编码的蛋白质产物来表征。通过同时学习基因和细胞嵌入，我们可以更好地理解细胞特征。此外，<code>transformer</code>输入标记的灵活性使其能够轻松整合额外的特征和元信息。最近在<code>Geneformer</code>中也探索了这一方向，其中基于<code>transformer</code>的编码器通过按表达水平排序的基因进行训练，展示了细胞类型和基因功能预测的能力。在此基础上，我们认为有必要专门为<code>非序列组学数据</code>定制预训练工作流程，并扩展其在更广泛任务中的应用。</p>
<p>在这项工作中，我们通过在超过<code>3300万</code>个细胞上进行预训练，提出了单细胞基础模型<code>scGPT</code>。我们建立了一个专门用于<code>非序列组学</code>数据的统一生成式预训练工作流程，并调整了<code>transformer</code>架构以同时学习细胞和基因表示。此外，我们提供了具有特定任务目标的微调流程，旨在促进预训练模型在各种不同任务中的应用。</p>
<p>我们的模型<code>scGPT</code>通过以下三个关键方面展示了单细胞基础模型的变革性潜力：</p>
<ol>
<li>
<p><code>scGPT</code>代表了一个大规模的生成式基础模型，能够跨多个下游任务进行<code>迁移学习</code>。通过在细胞类型注释、基因扰动预测、批次校正和多组学整合等任务上达到最先进的表现，我们展示了&quot;<code>普适预训练，按需微调</code>&quot;方法作为单细胞组学计算应用的通用解决方案的有效性。</p>
</li>
<li>
<p>通过比较微调和原始预训练模型的<code>基因嵌入</code>和<code>注意力权重</code>，<code>scGPT</code>揭示了关于基因-基因相互作用的宝贵生物学见解，这些相互作用与各种条件相关，如细胞类型和扰动状态。</p>
</li>
<li>
<p>我们的观察揭示了一个规模效应：更大的预训练数据量能产生更优的预训练嵌入，从而进一步提升下游任务的表现。这一发现强调了一个令人兴奋的前景：基础模型可以随着研究社群中可用测序数据的扩展而持续改进。</p>
</li>
</ol>
<p>基于这些发现，我们预见采用预训练基础模型将大大拓展我们对细胞生物学的理解，并为未来的发现奠定坚实基础。发布<code>scGPT</code>模型和工作流程的目的是赋能并加速这些领域及其他领域的研究。</p>
<h2 id="结果"><a class="markdownIt-Anchor" href="#结果"></a> 结果</h2>
<h3 id="单细胞-transformer-基础模型概述"><a class="markdownIt-Anchor" href="#单细胞-transformer-基础模型概述"></a> 单细胞 transformer 基础模型概述</h3>
<p>单细胞转录组测序能够在单个细胞水平上分析分子特征。例如，<code>scRNA-seq</code>测量了<code>RNA</code>转录本的丰度，为理解细胞身份、发育阶段和功能提供了洞见。我们介绍了<code>scGPT</code>，一个采用生成式预训练方法的单细胞领域基础模型。核心模型包含带有多头注意力的<code>堆叠转换器层</code>，可以同时生成细胞和基因嵌入（方法部分）。</p>
<p><code>scGPT</code>包含两个训练阶段：首先在大型细胞图谱上进行通用预训练，然后在较小数据集上针对特定应用进行微调（图1a-c）。在预训练阶段，我们引入了专门设计的注意力掩码和生成式训练流程，以自监督的方式训练<code>scGPT</code>来联合优化细胞和基因表示（方法部分）。这种技术解决了基因表达的非顺序性质，以适应<code>NLG</code>框架的顺序预测。在训练过程中，模型逐渐学会基于细胞状态或基因表达线索来生成细胞的基因表达。在微调阶段，预训练模型可以适应新数据集和特定任务（方法部分）。我们提供了灵活的微调流程，适用于各种基本任务，包括带批次校正的<code>scRNA-seq</code>整合、细胞类型注释、多组学整合、扰动预测和基因调控网络（<code>GRN</code>）推断。</p>
<p><img src="/images/assets//image-20241217213225509.png" alt="image-20241217213225509" /></p>
<p>为了收集多样化和大量的测序数据用于<code>scGPT</code>的自监督预训练，我们从<code>CELLxGENE</code>收集库（<a target="_blank" rel="noopener" href="https://cellxgene.cziscience.com/">https://cellxgene.cziscience.com/</a>）组装了来自正常（非疾病）条件下3300万个人类细胞的<code>scRNA-seq</code>数据（图1d）。这个全面的数据集包含了来自51个器官或组织和441项研究的各种细胞类型，提供了人体中细胞异质性的丰富表示。</p>
<p>预训练后，我们使用统一流形近似和投影（<code>UMAP</code>）可视化对3300万个细胞中10%的人类细胞的<code>scGPT</code>细胞嵌入（图1e）。产生的<code>UMAP</code>图展示出引人注目的清晰度，不同颜色代表的细胞类型准确地聚集在局部区域和簇中。考虑到数据集包含超过400项研究，这表明预训练具有提取生物变异的显著能力。</p>
<blockquote>
<p><code>UMAP (Uniform Manifold Approximation and Projection)</code>：一种<code>非线性降维算法</code>，通过构建高维数据的拓扑结构并将其映射到低维空间，能更好地保持数据的局部和全局结构。相比<code>t-SNE</code>运行更快，更适合处理大规模数据，在单细胞数据分析中应用广泛。</p>
</blockquote>
<h3 id="scgpt提高细胞类型注释的精确度"><a class="markdownIt-Anchor" href="#scgpt提高细胞类型注释的精确度"></a> scGPT提高细胞类型注释的精确度</h3>
<p>为了针对细胞类型注释微调预训练的<code>scGPT</code>，一个神经网络分类器以<code>scGPT</code>转换器输出的细胞嵌入作为输入，并输出细胞类型的分类预测。整个模型在具有专家注释的参考数据集上使用交叉熵进行训练，然后用于预测保留的查询数据分区中的细胞类型。</p>
<p>我们在多个数据集上进行了广泛的实验来评估<code>scGPT</code>在细胞类型注释方面的表现。首先，我们调整<code>scGPT</code>来预测人类胰腺数据集中的细胞类型。我们在图2a中可视化了预测结果。值得注意的是，<code>scGPT</code>对混淆矩阵中显示的大多数细胞类型都达到了较高的精确度（&gt;0.8）（图2b），只有在参考分区中细胞数量极少的罕见细胞类型除外。例如，在10,600个参考集细胞中，肥大细胞和主要组织相容性（<code>MHC</code>）II类细胞类型的细胞数量少于50个。图2c可视化了微调后<code>scGPT</code>中的细胞嵌入，这些嵌入展示了高度的细胞类型内部相似性。</p>
<p><img src="/images/assets//image-20241217213253221.png" alt="image-20241217213253221" /></p>
<p>接下来，我们在一个多发性硬化症（<code>MS</code>）疾病数据集上测试了该模型。该模型在健康人类免疫细胞的参考分区上进行微调，并评估了对<code>MS</code>状态细胞的预测。微调后的模型与原始研究提供的细胞类型注释显示出强烈的一致性，并达到了约0.85的高准确度（图2f,g）。</p>
<p>此外，我们将该模型应用于一个更具挑战性的情况，即使用<code>肿瘤浸润骨髓样细胞</code>数据集来进行跨疾病类型的泛化。该模型在参考数据分区的6种癌症类型上进行微调（方法部分），并在3种未见过的癌症类型的查询分区上进行评估（图2d）。结果显示在区分免疫细胞亚型方面具有高精确度（图2e,h），并且细胞嵌入在不同细胞类型之间表现出清晰的可分性（图2i）。最后，我们在这三个数据集上对微调的<code>scGPT</code>与其他两种最近的基于转换器的方法<code>TOSICA</code>和<code>scBERT</code>进行了基准测试（方法部分）。<code>scGPT</code>在所有分类指标中，包括准确度、精确度、召回率和宏观F1值，都持续优于其他方法（图2j）。</p>
<p>除了细胞类型分类外，我们进一步探索了<code>scGPT</code>通过参考映射将未见过的查询细胞投影到参考数据集的能力（补充说明1和补充图11）。我们发现，仅使用预训练权重的<code>scGPT</code>就达到了与现有方法相当的性能。通过在参考数据集上进行微调可以进一步提高性能。</p>
<h3 id="scgpt预测未见过的基因扰动响应"><a class="markdownIt-Anchor" href="#scgpt预测未见过的基因扰动响应"></a> scGPT预测未见过的基因扰动响应</h3>
<p>近期测序和基因编辑技术的进展极大地促进了大规模扰动实验的开展，使得我们能够表征细胞对各种<code>基因扰动的响应</code>。这种方法在发现新的基因相互作用和推进再生医学方面具有巨大的潜力。然而，潜在基因扰动的巨大组合空间很快就会超出实验可行性的实际限制。</p>
<p>为了克服这一限制，<code>scGPT</code>可以利用已知实验中获得的细胞响应知识，并将其外推以预测未知响应。在基因维度上使用<code>自注意力机制</code>，使得模型能够编码被扰动基因与其他基因响应之间的复杂相互作用。通过利用这种能力，<code>scGPT</code>可以有效地从现有实验数据中学习，并准确预测基因表达响应中未见过的扰动。</p>
<h4 id="未见过的基因扰动预测"><a class="markdownIt-Anchor" href="#未见过的基因扰动预测"></a> 未见过的基因扰动预测</h4>
<p>对于扰动预测任务，我们使用三个白血病细胞系的<code>Perturb-seq</code>数据集来评估我们的模型：<code>Adamson</code>数据集包含87个单基因扰动，经过筛选的<code>Replogle</code>数据集包含1,823个单基因扰动，以及<code>Norman</code>数据集包含131个双基因扰动和105个单基因扰动。为了评估<code>scGPT</code>的扰动预测能力，我们在一部分扰动上微调模型，以根据输入的对照细胞状态和干预基因来预测扰动后的表达谱。</p>
<p>接下来，模型在涉及未见过基因的扰动上进行测试（方法部分）。我们计算了<code>Pearson delta</code>指标，该指标衡量预测和观察到的扰动后表达变化之间的相关性。此外，我们还报告了每个扰动中前20个变化最显著的基因的这一指标，表示为差异表达基因上的<code>Pearson delta</code>。有关指标计算的详细信息，请参见补充说明12。我们对<code>scGPT</code>和其他两种方法<code>GEARS</code>和线性回归基准进行了性能比较（方法部分）。我们的结果表明，<code>scGPT</code>在所有三个数据集上都达到了最高分数（图3a和补充表6）。特别是，<code>scGPT</code>在预测扰动后的变化方面表现出色，持续超过其他方法5-20%的优势。此外，我们在图3b中可视化了<code>Adamson</code>数据集中两个示例扰动的预测，其中<code>scGPT</code>准确预测了所有前20个差异表达基因的表达变化趋势。</p>
<p><img src="/images/assets//image-20241217213352057.png" alt="image-20241217213352057" /></p>
<p>预测未见过的扰动响应的能力可以扩展扰动实验的范围，如图3c所示。为了探索预测的扰动响应的扩展空间，我们使用<code>Norman</code>数据集进行聚类分析，以验证生物相关的功能信号。原始的<code>Perturb-seq</code>研究涵盖了针对105个基因的236个扰动。</p>
<p>然而，考虑到这些目标基因的所有可能组合，总共有5,565个潜在的扰动，这表明实验的<code>Perturb-seq</code>数据仅代表了整个扰动空间的5%。因此，我们使用经过微调的<code>scGPT</code>来扩展扰动体外预测，并在图3d中使用<code>UMAP</code>可视化了每个扰动的预测平均响应。使用原始研究中的注释，我们发现相同功能组的扰动条件聚集在相邻区域（补充图4）。</p>
<p>接下来，我们使用<code>Leiden</code>对预测的表达进行聚类，并观察到这些簇与扰动组合中的&quot;主导基因&quot;具有高度关联。例如，与<code>KLF1</code>基因相关的圈出的簇表明，该簇中的数据点经历了涉及<code>KLF1</code>与另一个基因的组合扰动（即<code>KLF1 + X</code>）。以<code>KLF1</code>和<code>CNN1</code>簇为两个例子，我们进一步验证了相应的预测表达仅在这些区域高度表达（图3e），这与<code>Norman</code>数据集中<code>CRISPRa</code>（<code>CRISPR</code>介导的转录激活）<code>Perturb-seq</code>实验的预期结果一致。主导基因簇展示了<code>scGPT</code>揭示扰动组合之间关联的能力。</p>
<blockquote>
<p><code>Leiden聚类</code>：一种社区检测/聚类算法，是Louvain算法的改进版本，通常用于单细胞数据分析。它通过优化模块度（modularity）来识别网络中的社区结构，比Louvain算法更稳定，能够避免产生不连通的聚类，在保证聚类质量的同时提高运算效率。</p>
</blockquote>
<h4 id="体外逆向扰动预测"><a class="markdownIt-Anchor" href="#体外逆向扰动预测"></a> 体外逆向扰动预测</h4>
<p><code>scGPT</code>还能够根据给定的导致的细胞状态预测基因扰动的<code>来源</code>，我们将其称为<code>体外逆向扰动预测</code>。一个理想的进行这种逆向预测的预测模型可以用于推断谱系发育的重要驱动基因，或者帮助发现潜在的治疗基因靶点。</p>
<p>为了展示逆向扰动预测的有效性，我们使用了<code>Norman</code>数据集的一个子集，重点关注涉及20个基因的扰动（图3f）。这个组合空间总共包含210个单基因或双基因扰动组合。我们使用39个（18%）已知扰动（图3f中的训练组）来微调<code>scGPT</code>。然后，我们在未见过的扰动细胞状态的查询上测试模型，<code>scGPT</code>成功预测了（在排名靠前的预测中）能够产生观察结果的扰动来源。例如，<code>scGPT</code>将<code>CNN1 + MAPK1</code>基因的正确扰动排在一个测试示例的首位预测，另一个示例中将<code>FOSB + UBASH3B</code>基因的正确扰动排在第二位预测（图3f）。</p>
<p>总体而言，<code>scGPT</code>在前1预测中识别了平均91.4%的相关扰动（7个中的6.4个）（图3g中的蓝色条），在前8预测中识别了65.7%的正确扰动（7个测试案例中的4.6个）（图3g中的粉色条），大幅优于<code>GEARS</code>和差异基因基准。我们设想这些预测可以用于通过最大化达到目标细胞状态的可能性来规划扰动实验。与随机尝试相比，在这个子集中210个可能的扰动中平均需要105.5次尝试，以较少的尝试次数找到正确的基因变化来源为加速发现重要基因驱动因子和优化扰动实验提供了有价值的工具。</p>
<h3 id="scgpt实现多批次和多组学整合"><a class="markdownIt-Anchor" href="#scgpt实现多批次和多组学整合"></a> scGPT实现多批次和多组学整合</h3>
<h4 id="多批次scrna-seq整合"><a class="markdownIt-Anchor" href="#多批次scrna-seq整合"></a> 多批次scRNA-seq整合</h4>
<p>整合来自不同批次的多个<code>scRNA-seq数据集</code>时，在保留整合数据的生物学变异的同时去除技术批次效应，这是一个独特的挑战。为了整合测序样本，我们采用自监督的方式对<code>scGPT</code>进行精调，通过学习统一的细胞表征来恢复被掩码的基因表达（参见<code>方法</code>）。</p>
<blockquote>
<p><code>批次效应（Batch Effect）</code>：由非生物学因素造成的系统性技术偏差，例如不同实验时间、不同操作人员、不同实验室或不同仪器设备等导致的数据变异。这种效应会影响数据分析的准确性，需要通过批次校正方法来消除或减少其影响。</p>
</blockquote>
<p>在我们的基准测试中，我们将<code>scGPT</code>与三种流行的整合方法进行比较：<code>scVI</code>、<code>Seurat</code>和<code>Harmony</code>。评估在三个整合数据集上进行，分别是<code>COVID-19</code>（18个批次）、<code>PBMC 10k</code>（2个批次）和大脑前嗜皮质(<code>perirhinal cortex</code>，2个批次）数据集。在PBMC 10k数据集中，scGPT成功区分了所有细胞类型（图4a）。scGPT出色的整合性能进一步得到了其较高生物学保留得分的支持，<code>AvgBIO</code>得分为0.821，比其他方法高出5-10%。<code>AvgBIO</code>得分汇总了三个细胞类型聚类指标：归一化互信息（<code>NMIcell</code>）、调整兰德指数（<code>ARIcell</code>）和平均轮廓宽度（<code>ASWcell</code>），详见补充说明12。</p>
<blockquote>
<p>指标解释：</p>
<ol>
<li><code>归一化互信息（NMIcell）</code>：</li>
</ol>
<ul>
<li>衡量两个聚类结果之间的相似度</li>
<li>值域在0-1之间，1表示完全一致</li>
<li>基于信息论，计算两种聚类方案之间共享的信息量</li>
</ul>
<ol start="2">
<li><code>调整兰德指数（ARIcell）</code>：</li>
</ol>
<ul>
<li>评估两个聚类结果的一致性</li>
<li>考虑随机聚类的影响，对原始兰德指数进行校正</li>
<li>值域在-1到1之间，1表示完全一致，0表示随机聚类水平</li>
</ul>
<ol start="3">
<li><code>平均轮廓宽度（ASWcell）</code>：</li>
</ol>
<ul>
<li>评估聚类的紧密度和分离度</li>
<li>计算每个样本与同类样本的相似度，与其他类样本的差异度</li>
<li>值域在-1到1之间，越接近1表示聚类效果越好</li>
</ul>
</blockquote>
<p>值得注意的是，即使没有精调，scGPT在整合<code>PBMC 10k数据集</code>时也表现出相当好的性能（补充图5），这突出了预训练的泛化能力。在近嗅皮层数据集（<code>perirhinal cortex dataset</code>）中，scGPT与所有其他方法相比保持竞争力（补充图6c）。这一发现突出表明，从全人类数据集学习到的特征可以很好地迁移到特定器官或组织如大脑。此外，scGPT在所有整合指标上始终保持竞争力的得分，并展现出对生物学信号的强大保留能力（补充表3和补充图6、7）。另外，我们还开发了策略来加速整合任务的精调过程，包括冻结特定模型层和排除无表达的基因，同时保持与原始方法相当的结果（补充说明3）。</p>
<h4 id="单细胞多组学整合"><a class="markdownIt-Anchor" href="#单细胞多组学整合"></a> 单细胞多组学整合</h4>
<p>单细胞多组学（<code>scMultiomic</code>）数据结合了遗传调控的多个视角，如表观遗传、转录组和翻译活性，在聚合细胞表征的同时保留生物学信号方面提出了独特的挑战。scGPT通过有效提取跨不同组学数据集的整合细胞嵌入来解决这一挑战。在<code>10x Multiome PBMC</code>数据集（包括联合基因表达和染色质可及性测量）的案例中，我们将scGPT与两种最新的方法进行比较，即<code>scGLUE</code>和<code>Seurat</code>（v.4）。如图4b所示，scGPT是唯一成功为<code>CD8+ naive</code>细胞生成独特聚类的方法。</p>
<p><img src="/images/assets//image-20241217213453682.png" alt="image-20241217213453682" /></p>
<p>接下来，我们在来自骨髓单核细胞（<code>BMMCs</code>）的配对基因表达和蛋白质丰度数据集上测试了scGPT，如图4c所示。该数据集具有额外的复杂性，包括大量数据（90,000个细胞）、多个批次（12个供体）和细粒度的亚组注释（48种细胞类型）。scGPT比Seurat（v.4）呈现出更清晰的聚类结构，<code>AvgBIO</code>得分提高了9%。值得注意的是，scGPT能够将<code>CD4+ naive T</code>细胞和<code>CD4+ activated T</code>细胞分为两个不同的聚类。它还将整合β7+活化的CD4+ T细胞与其他CD4+ T细胞区分开来，这进一步证实了该模型能够捕捉免疫细胞亚群之间的微妙差异。</p>
<p>在镶嵌数据整合设置中，测序样本共享一些（但不是全部）数据模态，这给整合方法带来了挑战。为了展示scGPT在这种情况下的能力，我们以<code>ATAC with select antigen profiling</code>（<code>ASAP</code>）人类PBMC数据集为例。该数据集由四个测序批次组成，包含三种数据模态。在与<code>scMoMat</code>的基准实验中，scGPT展示出优越的批次校正性能，如图4d所示，特别是在B细胞、骨髓细胞和自然杀伤（<code>NK</code>）细胞群中。</p>
<p>总体而言，scGPT展示出优越的细胞类型聚类性能，并在各种基准生物学保留指标中表现出稳健性（补充表4）。</p>
<h3 id="scgpt揭示特定细胞状态的基因网络"><a class="markdownIt-Anchor" href="#scgpt揭示特定细胞状态的基因网络"></a> scGPT揭示特定细胞状态的基因网络</h3>
<p>转录因子、辅因子、增强子和靶基因之间的相互作用构成了基因调控网络（<code>GRN</code>），调控着重要的生物学过程。现有的<code>GRN推断方法</code>通常依赖于<code>静态基因表达的相关性</code>或<code>伪时间估计</code>作为因果图的代理。</p>
<blockquote>
<p>个人理解：研究者想知道哪个基因调控哪个基因（即因果关系），但直接观察这种调控关系很困难。所以退而求其次，主要用两种方法来推测：要么看基因表达量之间是否存在相关性（就像看到两个人总是同时出现，就推测他们可能有关系），要么通过重建细胞发育的时间顺序来推测（比如先发现A基因表达，过一会儿B基因才表达，就推测A可能调控B）。但这些都是间接的推测方法，可能并不能完全反映真实的调控关系，有点像是&quot;猜&quot;而不是&quot;看到&quot;。</p>
</blockquote>
<p>scGPT通过基因表达的生成式建模进行优化，在其<code>基因嵌入</code>和<code>注意力图</code>中隐式编码了这些关系。因此，我们提出通过探测来自预训练或精调模型的scGPT嵌入和注意力图来进行GRN推断。基因嵌入构建了一个相似性网络，表明数据集层面的基因-基因相互作用。注意力图进一步捕捉了不同细胞状态下独特的基因网络激活模式。</p>
<p>在本研究中，我们将scGPT提取的基因网络与已知生物学进行验证，并探索其在基因程序发现中的应用。</p>
<p>scGPT通过学习到的基因标记嵌入，展示了其对功能相关基因进行分组和区分功能不同基因的能力。在图5a中，我们使用预训练的scGPT模型可视化了人类白细胞抗原（<code>HLA</code>）蛋白的相似性网络进行基本验证。在这个零样本设置中，scGPT模型成功突出了对应于两个明确特征的HLA类别的两个聚类：HLA I类和HLA II类基因。这些类别编码抗原呈递蛋白，在免疫环境中发挥不同作用。</p>
<p>例如，HLA I类蛋白（由<code>HLA-A</code>、<code>HLA-C</code>和<code>HLA-E</code>等基因编码）被<code>CD8+ T</code>细胞识别并介导细胞毒性效应，而HLA II类蛋白（由<code>HLA-DRB1</code>、<code>HLA-DRA</code>和<code>HLA-DPA1</code>编码）被<code>CD4+ T</code>细胞识别并触发更广泛的辅助功能。此外，我们在&quot;免疫人类&quot;数据集上对scGPT模型进行精调，并探索了该数据集中存在的免疫细胞类型特异的CD基因网络。我们使用与集成任务相同的精调策略（见<code>方法</code>）用于GRN分析。预训练的scGPT模型成功识别出了一组用于T细胞激活的T3复合物编码基因（<code>CD3E</code>、<code>CD3D</code>和<code>CD3G</code>）以及用于B细胞信号传导的<code>CD79A</code>和<code>CD79B</code>，以及作为HLA I类分子共受体的<code>CD8A</code>和<code>CD8B</code>（图5b）。此外，精调后的scGPT模型突出了<code>CD36</code>和<code>CD14</code>之间的联系（图5b）。</p>
<p><img src="/images/assets//image-20241217213552997.png" alt="image-20241217213552997" /></p>
<p>scGPT能够发现表现出细胞类型特异性激活的有意义的基因程序。基因程序随后使用来自scGPT的基因嵌入进行选择和聚类（见<code>方法</code>）。在图5c中，我们可视化了在&quot;免疫人类&quot;数据集的高变异基因（<code>HVGs</code>）上经过精调的scGPT模型提取的基因程序及其在不同细胞类型中的表达。我们观察到一组HLA II类基因被识别为第2组。类似地，参与T3复合物的CD3基因被识别为第3组，在T细胞中表现出最高表达。为了系统地验证提取的基因程序，我们对照Reactome数据库进行了通路富集分析，并使用严格的多重检验校正（见<code>方法</code>）确定了高置信度的&quot;通路命中&quot;。在图5d中，我们将scGPT的结果与共表达网络的结果进行比较。值得注意的是，scGPT在所有聚类分辨率下始终显示出显著更多的富集通路。</p>
<p>此外，我们研究了scGPT和<code>共表达网络</code>之间识别的通路的异同，如图5e所示。两种方法识别出15条共同通路，包括与<code>细胞周期</code>和<code>免疫系统</code>相关的通路。scGPT独特地识别出额外的22条通路，其中14条与免疫相关。值得注意的是，scGPT特别突出了与适应性免疫系统、T细胞受体信号传导、<code>PD-1</code>信号传导和MHC II类呈递相关的通路。这与精调数据集中存在适应性免疫群体的事实相符。这些发现证明了scGPT在捕捉复杂的基因-基因连接和揭示更广泛生物学背景下特定机制的卓越能力。富集通路的详细列表在补充表5中提供。</p>
<p>除了使用基因嵌入进行数据集层面的基因网络推断外，scGPT的注意力机制使其能够在单细胞层面捕捉基因-基因相互作用。scGPT通过<code>聚合注意力图</code>中的单细胞信号来提取细胞状态特异的网络激活数据。这为了解个别细胞内的上下文特异性基因调控相互作用提供了见解，这些相互作用可能在不同的细胞状态和条件下有所不同。</p>
<p>例如，在一个扰动实验中，scGPT通过检查扰动前后基因网络激活的变化，来推断哪些基因最受每个被扰动基因的影响（图6a和方法）。在<code>Adamson CRISPR</code>干扰数据集中，scGPT识别出了受<code>DDIT3</code>（编码一个转录因子）抑制影响最大的前20个基因，这些基因在<code>ChIP-Atlas</code>数据库中均被发现是DDIT3的信号传导靶点（图6b）。此外，scGPT在对照与DDIT3敲除设置中捕捉到了在前100个最受影响基因中不同的通路激活模式。</p>
<p>值得注意的是，在DDIT3敲除设置中识别出的<code>ATF6</code>转录因子通路已知可介导未折叠蛋白反应并调控细胞凋亡。类似地，在<code>BHLHE40</code>抑制的情况下，前20个最受影响的基因中有19个被发现是通过染色质免疫沉淀测序（<code>ChIP-seq</code>）预测的这个转录因子的靶点（图6c）。突出DNA合成和有丝分裂的通路激活模式反映了转录因子BHLHE40在细胞周期调控中的作用。这些基于注意力的发现进一步验证了scGPT在细胞状态水平上学习到的基因网络，为模型学习到的生物学提供了额外的<code>可解释性</code>。</p>
<p><img src="/images/assets//image-20241217213726866.png" alt="image-20241217213726866" /></p>
<h3 id="迁移学习中的规模和上下文效应"><a class="markdownIt-Anchor" href="#迁移学习中的规模和上下文效应"></a> 迁移学习中的规模和上下文效应</h3>
<p>在前面的章节中，scGPT通过精调的方式展示了迁移学习的巨大潜力。我们通过将其与类似的、从头训练（无预训练）的<code>transformer模型</code>进行比较，进一步确认了使用基础模型的好处（表示为<code>scGPT (from scratch)</code>）。结果呈现在补充表2-4中，精调后的scGPT在整合和细胞类型注释等任务中始终表现出性能优势。鉴于基础模型对下游任务的贡献已被观察到，我们进一步关注影响迁移学习过程的因素。</p>
<p>首先，我们深入研究<code>预训练数据规模与精调模型性能之间的关系</code>：对于某个特定的分析任务，在预训练的细胞图谱中添加更多测序数据能获得多少改进？我们使用相同参数数量但使用不同数据量（从30,000到3300万个测序的正常人类细胞）预训练了一系列scGPT模型。补充图13a展示了使用这些不同预训练模型在各种应用上精调的结果表现。我们观察到，随着预训练数据量的增加，精调模型的性能有所提升（补充说明4）。这些结果表明存在一个规模效应，即更大的预训练数据规模会带来更好的预训练嵌入，并提升下游任务的性能。值得注意的是，我们的发现也与自然语言模型中报告的规模定律相一致，突出了数据规模在模型性能中的重要作用。<code>预训练数据规模在精调结果中的关键作用表明了单细胞领域预训练模型的美好前景</code>。随着更大、更多样化的数据集的出现，我们可以预期模型性能会进一步提升，推进我们对细胞过程的理解。</p>
<p>我们探索的第二个因素是<code>上下文特定预训练的影响</code>。这里，上下文使用是指scGPT模型在特定细胞类型上预训练，然后在类似细胞类型的下游任务上进行精调。为了探索这一因素的影响，我们在来自各个主要器官的正常人类细胞上预训练了七个器官特异性模型（图1d）和另一个泛癌症模型。我们通过可视化预训练数据的细胞嵌入来验证预训练的有效性：泛癌症模型的细胞嵌入准确地区分了不同的癌症类型（补充图2）。器官特异性模型能够揭示相应器官的细胞异质性（补充图3）。接下来，我们在<code>COVID-19</code>数据集上对各个模型进行微调，以检验预训练上下文的影响。我们的分析揭示了模型在预训练中所涉及的上下文相关性与其后续表现之间存在明显的关联（附录图8）。在数据整合任务中表现最好的是在<code>全人类</code>、<code>血液</code>和<code>肺部</code>数据集上预训练的模型，这与<code>COVID-19</code>数据集中存在的细胞类型高度一致。值得注意的是，尽管在<code>1320万</code>细胞的大规模数据集上进行了预训练，<code>大脑</code>预训练模型的性能仍比使用相似规模数据集训练的<code>血液</code>预训练模型低了<code>8%</code>。这强调了在预训练中保持细胞上下文与目标数据集一致的重要性，以获得更好的下游任务效果。但同时需要指出，虽然考虑细胞上下文很重要，但全人类预训练模型仍然是广泛应用场景下最可靠的选择。</p>
<h2 id="讨论"><a class="markdownIt-Anchor" href="#讨论"></a> 讨论</h2>
<p>我们介绍了<code>scGPT</code>，这是一个在大量单细胞数据上利用预训练<code>transformer</code>力量的基础模型。基于语言模型中自监督预训练的成功经验，我们在单细胞领域采用了类似的方法来揭示复杂的生物学相互作用。<code>scGPT</code>中<code>transformer</code>的使用使得基因和细胞嵌入的同步学习成为可能，这有助于对细胞过程的各个方面进行建模。通过利用<code>transformer</code>的注意力机制，<code>scGPT</code>能够在单细胞水平捕获基因间的相互作用，为模型提供了额外的可解释性层面。</p>
<p>我们通过<code>零样本</code>和<code>微调环境</code>下的全面实验展示了预训练的优势。预训练模型在零样本实验中展现出强大的推广到未见数据集的能力，呈现出与细胞类型相一致的有意义的聚类模式。此外，所学习的基因网络在<code>scGPT</code>中表现出与已知功能组的强烈一致性。更进一步，预训练模型的知识可以通过微调迁移到多个下游任务。在细胞类型注释、扰动预测、多批次和多组学整合等各种任务中，经过微调的<code>scGPT</code>模型始终优于从头开始训练的模型。这展示了预训练模型对下游任务的价值，使得分析更加准确且具有生物学意义。值得注意的是，目前的预训练并不能从本质上缓解批次效应，因此模型在具有显著技术变异的数据集上的零样本表现可能会受到限制。评估模型也很复杂，因为经常缺乏明确的生物学真值，而且数据质量也存在差异（详见附录说明10）。</p>
<p>对于未来的方向，我们计划在更大规模的数据集上进行预训练，包括<code>多组学数据</code>、<code>空间组学</code>和各种疾病条件。在预训练阶段<code>纳入扰动和时序数据</code>也很有趣，使模型能够学习因果关系，推断基因和细胞如何随时间响应变化。我们还旨在探索单细胞数据的上下文指令学习。这涉及开发使预训练模型能够在零样本环境下理解和适应不同任务和上下文的技术，而无需微调。通过使<code>scGPT</code>能够掌握不同分析的细微差别和具体要求，我们可以提高其在广泛研究场景中的实用性和适用性。我们设想预训练范式将很快被整合到单细胞研究中，并作为一个基础来利用来自指数增长的细胞图谱中的现有知识进行新的发现。</p>
<h2 id="在线内容"><a class="markdownIt-Anchor" href="#在线内容"></a> 在线内容</h2>
<p>任何方法、补充参考文献、《Nature Portfolio》报告摘要、源数据、扩展数据、补充信息、致谢、同行评议信息；作者贡献和竞争利益的详细信息；以及数据和代码可用性声明均可在 <a target="_blank" rel="noopener" href="https://doi.org/10.1038/s41592-024-02201-0">https://doi.org/10.1038/s41592-024-02201-0</a> 获取。</p>
<h2 id="方法"><a class="markdownIt-Anchor" href="#方法"></a> 方法</h2>
<h3 id="输入嵌入"><a class="markdownIt-Anchor" href="#输入嵌入"></a> 输入嵌入</h3>
<p>单细胞测序数据被处理成一个细胞-基因矩阵，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>∈</mo><msup><mi mathvariant="normal">R</mi><mrow><mi>N</mi><mo>×</mo><mi>G</mi></mrow></msup></mrow><annotation encoding="application/x-tex">X ∈ ℝ^{N×G}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72243em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8413309999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord amsrm">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span><span class="mbin mtight">×</span><span class="mord mathnormal mtight">G</span></span></span></span></span></span></span></span></span></span></span></span>，其中每个元素 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>X</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo>∈</mo><msup><mi mathvariant="normal">R</mi><mo>+</mo></msup></mrow><annotation encoding="application/x-tex">X_{i,j} ∈ ℝ^+</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.771331em;vertical-align:0em;"></span><span class="mord"><span class="mord amsrm">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.771331em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">+</span></span></span></span></span></span></span></span></span></span></span> 表示<code>scRNA-seq</code>数据的RNA分子读数或<code>scATAC-seq</code>数据的染色质可及性峰区域。具体来说，对于<code>scRNA-seq</code>数据，该元素表示细胞 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>∈</mo><mo stretchy="false">{</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mo>…</mo><mo separator="true">,</mo><mi>N</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">i ∈ \{0,1,…,N\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69862em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">…</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mclose">}</span></span></span></span> 中基因 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi><mo>∈</mo><mo stretchy="false">{</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mo>…</mo><mo separator="true">,</mo><mi>G</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">j ∈ \{0,1,…,G\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">…</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">G</span><span class="mclose">}</span></span></span></span> 的RNA丰度。在随后的章节中，我们将这个矩阵称为原始计数矩阵。<code>scGPT</code>的输入由三个主要组成部分：</p>
<ol>
<li>
<p>基因（或峰）标记</p>
</li>
<li>
<p>表达值</p>
</li>
<li>
<p>条件标记</p>
</li>
</ol>
<p>对于每个建模任务，基因标记和表达值都是从原始计数矩阵<code>X</code>相应地<code>预处理</code>得到的。</p>
<h4 id="基因标记"><a class="markdownIt-Anchor" href="#基因标记"></a> 基因标记</h4>
<p>在<code>scGPT</code>框架中，每个基因被视为类似于自然语言生成中词语的最小信息单位。因此，我们使用基因名称作为标记，并为每个基因 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mtext>g</mtext><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">\text g_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.810808em;vertical-align:-0.380248em;"></span><span class="mord"><span class="mord text"><span class="mord">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.217524em;"><span style="top:-2.4558600000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.380248em;"><span></span></span></span></span></span></span></span></span></span> 分配一个唯一的整数标识符 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>id</mtext><mo stretchy="false">(</mo><msub><mtext>g</mtext><mi>j</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\text {id}(\text g_j)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.130248em;vertical-align:-0.380248em;"></span><span class="mord text"><span class="mord">id</span></span><span class="mopen">(</span><span class="mord"><span class="mord text"><span class="mord">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.217524em;"><span style="top:-2.4558600000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.380248em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> 。这些标识符构成了<code>scGPT</code>中使用的标记词汇表。这种方法提供了极大的灵活性，可以协调具有不同基因集（即由不同测序技术或预处理流程生成）的多个研究。具体而言，不同基因标记集可以通过取所有研究中基因的并集来整合到一个共同的词汇表中。此外，我们在词汇表中还加入了特殊标记，如用于将所有基因聚合成细胞表示的<code>&lt;cls&gt;</code>和用于将输入填充到固定长度的<code>&lt;pad&gt;</code>。从概念上讲，我们将基因标记与自然语言生成中的词标记进行类比。因此，每个<code>细胞i</code>的输入基因标记由一个向量  <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>t</mi><mi>g</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>∈</mo><msup><mi mathvariant="normal">N</mi><mi>M</mi></msup></mrow><annotation encoding="application/x-tex">t^{(i)}_g ∈ ℕ^M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2974999999999999em;vertical-align:-0.2526999999999999em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.5834080000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2526999999999999em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8413309999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord amsrm">N</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">M</span></span></span></span></span></span></span></span></span></span></span> 表示：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msubsup><mi>t</mi><mi>g</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>=</mo><mo stretchy="false">[</mo><mi>i</mi><mi>d</mi><mo stretchy="false">(</mo><msubsup><mi>g</mi><mn>1</mn><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup><mo stretchy="false">)</mo><mo separator="true">,</mo><mi>i</mi><mi>d</mi><mo stretchy="false">(</mo><msubsup><mi>g</mi><mn>2</mn><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup><mo stretchy="false">)</mo><mo separator="true">,</mo><mo>…</mo><mo separator="true">,</mo><mi>i</mi><mi>d</mi><mo stretchy="false">(</mo><msubsup><mi>g</mi><mi>M</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup><mo stretchy="false">)</mo><mo stretchy="false">]</mo><mtext>                                         </mtext><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">t^{(i)}_g = [id(g^{(i)}_1), id(g^{(i)}_2), …, id(g^{(i)}_M)]~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~(1)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.321108em;vertical-align:-0.383108em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.383108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.338331em;vertical-align:-0.293531em;"></span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.433692em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.266308em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">i</span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.433692em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.266308em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">…</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">i</span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.4064690000000004em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">M</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.293531em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">]</span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span></span></p>
<p>其中<code>M</code>是预定义的最大输入长度。</p>
<h4 id="表达值"><a class="markdownIt-Anchor" href="#表达值"></a> 表达值</h4>
<p>在用于建模之前，基因表达矩阵X需要额外的处理。基因表达建模中的一个基本挑战是不同测序协议间绝对量值的变异性。测序深度的差异以及稀疏表达基因的存在导致了不同测序批次样本之间的数据尺度存在显著差异。这些差异不容易通过常见的预处理技术（如每百万转录本归一化和<code>log1p</code>转换）来缓解。即使经过这些转换，相同的绝对值在不同测序批次间也可能传达不同的&quot;语义&quot;含义。为了解决这种尺度差异，我们提出了值分箱技术，将所有表达计数转换为相对值。对于每个细胞中的每个非零表达计数，我们计算原始绝对值并将它们分成B个连续区间 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><msub><mi>b</mi><mi>k</mi></msub><mo separator="true">,</mo><msub><mi>b</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[b_k, b_{k+1}]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mclose">]</span></span></span></span>，其中 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>∈</mo><mo stretchy="false">{</mo><mn>1</mn><mo separator="true">,</mo><mn>2</mn><mo separator="true">,</mo><mo>…</mo><mo separator="true">,</mo><mi>B</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">k ∈ \{1,2,…,B\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.73354em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">…</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">}</span></span></span></span> 。每个区间代表所有表达基因的相等部分（<code>1/B</code>）。需要注意的是，每个细胞都会计算一组新的分箱边界，因此区间边界<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>b</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">b_k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>可能在细胞间有所不同。<code>细胞i</code>的分箱表达值 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>x</mi><mi>j</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup></mrow><annotation encoding="application/x-tex">x^{(i)}_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.4577719999999998em;vertical-align:-0.4129719999999999em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.4231360000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4129719999999999em;"><span></span></span></span></span></span></span></span></span></span> 定义为：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msubsup><mi>x</mi><mi>j</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>=</mo><mrow><mo fence="true">{</mo><mtable rowspacing="0.3599999999999999em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>k</mi><mo separator="true">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mtext>if  </mtext><msub><mi>X</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo>&gt;</mo><mn>0</mn><mtext> </mtext><mrow><mi>a</mi><mi>n</mi><mi>d</mi></mrow><mtext> </mtext><msub><mi>X</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo>∈</mo><mo stretchy="false">[</mo><msub><mi>b</mi><mi>k</mi></msub><mo separator="true">,</mo><msub><mi>b</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub><mo stretchy="false">]</mo><mo separator="true">,</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>0</mn><mo separator="true">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mtext>if  </mtext><msub><mi>X</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo>=</mo><mn>0.</mn></mrow></mstyle></mtd></mtr></mtable></mrow><mtext>                             </mtext><mo stretchy="false">(</mo><mn>2</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">x^{(i)}_j = \begin{cases} k, &amp; \text{if} ~~X_{i,j} &gt; 0 \text~{and}~ X_{i,j} ∈ [b_k, b_{k+1}], \\ 0, &amp; \text{if} ~~X_{i,j} = 0. \end{cases}~~~~~~~~~~~~~~~~~~~~~~~~~~~~~(2)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.4577719999999998em;vertical-align:-0.412972em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.4231360000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.412972em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.0000299999999998em;vertical-align:-1.25003em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">{</span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.69em;"><span style="top:-3.69em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mpunct">,</span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord">0</span><span class="mpunct">,</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.19em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:1em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.69em;"><span style="top:-3.69em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord text"><span class="mord">if</span></span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord">0</span><span class="mord text"><span class="mord nobreak"> </span></span><span class="mord"><span class="mord mathnormal">a</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span></span><span class="mspace nobreak"> </span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mclose">]</span><span class="mpunct">,</span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord text"><span class="mord">if</span></span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord">0</span><span class="mord">.</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.19em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mopen">(</span><span class="mord">2</span><span class="mclose">)</span></span></span></span></span></p>
<p>通过这种分箱技术，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>x</mi><mi>j</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup></mrow><annotation encoding="application/x-tex">x^{(i)}_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.4577719999999998em;vertical-align:-0.4129719999999999em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.4231360000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4129719999999999em;"><span></span></span></span></span></span></span></span></span></span> 的语义含义在来自各种测序批次的细胞间保持一致。例如，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>x</mi><mi>j</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>=</mo><mi>B</mi></mrow><annotation encoding="application/x-tex">x^{(i)}_j = B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.4577719999999998em;vertical-align:-0.4129719999999999em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.4231360000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4129719999999999em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span> 始终表示基因中的最高表达。值得注意的是，对于微调任务，我们还在值分箱步骤之前执行了<code>log1p</code>转换和高变异基因选择。为了简化表示，我们使用 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>X</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">X_{i,j}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> 来表示分箱前的原始和预处理数据矩阵。因此，<code>细胞i</code>的分箱表达值的最终输入向量表示为：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi>x</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup><mo>=</mo><mo stretchy="false">[</mo><msubsup><mi>x</mi><mn>1</mn><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup><mo separator="true">,</mo><msubsup><mi>x</mi><mn>2</mn><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup><mo separator="true">,</mo><mo>…</mo><mo separator="true">,</mo><msubsup><mi>x</mi><mi>M</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup><mo stretchy="false">]</mo><mtext>                                                              </mtext><mo stretchy="false">(</mo><mn>3</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">x^{(i)} = [x^{(i)}_1, x^{(i)}_2,…,x^{(i)}_M]~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~(3)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.938em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.338331em;vertical-align:-0.293531em;"></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.433692em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.266308em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.433692em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.266308em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">…</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.4064690000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">M</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.293531em;"><span></span></span></span></span></span></span><span class="mclose">]</span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mopen">(</span><span class="mord">3</span><span class="mclose">)</span></span></span></span></span></p>
<h4 id="条件标记"><a class="markdownIt-Anchor" href="#条件标记"></a> 条件标记</h4>
<p>条件标记包含了与各个基因相关的<code>多样化元信息</code>，比如扰动实验的改变（由扰动标记指示）。为了表示位置相关的条件标记，我们使用一个与输入基因具有相同维度的输入向量。该向量表示为：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msubsup><mi>t</mi><mi>c</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>=</mo><mo stretchy="false">[</mo><msubsup><mi>t</mi><mrow><mi>c</mi><mo separator="true">,</mo><mn>1</mn></mrow><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup><mo separator="true">,</mo><msubsup><mi>t</mi><mrow><mi>c</mi><mo separator="true">,</mo><mn>2</mn></mrow><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup><mo separator="true">,</mo><mo>…</mo><mo separator="true">,</mo><msubsup><mi>t</mi><mrow><mi>c</mi><mo separator="true">,</mo><mi>M</mi></mrow><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup><mo stretchy="false">]</mo><mtext>                                                               </mtext><mo stretchy="false">(</mo><mn>4</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">t^{(i)}_c = [t^{(i)}_{c,1},t^{(i)}_{c,2},…,t^{(i)}_{c,M}]~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~(4)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.185em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.4744389999999998em;vertical-align:-0.429639em;"></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.433692em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mpunct mtight">,</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.402416em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.433692em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mpunct mtight">,</span><span class="mord mtight">2</span></span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.402416em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">…</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.4064690000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">M</span></span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.429639em;"><span></span></span></span></span></span></span><span class="mclose">]</span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mopen">(</span><span class="mord">4</span><span class="mclose">)</span></span></span></span></span></p>
<p>其中 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>t</mi><mrow><mi>c</mi><mo separator="true">,</mo><mi>j</mi></mrow><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup></mrow><annotation encoding="application/x-tex">t^{(i)}_{c,j}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.4577719999999998em;vertical-align:-0.4129719999999999em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.4231360000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4129719999999999em;"><span></span></span></span></span></span></span></span></span></span> 表示对应于某个条件的整数索引。</p>
<h4 id="嵌入层"><a class="markdownIt-Anchor" href="#嵌入层"></a> 嵌入层</h4>
<p>我们使用常规的嵌入层（即<code>PyTorch</code>嵌入层，<a target="_blank" rel="noopener" href="https://pytorch.org/docs/stable/generated/torch.nn.Embedding.html">https://pytorch.org/docs/stable/generated/torch.nn.Embedding.html</a>）<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mtext>emb</mtext><mi>g</mi></msub></mrow><annotation encoding="application/x-tex">\text {emb}_g</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord text"><span class="mord">emb</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mtext>emb</mtext><mi>c</mi></msub></mrow><annotation encoding="application/x-tex">\text {emb}_c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord text"><span class="mord">emb</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 分别用于基因标记和条件标记，以便将每个标记映射到维度D的固定长度嵌入向量。我们使用全连接层（表示为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mtext>emb</mtext><mi>x</mi></msub></mrow><annotation encoding="application/x-tex">\text {emb}_x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord text"><span class="mord">emb</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> ）来处理分箱表达值以增强表达能力。这种选择使得对基因表达值的序数关系进行建模成为可能。因此，<code>细胞i</code>的最终嵌入<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>h</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup><mo>∈</mo><msup><mi mathvariant="normal">R</mi><mrow><mi>M</mi><mo>×</mo><mi>D</mi></mrow></msup></mrow><annotation encoding="application/x-tex">h^{(i)} ∈ ℝ^{M×D}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9270999999999999em;vertical-align:-0.0391em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8413309999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord amsrm">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">M</span><span class="mbin mtight">×</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">D</span></span></span></span></span></span></span></span></span></span></span></span> 定义为：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi>h</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup><mo>=</mo><msub><mtext>emb</mtext><mi>g</mi></msub><mo stretchy="false">(</mo><msubsup><mi>t</mi><mi>g</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup><mo stretchy="false">)</mo><mo>+</mo><msub><mtext>emb</mtext><mi>x</mi></msub><mo stretchy="false">(</mo><msup><mi>x</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup><mo stretchy="false">)</mo><mo>+</mo><msub><mtext>emb</mtext><mi>c</mi></msub><mo stretchy="false">(</mo><msubsup><mi>t</mi><mi>c</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup><mo stretchy="false">)</mo><mtext>                                </mtext><mo stretchy="false">(</mo><mn>5</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">h^{(i)} = \text {emb}_g(t^{(i)}_g) + \text {emb}_x(x^{(i)}) + \text {emb}_c(t^{(i)}_c)~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~(5)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.938em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.321108em;vertical-align:-0.383108em;"></span><span class="mord"><span class="mord text"><span class="mord">emb</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.383108em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.188em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord text"><span class="mord">emb</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.188em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord text"><span class="mord">emb</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mopen">(</span><span class="mord">5</span><span class="mclose">)</span></span></span></span></span></p>
<h3 id="细胞和基因表达建模的transformer"><a class="markdownIt-Anchor" href="#细胞和基因表达建模的transformer"></a> 细胞和基因表达建模的transformer</h3>
<h4 id="scgpt-transformer"><a class="markdownIt-Anchor" href="#scgpt-transformer"></a> scGPT transformer</h4>
<p>我们使用自注意力<code>transformer</code>来编码方程（5）中的完整输入嵌入 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>h</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup></mrow><annotation encoding="application/x-tex">h^{(i)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8879999999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span>。自注意力机制作用于M个嵌入向量序列，这使其特别适合捕获基因之间的相互作用。堆叠的<code>transformer</code>块的输出可以定义如下：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msubsup><mi>h</mi><mn>0</mn><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>=</mo><msup><mi>h</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup><mtext>                                                                                        </mtext><mo stretchy="false">(</mo><mn>6</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">h^{(i)}_0 = h^{(i)}~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~(6)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.311108em;vertical-align:-0.266308em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.433692em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.266308em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.188em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mopen">(</span><span class="mord">6</span><span class="mclose">)</span></span></span></span></span></p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msubsup><mi>h</mi><mi>l</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>=</mo><mtext>transformer</mtext><mi mathvariant="normal">_</mi><mtext>block</mtext><mo stretchy="false">(</mo><msubsup><mi>h</mi><mrow><mi>l</mi><mo>−</mo><mn>1</mn></mrow><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup><mo stretchy="false">)</mo><mtext>  </mtext><mi mathvariant="normal">∀</mi><mi>l</mi><mo>∈</mo><mo stretchy="false">[</mo><mn>1</mn><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">]</mo><mtext>                                 </mtext><mo stretchy="false">(</mo><mn>7</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">h^{(i)}_l = \text {transformer}\_\text {block}(h^{(i)}_{l-1}) ~~∀l ∈ [1,n]~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~(7)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.3461079999999999em;vertical-align:-0.3013079999999999em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.3986920000000005em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3013079999999999em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.404439em;vertical-align:-0.35963899999999993em;"></span><span class="mord text"><span class="mord">transformer</span></span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord text"><span class="mord">block</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.398692em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35963899999999993em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mord">∀</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">n</span><span class="mclose">]</span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mopen">(</span><span class="mord">7</span><span class="mclose">)</span></span></span></span></span></p>
<p>我们使用得到的表示 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>h</mi><mi>n</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>∈</mo><msup><mi>R</mi><mrow><mi>M</mi><mo separator="true">,</mo><mi>D</mi></mrow></msup></mrow><annotation encoding="application/x-tex">h^{(i)}_n \in R^{M,D}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.161392em;vertical-align:-0.11659199999999997em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.5834080000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.11659199999999997em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8413309999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">M</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">D</span></span></span></span></span></span></span></span></span></span></span></span> 来进行基因级别和细胞级别的任务。基因级别的微调目标直接应用。例如包括基因表达预测（<code>GEP</code>）目标和扰动表达预测任务（<code>perturb-GEP</code>）。对于细胞级别的任务，我们首先将 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>h</mi><mi>n</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup></mrow><annotation encoding="application/x-tex">h^{(i)}_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.161392em;vertical-align:-0.11659199999999997em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.5834080000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.11659199999999997em;"><span></span></span></span></span></span></span></span></span></span> 整合成一个细胞嵌入向量。一个例子是细胞类型分配任务，其中细胞嵌入用于通过在细胞类型分类训练目标中添加的分类器来预测细胞类型标签。</p>
<p>输入维度M可以达到数万个基因，这大大超过了自然语言生成中常用的传统<code>transformer</code>的输入长度。为了解决这个挑战并确保高效的自注意力机制，我们利用<code>FlashAttention</code>的加速自注意力实现。这种实现有效地提高了模型容量，并能够有效处理大输入维度。尽管我们采用了<code>FlashAttention</code>，但任何高效的<code>transformer</code>都可能用于<code>scGPT</code>，例如具有线性复杂度的<code>transformer</code>（<code>Linformer</code>）和<code>Kernelized Self-Attention</code>（<code>KSA</code>）。</p>
<h4 id="细胞表示"><a class="markdownIt-Anchor" href="#细胞表示"></a> 细胞表示</h4>
<p>每个细胞类似于由基因组成的&quot;句子&quot;，其表示 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>h</mi><mi>c</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>∈</mo><msup><mi mathvariant="normal">R</mi><mi>D</mi></msup></mrow><annotation encoding="application/x-tex">h^{(i)}_c ∈ ℝ^D</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.161392em;vertical-align:-0.11659199999999997em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.5834080000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.11659199999999997em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8413309999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord amsrm">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">D</span></span></span></span></span></span></span></span></span></span></span> 是通过聚合学习到的基因级别表示 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>h</mi><mi>n</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup></mrow><annotation encoding="application/x-tex">h^{(i)}_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.161392em;vertical-align:-0.11659199999999997em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.5834080000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.11659199999999997em;"><span></span></span></span></span></span></span></span></span></span> 获得的。</p>
<p>各种池化操作，如逐元素平均池化或加权池化，都可以在这种情况下轻松使用。</p>
<p>在本研究中，我们选择使用特殊标记<code>&lt;cls&gt;</code>来获取细胞表示，使模型能够在<code>transformer</code>块内学习池化操作。<code>&lt;cls&gt;</code>标记被添加到输入标记的开头，这个位置的最终嵌入被提取作为细胞表示。因此，细胞嵌入 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>h</mi><mi>c</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup></mrow><annotation encoding="application/x-tex">h^{(i)}_c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.161392em;vertical-align:-0.11659199999999997em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.5834080000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.11659199999999997em;"><span></span></span></span></span></span></span></span></span></span> 可以通过从堆叠的最终层嵌入 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>h</mi><mi>n</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup><mo stretchy="false">[</mo><mo>&lt;</mo><mi>c</mi><mi>l</mi><mi>s</mi><mo>&gt;</mo><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">h^{(i)}_n[&lt;cls&gt;]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2948em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.5834080000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.11659199999999997em;"><span></span></span></span></span></span></span><span class="mopen">[</span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.73354em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">c</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mclose">]</span></span></span></span> 中提取相应行来获得，其中 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mo>&lt;</mo><mi>c</mi><mi>l</mi><mi>s</mi><mo>&gt;</mo><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[&lt;cls&gt;]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.73354em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">c</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mclose">]</span></span></span></span> 操作检索<code>&lt;cls&gt;</code>标记位置的行。</p>
<h4 id="批次和模态的表示"><a class="markdownIt-Anchor" href="#批次和模态的表示"></a> 批次和模态的表示</h4>
<p>我们使用额外的一组标记来表示不同的测序批次和测序模态（来自<code>RNA-seq</code>的基因、来自<code>ATAC-seq</code>的峰等），特别是对于<code>scRNA-seq</code>和<code>scMultiomic</code>整合任务。这类似于输入嵌入中介绍的条件标记，并且使用标准嵌入层以类似的方式实现。模态标记 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>t</mi><mi>m</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup></mrow><annotation encoding="application/x-tex">t^{(i)}_m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.161392em;vertical-align:-0.11659199999999997em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.5834080000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.11659199999999997em;"><span></span></span></span></span></span></span></span></span></span> 与个别输入特征 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>g</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">g_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> 相关联（例如，指示它是基因、区域还是蛋白质）。批次标记最初是在细胞水平上的，但也可以传播到单个细胞的所有特征。换句话说，相同的批次标记 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>t</mi><mi>b</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup></mrow><annotation encoding="application/x-tex">t^{(i)}_b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.3461079999999999em;vertical-align:-0.30130799999999996em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.398692em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span><span style="top:-3.2197999999999998em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.30130799999999996em;"><span></span></span></span></span></span></span></span></span></span> 可以重复到单个<code>细胞i</code>的输入特征长度M：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msubsup><mi>t</mi><mi>b</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>=</mo><mo stretchy="false">[</mo><msubsup><mi>t</mi><mrow><mi>b</mi><mo separator="true">,</mo><mn>1</mn></mrow><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup><mo separator="true">,</mo><msubsup><mi>t</mi><mrow><mi>b</mi><mo separator="true">,</mo><mn>2</mn></mrow><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup><mo separator="true">,</mo><mo>…</mo><mo separator="true">,</mo><msubsup><mi>t</mi><mrow><mi>b</mi><mo separator="true">,</mo><mi>M</mi></mrow><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup><mo stretchy="false">]</mo><mo>=</mo><mo stretchy="false">[</mo><msubsup><mi>t</mi><mi>b</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup><mo separator="true">,</mo><msubsup><mi>t</mi><mi>b</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup><mo separator="true">,</mo><mo>…</mo><mo separator="true">,</mo><msubsup><mi>t</mi><mi>b</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup><mo stretchy="false">]</mo><mtext>                                 </mtext><mo stretchy="false">(</mo><mn>8</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">t^{(i)}_b = [t^{(i)}_{b,1},t^{(i)}_{b,2},…,t^{(i)}_{b,M}] = [t^{(i)}_b,t^{(i)}_b,…,t^{(i)}_b]~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~(8)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.3461079999999999em;vertical-align:-0.3013079999999999em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.3986920000000005em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3013079999999999em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.4822159999999998em;vertical-align:-0.4374159999999999em;"></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.3986920000000005em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">b</span><span class="mpunct mtight">,</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4374159999999999em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.3986920000000005em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">b</span><span class="mpunct mtight">,</span><span class="mord mtight">2</span></span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4374159999999999em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">…</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.3986920000000005em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">b</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">M</span></span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4374159999999999em;"><span></span></span></span></span></span></span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.3461079999999999em;vertical-align:-0.3013079999999999em;"></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.3986920000000005em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3013079999999999em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.3986920000000005em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3013079999999999em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">…</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.3986920000000005em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3013079999999999em;"><span></span></span></span></span></span></span><span class="mclose">]</span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mopen">(</span><span class="mord">8</span><span class="mclose">)</span></span></span></span></span></p>
<p>和批次及模态表示的区别在于，这些批次和模态嵌入并不作为输入送入转换器模块。相反，它们在进入特定的微调目标之前，要么在特征层面或者细胞层面与转换器的输出进行拼接。这样做是为了防止转换器在同一模态的特征内放大注意力，同时低估不同模态之间的注意力。</p>
<p>此外，在下游微调目标中了解模态和/或批次标识有助于基因表达建模。当模型学会基于模态和/或批次标识预测表达值时，这些偏差会从基因和细胞表示本身中被隐式地消除。这可以作为一种促进批次校正的技术。</p>
<p>比如，在<code>scMultiomic</code>整合任务中，我们将转换器输出与批次和模态嵌入的和进行拼接。这作为下游微调目标的输入用于表达建模：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msubsup><mi>h</mi><mi>n</mi><mrow><mo mathvariant="normal">′</mo><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>=</mo><mtext>concat</mtext><mo stretchy="false">(</mo><msubsup><mi>h</mi><mi>n</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup><mo separator="true">,</mo><msub><mtext>emb</mtext><mi>b</mi></msub><mo stretchy="false">(</mo><msubsup><mi>t</mi><mi>b</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup><mo stretchy="false">)</mo><mo>+</mo><msub><mtext>emb</mtext><mi>m</mi></msub><mo stretchy="false">(</mo><msubsup><mi>t</mi><mi>m</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mtext>                                 </mtext><mo stretchy="false">(</mo><mn>9</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">h^{\prime(i)}_n = \text {concat}(h^{(i)}_n, \text {emb}_b(t^{(i)}_b) + \text {emb}_m(t^{(i)}_m))~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~(9)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.185em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.3461079999999999em;vertical-align:-0.3013079999999999em;"></span><span class="mord text"><span class="mord">concat</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord text"><span class="mord">emb</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.3986920000000005em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3013079999999999em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.188em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord text"><span class="mord">emb</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">)</span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mopen">(</span><span class="mord">9</span><span class="mclose">)</span></span></span></span></span></p>
<p>其中 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mtext>emb</mtext><mi>b</mi></msub></mrow><annotation encoding="application/x-tex">\text {emb}_b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord text"><span class="mord">emb</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mtext>emb</mtext><mi>m</mi></msub></mrow><annotation encoding="application/x-tex">\text {emb}_m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord text"><span class="mord">emb</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 分别表示批次和模态嵌入层，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>h</mi><mi>n</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup></mrow><annotation encoding="application/x-tex">h^{(i)}_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.161392em;vertical-align:-0.11659199999999997em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.5834080000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.11659199999999997em;"><span></span></span></span></span></span></span></span></span></span> 表示转换器层的输出（scGPT transformer）。</p>
<p>另外，在<code>scRNA-seq</code>整合任务中，批次嵌入与细胞表示的拼接产生以下作为输入的表示：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msubsup><mi>h</mi><mi>c</mi><mrow><mo mathvariant="normal">′</mo><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>=</mo><mtext>concat</mtext><mo stretchy="false">(</mo><msubsup><mi>h</mi><mi>c</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup><mo separator="true">,</mo><msub><mtext>emb</mtext><mi>b</mi></msub><mo stretchy="false">(</mo><msubsup><mi>t</mi><mi>b</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mtext>                                                       </mtext><mo stretchy="false">(</mo><mn>10</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">h^{\prime(i)}_c = \text {concat}(h^{(i)}_c, \text {emb}_b(t^{(i)}_b))~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~(10)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.185em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.3461079999999999em;vertical-align:-0.3013079999999999em;"></span><span class="mord text"><span class="mord">concat</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord text"><span class="mord">emb</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.3986920000000005em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3013079999999999em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">)</span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mopen">(</span><span class="mord">1</span><span class="mord">0</span><span class="mclose">)</span></span></span></span></span></p>
<p>其中 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>t</mi><mi>b</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup></mrow><annotation encoding="application/x-tex">t^{(i)}_b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.3461079999999999em;vertical-align:-0.30130799999999996em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.398692em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span><span style="top:-3.2197999999999998em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.30130799999999996em;"><span></span></span></span></span></span></span></span></span></span> 表示<code>细胞i</code>的批次标识。<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>h</mi><mi>c</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup></mrow><annotation encoding="application/x-tex">h^{(i)}_c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.161392em;vertical-align:-0.11659199999999997em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.5834080000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.11659199999999997em;"><span></span></span></span></span></span></span></span></span></span>是原始细胞表示（微调目标）。需要注意的是，修改后的版本 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>h</mi><mi>c</mi><mrow><mo mathvariant="normal">′</mo><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup></mrow><annotation encoding="application/x-tex">h^{\prime(i)}_c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.161392em;vertical-align:-0.11659199999999997em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.5834080000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.11659199999999997em;"><span></span></span></span></span></span></span></span></span></span> 仅与表达建模目标相关，不适用于基于分类的目标，详见微调目标部分。</p>
<h3 id="生成式预训练"><a class="markdownIt-Anchor" href="#生成式预训练"></a> 生成式预训练</h3>
<h4 id="基础模型预训练"><a class="markdownIt-Anchor" href="#基础模型预训练"></a> 基础模型预训练</h4>
<p>基础模型被设计成一个可泛化的特征提取器，能够服务于多种下游任务。预训练中使用的标记词汇包含人类基因组中的全部基因集。在模型预训练之前，表达值被进行了分箱处理（输入嵌入）。为了加快训练速度，我们限制每个输入细胞只包含非零表达的基因。为了有效地训练模型以捕获基因-基因关系和基因-细胞关系，我们引入了一个带有特殊<code>注意力掩码</code>的生成式训练策略，具体将在下一节描述。</p>
<h4 id="用于生成式预训练的注意力掩码"><a class="markdownIt-Anchor" href="#用于生成式预训练的注意力掩码"></a> 用于生成式预训练的注意力掩码</h4>
<p>自注意力机制已被广泛用于捕获标记之间的共现模式。在自然语言处理中，这主要通过两种方式实现：</p>
<ol>
<li>
<p>掩码标记预测，用于<code>BERT</code>和<code>RoBERTa</code>等转换器编码器模型，其中输入序列中<code>随机掩码的标记</code>在模型输出中被预测；</p>
</li>
<li>
<p>在因果转换器解码器模型（如<code>OpenAI GPT</code>系列）中使用序列预测的<code>自回归生成</code>。</p>
</li>
</ol>
<p><code>OpenAI GPT-3</code>和<code>GPT-4</code>中使用的生成式预训练采用了一个统一的框架，其中模型根据由已知输入标记组成的&quot;提示&quot;来预测最可能的下一个标记。这个框架在各种自然语言生成应用中提供了极大的灵活性，并在零样本和微调设置中展示了上下文感知等能力。我们相信生成式训练同样可以以类似的方式有益于单细胞模型。具体来说，我们对两个任务感兴趣：</p>
<ol>
<li>
<p>基于已知的基因表达生成未知的基因表达值，即通过&quot;<code>基因提示</code>&quot;进行生成；</p>
</li>
<li>
<p>给定输入细胞类型条件生成全基因组表达，即通过&quot;<code>细胞提示</code>&quot;进行生成。</p>
</li>
</ol>
<p>尽管标记和提示的概念相似，但由于数据的非序列性质，对基因读数的建模本质上与自然语言不同。与句子中的单词不同，细胞内基因的顺序是可互换的，并且没有等效的&quot;下一个基因&quot;预测概念。这使得直接将<code>GPT</code>模型中的因果掩码公式应用于单细胞数据变得具有挑战性。为了解决这个挑战，我们为<code>scGPT</code>开发了一种特殊的注意力掩码机制，根据注意力分数定义预测顺序。</p>
<p>注意力掩码通常可以应用在转换器模块中的自注意力图上：对于<code>M</code>个基因标记的输入（公式(1)），第 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">l+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> 个转换器模块对其输入 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>h</mi><mi>l</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>∈</mo><msup><mi mathvariant="double-struck">R</mi><mrow><mi>M</mi><mo>×</mo><mi>D</mi></mrow></msup></mrow><annotation encoding="application/x-tex">h^{(i)}_l \in \mathbb{R}^{M\times D}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.3461079999999999em;vertical-align:-0.30130799999999996em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.398692em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span><span style="top:-3.2197999999999998em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.30130799999999996em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8413309999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord"><span class="mord mathbb">R</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">M</span><span class="mbin mtight">×</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">D</span></span></span></span></span></span></span></span></span></span></span></span> 的<code>M</code>个标记应用多头自注意力（公式(6,7)）。具体来说，每个自注意力操作计算如下：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>Q</mi><mo>=</mo><msubsup><mi>h</mi><mi>l</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup><msub><mi>W</mi><mi>q</mi></msub><mo separator="true">,</mo><mtext>   </mtext><mi>K</mi><mo>=</mo><msubsup><mi>h</mi><mi>l</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup><msub><mi>W</mi><mi>k</mi></msub><mo separator="true">,</mo><mtext>   </mtext><mi>V</mi><mo>=</mo><msubsup><mi>h</mi><mi>l</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup><msub><mi>W</mi><mi>v</mi></msub><mo separator="true">,</mo><mtext>                                              </mtext><mo stretchy="false">(</mo><mn>11</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Q = h^{(i)}_l W_q,~~~ K = h^{(i)}_l W_k,~~~ V = h^{(i)}_l W_v,~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~(11)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">Q</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.3461079999999999em;vertical-align:-0.3013079999999999em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.3986920000000005em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3013079999999999em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">q</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.3461079999999999em;vertical-align:-0.3013079999999999em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.3986920000000005em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3013079999999999em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.3461079999999999em;vertical-align:-0.3013079999999999em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.3986920000000005em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3013079999999999em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mord">1</span><span class="mclose">)</span></span></span></span></span></p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>Attention</mtext><mo stretchy="false">(</mo><mi>Q</mi><mo separator="true">,</mo><mi>K</mi><mo separator="true">,</mo><mi>V</mi><mo stretchy="false">)</mo><mo>=</mo><mtext>softmax</mtext><mo stretchy="false">(</mo><mfrac><mrow><mi>Q</mi><msup><mi>K</mi><mi>T</mi></msup></mrow><msqrt><mi>d</mi></msqrt></mfrac><mo>+</mo><msub><mi>A</mi><mrow><mi>m</mi><mi>a</mi><mi>s</mi><mi>k</mi></mrow></msub><mo stretchy="false">)</mo><mi>V</mi><mtext>                                 </mtext><mo stretchy="false">(</mo><mn>12</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\text {Attention}(Q, K, V) = \text {softmax}(\frac{QK^T}{\sqrt{d}} + A_{mask})V~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~(12)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">Attention</span></span><span class="mopen">(</span><span class="mord mathnormal">Q</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.503331em;vertical-align:-0.9850000000000001em;"></span><span class="mord text"><span class="mord">softmax</span></span><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.518331em;"><span style="top:-2.1227799999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9522200000000001em;"><span class="svg-align" style="top:-3.01em;"><span class="pstrut" style="height:3.01em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord mathnormal">d</span></span></span><span style="top:-2.90222em;"><span class="pstrut" style="height:3.01em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.09em;"><svg width='400em' height='1.09em' viewBox='0 0 400000 1090' preserveAspectRatio='xMinYMin slice'><path d='M95,712
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l4.819277108433735 -10.000000000000002
c5.3,-9.3,12,-14,20,-14
H400000v50H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M844 80h400000v50h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.10777999999999999em;"><span></span></span></span></span></span></span></span><span style="top:-3.225em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.05em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9850000000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mopen">(</span><span class="mord">1</span><span class="mord">2</span><span class="mclose">)</span></span></span></span></span></p>
<p>其中 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Q</mi><mo separator="true">,</mo><mi>K</mi><mo separator="true">,</mo><mi>V</mi><mo>∈</mo><msup><mi mathvariant="double-struck">R</mi><mrow><mi>M</mi><mo>×</mo><mi>d</mi></mrow></msup></mrow><annotation encoding="application/x-tex">Q, K, V \in \mathbb{R}^{M\times d}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">Q</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8491079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord"><span class="mord mathbb">R</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">M</span><span class="mbin mtight">×</span><span class="mord mathnormal mtight">d</span></span></span></span></span></span></span></span></span></span></span></span> 代表查询、键和值向量。<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>W</mi><mi>q</mi></msub><mo separator="true">,</mo><msub><mi>W</mi><mi>k</mi></msub><mo separator="true">,</mo><msub><mi>W</mi><mi>v</mi></msub><mo>∈</mo><msup><mi mathvariant="double-struck">R</mi><mrow><mi>D</mi><mo>×</mo><mi>d</mi></mrow></msup></mrow><annotation encoding="application/x-tex">W_q, W_k, W_v \in \mathbb{R}^{D\times d}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">q</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8491079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord"><span class="mord mathbb">R</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">D</span><span class="mbin mtight">×</span><span class="mord mathnormal mtight">d</span></span></span></span></span></span></span></span></span></span></span></span> 是可学习的权重矩阵。<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi></mrow><annotation encoding="application/x-tex">d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal">d</span></span></span></span> 是特征维度，作为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle displaystyle="true" scriptlevel="0"><mfrac><mrow><mi>Q</mi><msup><mi>K</mi><mi>T</mi></msup></mrow><msqrt><mi>d</mi></msqrt></mfrac></mstyle></mrow><annotation encoding="application/x-tex">\dfrac{QK^T}{\sqrt{d}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.503331em;vertical-align:-0.9850000000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.518331em;"><span style="top:-2.1227799999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9522200000000001em;"><span class="svg-align" style="top:-3.01em;"><span class="pstrut" style="height:3.01em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord mathnormal">d</span></span></span><span style="top:-2.90222em;"><span class="pstrut" style="height:3.01em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.09em;"><svg width='400em' height='1.09em' viewBox='0 0 400000 1090' preserveAspectRatio='xMinYMin slice'><path d='M95,712
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l4.819277108433735 -10.000000000000002
c5.3,-9.3,12,-14,20,-14
H400000v50H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M844 80h400000v50h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.10777999999999999em;"><span></span></span></span></span></span></span></span><span style="top:-3.225em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.05em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9850000000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> 中的缩放因子以维持数值稳定性。注意力掩码 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>A</mi><mrow><mi>m</mi><mi>a</mi><mi>s</mi><mi>k</mi></mrow></msub><mo>∈</mo><mo stretchy="false">{</mo><mn>0</mn><mo separator="true">,</mo><mo>−</mo><mi>inf</mi><mo>⁡</mo><msup><mo stretchy="false">}</mo><mrow><mi>M</mi><mo>×</mo><mi>M</mi></mrow></msup></mrow><annotation encoding="application/x-tex">A_{mask} \in \{0, -\inf\}^{M\times M}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.0913309999999998em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">−</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">in<span style="margin-right:0.07778em;">f</span></span><span class="mclose"><span class="mclose">}</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">M</span><span class="mbin mtight">×</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">M</span></span></span></span></span></span></span></span></span></span></span></span> 通过修改查询和键之间的原始注意力权重 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle displaystyle="true" scriptlevel="0"><mfrac><mrow><mi>Q</mi><msup><mi>K</mi><mi>T</mi></msup></mrow><msqrt><mi>d</mi></msqrt></mfrac></mstyle></mrow><annotation encoding="application/x-tex">\dfrac{QK^T}{\sqrt{d}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.503331em;vertical-align:-0.9850000000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.518331em;"><span style="top:-2.1227799999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9522200000000001em;"><span class="svg-align" style="top:-3.01em;"><span class="pstrut" style="height:3.01em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord mathnormal">d</span></span></span><span style="top:-2.90222em;"><span class="pstrut" style="height:3.01em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.09em;"><svg width='400em' height='1.09em' viewBox='0 0 400000 1090' preserveAspectRatio='xMinYMin slice'><path d='M95,712
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l4.819277108433735 -10.000000000000002
c5.3,-9.3,12,-14,20,-14
H400000v50H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M844 80h400000v50h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.10777999999999999em;"><span></span></span></span></span></span></span></span><span style="top:-3.225em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.05em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9850000000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> 来划定自注意力的范围。</p>
<blockquote>
<p><code>transformer</code>模型中的相关概念可参考这篇文章：</p>
<div class="post-link-card-wrap">
    <div class="post-link-card">
      <a href="/2024/11/04/skrzswes/" title="Transformer：Attention Is All You Need"></a>
      <div class="post-link-card-cover-wrap"><img src="/images/banner.webp" class="no-lightbox" title="Transformer：Attention Is All You Need" alt="Transformer：Attention Is All You Need"/></div>
      <div class="post-link-card-item-wrap">
        <div class="post-link-card-title">Transformer：Attention Is All You Need</div>
        <div class="post-link-card-excerpt">
# 文章链接

> Vaswani, A., Shazeer, N., Parmar, N., Uszkoreit, J., Jones, L., Gomez, A. N., Kaiser, Ł., & Polosukhin, I. (2017). Attention is all you need. Advances in neural information processing syste</div>
      </div>
    </div>
  </div>
</blockquote>
<p>具体来说，在矩阵中位置 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(i,j)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">)</span></span></span></span> 添加 <code>-inf</code> 会在 <code>softmax</code> 后使注意力权重归零，从而禁止第<code>i</code>个查询和第<code>j</code>个键之间的注意力。另一方面，添加0意味着注意力权重保持不变。这种注意力掩码技术允许模型专注于特定的上下文元素。</p>
<p>我们专门设计了<code>scGPT</code>注意力掩码，以统一的方式支持基因提示和细胞提示生成。注意力掩码 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>A</mi><mrow><mi>m</mi><mi>a</mi><mi>s</mi><mi>k</mi></mrow></msub><mo>∈</mo><mo stretchy="false">{</mo><mn>0</mn><mo separator="true">,</mo><mo>−</mo><mi>inf</mi><mo>⁡</mo><msup><mo stretchy="false">}</mo><mrow><mi>M</mi><mo>×</mo><mi>M</mi></mrow></msup></mrow><annotation encoding="application/x-tex">A_{mask} \in \{0, -\inf\}^{M\times M}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.0913309999999998em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">−</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">in<span style="margin-right:0.07778em;">f</span></span><span class="mclose"><span class="mclose">}</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">M</span><span class="mbin mtight">×</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">M</span></span></span></span></span></span></span></span></span></span></span></span> 在附图1a中进行了可视化，其中查询按行排列，键按列排列。如图底部注释所示，输入嵌入 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>h</mi><mi>l</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup></mrow><annotation encoding="application/x-tex">h^{(i)}_l</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.3461079999999999em;vertical-align:-0.30130799999999996em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.398692em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span><span style="top:-3.2197999999999998em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.30130799999999996em;"><span></span></span></span></span></span></span></span></span></span> 中的每个标记可以属于以下三组之一：</p>
<p>（1）用于细胞嵌入的保留<code>&lt;cls&gt;</code>标记（在&quot;<code>细胞表示</code>&quot;小节中介绍）；</p>
<p>（2）具有标记嵌入和表达值嵌入的已知基因；</p>
<p>（3）需要预测表达值的未知基因。</p>
<p><code>scGPT</code>注意力掩码的基本规则是只允许<code>&quot;已知基因&quot;的嵌入</code>和<code>查询基因本身</code>之间的注意力计算。这通过使用 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>A</mi><mrow><mi>m</mi><mi>a</mi><mi>s</mi><mi>k</mi></mrow></msub></mrow><annotation encoding="application/x-tex">A_{mask}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 中的元素 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">a_{i,j}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> 实现如下：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>a</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo>=</mo><mrow><mo fence="true">{</mo><mtable rowspacing="0.3599999999999999em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>0</mn><mo separator="true">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mtext>如果 </mtext><mi>j</mi><mo mathvariant="normal">∉</mo><mtext>未知基因</mtext><mo separator="true">,</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>0</mn><mo separator="true">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mtext>如果 </mtext><mi>i</mi><mo>=</mo><mi>j</mi><mtext> 且 </mtext><mi>j</mi><mo>∈</mo><mtext>未知基因</mtext><mo separator="true">,</mo><mtext>                                              </mtext><mo stretchy="false">(</mo><mn>13</mn><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mi>inf</mi><mo>⁡</mo><mo separator="true">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mtext>如果 </mtext><mi>i</mi><mo mathvariant="normal">≠</mo><mi>j</mi><mtext> 且 </mtext><mi>j</mi><mo>∈</mo><mtext>未知基因</mtext><mi mathvariant="normal">.</mi></mrow></mstyle></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">a_{i,j} = \begin{cases}
0, &amp; \text{如果 } j \notin \text{未知基因}, \\
0, &amp; \text{如果 } i = j \text{ 且 } j \in \text{未知基因}, ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~(13)\\
-\inf, &amp; \text{如果 } i \neq j \text{ 且 } j \in \text{未知基因}.
\end{cases}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:4.32em;vertical-align:-1.9099999999999997em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.35002em;"><span style="top:-2.19999em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎩</span></span></span><span style="top:-2.19499em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-2.20499em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-3.15001em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎨</span></span></span><span style="top:-4.2950099999999996em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-4.30501em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-4.60002em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎧</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.8500199999999998em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.41em;"><span style="top:-4.41em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord">0</span><span class="mpunct">,</span></span></span><span style="top:-2.97em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord">0</span><span class="mpunct">,</span></span></span><span style="top:-1.5300000000000002em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord">−</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">in<span style="margin-right:0.07778em;">f</span></span><span class="mpunct">,</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.9099999999999997em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:1em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.41em;"><span style="top:-4.41em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord text"><span class="mord cjk_fallback">如果</span><span class="mord"> </span></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel"><span class="mord"><span class="mrel">∈</span></span><span class="mord vbox"><span class="thinbox"><span class="llap"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="inner"><span class="mord"><span class="mord">/</span><span class="mspace" style="margin-right:0.05555555555555555em;"></span></span></span><span class="fix"></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord text"><span class="mord cjk_fallback">未知基因</span></span><span class="mpunct">,</span></span></span><span style="top:-2.97em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord text"><span class="mord cjk_fallback">如果</span><span class="mord"> </span></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mord text"><span class="mord"> </span><span class="mord cjk_fallback">且</span><span class="mord"> </span></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord text"><span class="mord cjk_fallback">未知基因</span></span><span class="mpunct">,</span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mord">3</span><span class="mclose">)</span></span></span><span style="top:-1.5300000000000002em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord text"><span class="mord cjk_fallback">如果</span><span class="mord"> </span></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel"><span class="mrel"><span class="mord vbox"><span class="thinbox"><span class="rlap"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="inner"><span class="mrel"></span></span><span class="fix"></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mord text"><span class="mord"> </span><span class="mord cjk_fallback">且</span><span class="mord"> </span></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord text"><span class="mord cjk_fallback">未知基因</span></span><span class="mord">.</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.9099999999999997em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>在每次生成迭代中，<code>scGPT</code>预测一组新基因的基因表达值，这些基因反过来在下一次迭代的注意力计算中成为&quot;已知基因&quot;。这种方法通过在非序列单细胞数据中进行顺序预测，反映了传统转换器解码器中带有下一个标记预测的因果掩码设计。</p>
<p>如附图1a所示，在训练期间，我们随机选择一定比例的基因作为未知基因，以便在输入中省略其表达值。注意力仅在已知基因和查询未知基因本身之间应用，而不应用于其他未知基因的位置。</p>
<p>例如，在<code>位置j</code>要预测的基因只与细胞嵌入、已知基因和它自身有注意力分数，而不与其他未知基因有注意力分数，如注意力掩码的最后一行所示。<code>scGPT</code>模型通过带有上述掩码注意力图的堆叠转换器模块来预测这些未知基因的表达。推理步骤如附图1b所示。在细胞提示生成的推理过程中，<code>scGPT</code>基于特定的细胞类型条件生成全基因组表达。在第一个位置输入代表细胞类型条件的训练好的细胞嵌入。数千个基因表达值的整个生成过程在<code>K</code>个迭代步骤中进行（例如，附图1b中的<code>K=3</code>步）。</p>
<p>例如，在第 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>∈</mo><mo stretchy="false">{</mo><mn>1</mn><mo separator="true">,</mo><mn>2</mn><mo separator="true">,</mo><mo>…</mo><mo separator="true">,</mo><mi>K</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">i \in \{1,2,\dots,K\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69862em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">…</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mclose">}</span></span></span></span> 次迭代中，注意力掩码机制允许与前面 0 到 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">i-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.74285em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> 次迭代中所有预测的基因进行注意力计算。在每次迭代中，<code>scGPT</code>从未知集合中选择预测置信度最高的前 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mn>1</mn><mi>K</mi></mfrac></mrow><annotation encoding="application/x-tex">\frac{1}{K}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.190108em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">K</span></span></span></span><span style="top:-3.225em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.05em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> 个基因，作为下一次迭代 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">i+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.74285em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> 的已知基因。</p>
<p>直观地说，这个工作流以自回归方式简化了基因表达的生成，其中首先生成预测置信度最高的基因表达值，并用于帮助后续的生成轮次。基因提示生成以类似的迭代方式工作。不同之处在于，它从一组具有观察到的表达值的已知基因开始，而不是从细胞嵌入开始。</p>
<p><code>scGPT</code>注意力掩码统一了已知基因的编码过程和未知基因的生成。它也是首批针对非序列数据进行自回归生成的转换器方案之一。</p>
<h4 id="学习目标和预训练"><a class="markdownIt-Anchor" href="#学习目标和预训练"></a> 学习目标和预训练</h4>
<p>我们使用了一个基因表达预测目标来优化模型，以预测未知基因的表达值。具体来说，我们使用<code>多层感知机</code>网络（<code>MLP</code>）来估计未知表达值并计算均方损失<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">L</mi></mrow><annotation encoding="application/x-tex">\mathcal{L}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord"><span class="mord mathcal">L</span></span></span></span></span>：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi mathvariant="script">L</mi><mo>=</mo><mfrac><mn>1</mn><mrow><mi mathvariant="normal">∣</mi><msub><mi>U</mi><mrow><mi>u</mi><mi>n</mi><mi>k</mi></mrow></msub><mi mathvariant="normal">∣</mi></mrow></mfrac><munder><mo>∑</mo><mrow><mi>j</mi><mo>∈</mo><msub><mi>U</mi><mrow><mi>u</mi><mi>n</mi><mi>k</mi></mrow></msub></mrow></munder><mo stretchy="false">(</mo><mtext>MLP</mtext><mo stretchy="false">(</mo><msubsup><mi>h</mi><mi>n</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup><mo stretchy="false">)</mo><mo>−</mo><msubsup><mi>x</mi><mi>j</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mtext>                             </mtext><mo stretchy="false">(</mo><mn>14</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\mathcal{L} = \frac{1}{|U_{unk}|} \sum_{j\in U_{unk}} (\text {MLP}(h^{(i)}_n) - x^{(i)}_j)^2~~~~~~~~~~~~~~~~~~~~~~~~~~~~~(14)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord"><span class="mord mathcal">L</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.751884em;vertical-align:-1.430444em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">∣</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span></span></span><span style="top:-3.225em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.05em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.050005em;"><span style="top:-1.8556639999999998em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">∈</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3487714285714287em;margin-left:-0.10903em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15122857142857138em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.430444em;"><span></span></span></span></span></span><span class="mopen">(</span><span class="mord text"><span class="mord">MLP</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.4577719999999998em;vertical-align:-0.412972em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.4231360000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.412972em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mopen">(</span><span class="mord">1</span><span class="mord">4</span><span class="mclose">)</span></span></span></span></span></p>
<p>其中 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>U</mi><mrow><mi>u</mi><mi>n</mi><mi>k</mi></mrow></msub></mrow><annotation encoding="application/x-tex">U_{unk}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 表示未知基因的输出位置集合，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>x</mi><mi>j</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup></mrow><annotation encoding="application/x-tex">x^{(i)}_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.4577719999999998em;vertical-align:-0.4129719999999999em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.4231360000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4129719999999999em;"><span></span></span></span></span></span></span></span></span></span>是待预测的实际基因表达值。<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∣</mi><mo>⋅</mo><mi mathvariant="normal">∣</mi></mrow><annotation encoding="application/x-tex">|\cdot|</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">∣</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">∣</span></span></span></span>操作获取集合中元素的数量。</p>
<p>如&quot;用于生成式预训练的注意力掩码&quot;小节中所述，支持基因提示和细胞提示两种生成模式。在训练过程中，这两种模式连续进行。在一个给定细胞的输入基因标记中，选择一定比例的基因作为&quot;未知&quot;基因，并省略它们的表达值。首先，在基因提示步骤中，模型的输入包含<code>&lt;cls&gt;</code>标记嵌入、已知基因嵌入和未知基因嵌入。使用模型的输出计算损失（公式(14)）。其次，在细胞提示步骤中，上一步的输出细胞嵌入（即&quot;细胞表示&quot;中的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>h</mi><mi>c</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup></mrow><annotation encoding="application/x-tex">h^{(i)}_c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.161392em;vertical-align:-0.11659199999999997em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.5834080000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.11659199999999997em;"><span></span></span></span></span></span></span></span></span></span> ）用于替换<code>&lt;cls&gt;</code>位置的嵌入。其他计算保持不变。最后，将这两个步骤的损失值加在一起，用于计算梯度以优化模型参数。</p>
<h3 id="微调目标"><a class="markdownIt-Anchor" href="#微调目标"></a> 微调目标</h3>
<p><code>scGPT</code>利用各种微调目标来促进对细胞和基因的生物学有效表示的学习，以及用于<code>批次校正</code>等正则化目的。</p>
<h4 id="基因表达预测"><a class="markdownIt-Anchor" href="#基因表达预测"></a> 基因表达预测</h4>
<p>为了促进<code>基因-基因互作</code>的学习，<code>scGPT</code>包含了基因表达预测（<code>GEP</code>）。这个微调目标的工作方式与预训练中的目标（&quot;学习目标和预训练&quot;）类似，但应用于掩码位置。具体来说，对于每个输入细胞，随机掩码一部分基因标记及其对应的表达值 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>x</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup></mrow><annotation encoding="application/x-tex">x^{(i)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8879999999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span>。<code>scGPT</code>被优化以准确预测掩码位置的表达值。这个微调目标有助于模型有效编码数据集中基因之间的共表达。该目标最小化掩码位置（表示为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="script">M</mi><mrow><mi>m</mi><mi>a</mi><mi>s</mi><mi>k</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\mathcal{M}_{mask}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord mathcal">M</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>）的均方误差。<code>GEP</code>的工作方式如下：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mover accent="true"><mi>x</mi><mo>~</mo></mover><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup><mo>=</mo><mtext>MLP</mtext><mo stretchy="false">(</mo><msubsup><mi>h</mi><mi>n</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup><mo stretchy="false">)</mo><mtext>                                                                   </mtext><mo stretchy="false">(</mo><mn>15</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\tilde{x}^{(i)} = \text {MLP}(h^{(i)}_n)~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~(15)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.938em;vertical-align:0em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6678599999999999em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">x</span></span></span><span style="top:-3.35em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.22222em;"><span class="mord">~</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.188em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">MLP</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mopen">(</span><span class="mord">1</span><span class="mord">5</span><span class="mclose">)</span></span></span></span></span></p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi mathvariant="script">L</mi><mrow><mi>G</mi><mi>E</mi><mi>P</mi></mrow></msub><mo>=</mo><mfrac><mn>1</mn><mrow><mi mathvariant="normal">∣</mi><msub><mi mathvariant="script">M</mi><mrow><mi>m</mi><mi>a</mi><mi>s</mi><mi>k</mi></mrow></msub><mi mathvariant="normal">∣</mi></mrow></mfrac><munder><mo>∑</mo><mrow><mi>j</mi><mo>∈</mo><msub><mi mathvariant="script">M</mi><mrow><mi>m</mi><mi>a</mi><mi>s</mi><mi>k</mi></mrow></msub></mrow></munder><mo stretchy="false">(</mo><msubsup><mover accent="true"><mi>x</mi><mo>~</mo></mover><mi>j</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>−</mo><msubsup><mi>x</mi><mi>j</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mtext>                                </mtext><mo stretchy="false">(</mo><mn>16</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\mathcal{L}_{GEP} = \frac{1}{|\mathcal{M}_{mask}|} \sum_{j\in \mathcal{M}_{mask}} (\tilde{x}^{(i)}_j - x^{(i)}_j)^2~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~(16)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord mathcal">L</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">G</span><span class="mord mathnormal mtight" style="margin-right:0.05764em;">E</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.751884em;vertical-align:-1.430444em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">∣</span><span class="mord"><span class="mord"><span class="mord mathcal">M</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span></span></span><span style="top:-3.225em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.05em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.050005em;"><span style="top:-1.8556639999999998em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">∈</span><span class="mord mtight"><span class="mord mtight"><span class="mord mathcal mtight">M</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3487714285714287em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15122857142857138em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.430444em;"><span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6678599999999999em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">x</span></span></span><span style="top:-3.35em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.22222em;"><span class="mord">~</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.4231360000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.412972em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.4577719999999998em;vertical-align:-0.412972em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.4231360000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.412972em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mopen">(</span><span class="mord">1</span><span class="mord">6</span><span class="mclose">)</span></span></span></span></span></p>
<p>这里，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mover accent="true"><mi>x</mi><mo>~</mo></mover><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup><mo>∈</mo><msup><mi mathvariant="double-struck">N</mi><mi>M</mi></msup></mrow><annotation encoding="application/x-tex">\tilde{x}^{(i)} \in \mathbb{N}^M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9270999999999999em;vertical-align:-0.0391em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6678599999999999em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">x</span></span></span><span style="top:-3.35em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.22222em;"><span class="mord">~</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8413309999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord"><span class="mord mathbb">N</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">M</span></span></span></span></span></span></span></span></span></span></span>表示<code>细胞i</code>的表达估计行。值得注意的是，如果提供了测序批次或模态条件，我们使用公式(9)中的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>h</mi><mi>n</mi><mrow><mo mathvariant="normal">′</mo><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup></mrow><annotation encoding="application/x-tex">h^{\prime(i)}_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.161392em;vertical-align:-0.11659199999999997em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.5834080000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.11659199999999997em;"><span></span></span></span></span></span></span></span></span></span> 而不是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>h</mi><mi>n</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup></mrow><annotation encoding="application/x-tex">h^{(i)}_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.161392em;vertical-align:-0.11659199999999997em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.5834080000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.11659199999999997em;"><span></span></span></span></span></span></span></span></span></span>。</p>
<p><code>GEP</code>提供了一个通用的自监督微调目标，旨在预测基因表达值。在某些下游任务中，例如扰动预测，模型需要预测扰动后的基因表达值而不是原始值。我们将这种变体称为<code>perturb-GEP</code>。我们保留公式(15)和公式(16)中的<code>MLP</code>估计器，但使用扰动后的基因表达作为目标 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>x</mi><mi>j</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup></mrow><annotation encoding="application/x-tex">x^{(i)}_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.4577719999999998em;vertical-align:-0.4129719999999999em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.4231360000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4129719999999999em;"><span></span></span></span></span></span></span></span></span></span>。在<code>perturb-GEP</code>中，模型应该预测所有输入基因的扰动后表达。</p>
<h4 id="用于细胞建模的基因表达预测"><a class="markdownIt-Anchor" href="#用于细胞建模的基因表达预测"></a> 用于细胞建模的基因表达预测</h4>
<p>这个微调目标的操作方式与<code>GEP</code>类似，但基于细胞表示 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>h</mi><mi>c</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup></mrow><annotation encoding="application/x-tex">h^{(i)}_c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.161392em;vertical-align:-0.11659199999999997em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.5834080000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.11659199999999997em;"><span></span></span></span></span></span></span></span></span></span> 预测基因表达值，以明确促进细胞表示学习。对于输入<code>细胞i</code>中的每个<code>基因j</code>，我们创建一个查询向量 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>q</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">q_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>，并使用 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>q</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">q_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> 和细胞表示 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>h</mi><mi>c</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup></mrow><annotation encoding="application/x-tex">h^{(i)}_c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.161392em;vertical-align:-0.11659199999999997em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.5834080000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.11659199999999997em;"><span></span></span></span></span></span></span></span></span></span> 的参数化内积作为预测的表达值：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi mathvariant="bold">q</mi><mi>j</mi></msub><mo>=</mo><mtext>MLP</mtext><mo stretchy="false">(</mo><msub><mtext>emb</mtext><mi>g</mi></msub><mo stretchy="false">(</mo><msubsup><mi>t</mi><mi>g</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mtext>                                                             </mtext><mo stretchy="false">(</mo><mn>17</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\mathbf q_j = \text {MLP}(\text {emb}_g(t^{(i)}_g))~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~(17)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.730548em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathbf">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.321108em;vertical-align:-0.383108em;"></span><span class="mord text"><span class="mord">MLP</span></span><span class="mopen">(</span><span class="mord"><span class="mord text"><span class="mord">emb</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.383108em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">)</span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mopen">(</span><span class="mord">1</span><span class="mord">7</span><span class="mclose">)</span></span></span></span></span></p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msubsup><mover accent="true"><mi>x</mi><mo>~</mo></mover><mi>j</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>=</mo><msub><mi mathvariant="bold">q</mi><mi>j</mi></msub><mo>⋅</mo><msubsup><mrow><mi mathvariant="bold">W</mi><mi mathvariant="bold">h</mi></mrow><mi>c</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup><mtext>                                                                      </mtext><mo stretchy="false">(</mo><mn>18</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\tilde{x}^{(i)}_j = \mathbf q_j \cdot \mathbf {Wh}^{(i)}_c~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~(18)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.4577719999999998em;vertical-align:-0.412972em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6678599999999999em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">x</span></span></span><span style="top:-3.35em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.22222em;"><span class="mord">~</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.4231360000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.412972em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.730558em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathbf">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.22234em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">W</span><span class="mord mathbf">h</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9723399999999999em;"><span style="top:-2.4530000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span><span style="top:-3.14734em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mopen">(</span><span class="mord">1</span><span class="mord">8</span><span class="mclose">)</span></span></span></span></span></p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi mathvariant="script">L</mi><mtext>GEPC</mtext></msub><mo>=</mo><mfrac><mn>1</mn><mrow><mi mathvariant="normal">∣</mi><msub><mi mathvariant="script">M</mi><mrow><mi>m</mi><mi>a</mi><mi>s</mi><mi>k</mi></mrow></msub><mi mathvariant="normal">∣</mi></mrow></mfrac><munder><mo>∑</mo><mrow><mi>j</mi><mo>∈</mo><msub><mi mathvariant="script">M</mi><mrow><mi>m</mi><mi>a</mi><mi>s</mi><mi>k</mi></mrow></msub></mrow></munder><mo stretchy="false">(</mo><msubsup><mover accent="true"><mi>x</mi><mo>~</mo></mover><mi>j</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>−</mo><msubsup><mi>x</mi><mi>j</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mtext>                                 </mtext><mo stretchy="false">(</mo><mn>19</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\mathcal{L}_{\text{GEPC}} = \frac{1}{|\mathcal{M}_{mask}|} \sum_{j\in \mathcal{M}_{mask}} (\tilde{x}^{(i)}_j - x^{(i)}_j)^2~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~(19)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord mathcal">L</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">GEPC</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.751884em;vertical-align:-1.430444em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">∣</span><span class="mord"><span class="mord"><span class="mord mathcal">M</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span></span></span><span style="top:-3.225em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.05em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.050005em;"><span style="top:-1.8556639999999998em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">∈</span><span class="mord mtight"><span class="mord mtight"><span class="mord mathcal mtight">M</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3487714285714287em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15122857142857138em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.430444em;"><span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6678599999999999em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">x</span></span></span><span style="top:-3.35em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.22222em;"><span class="mord">~</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.4231360000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.412972em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.4577719999999998em;vertical-align:-0.412972em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.4231360000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.412972em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mopen">(</span><span class="mord">1</span><span class="mord">9</span><span class="mclose">)</span></span></span></span></span></p>
<p>用于细胞建模的<code>GEP</code>（<code>GEPC</code>）继承了公式(5)中的基因标记嵌入 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mi>m</mi><msub><mi>b</mi><mi>g</mi></msub><mo stretchy="false">(</mo><msubsup><mi>t</mi><mi>g</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">emb_g(t^{(i)}_g)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.330908em;vertical-align:-0.286108em;"></span><span class="mord mathnormal">e</span><span class="mord mathnormal">m</span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.5834080000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2526999999999999em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>。在整合任务中，我们使用公式(10)中的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>h</mi><mi>c</mi><mrow><mo mathvariant="normal">′</mo><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup></mrow><annotation encoding="application/x-tex">h_c^{\prime(i)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.161392em;vertical-align:-0.11659199999999997em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.5834080000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.11659199999999997em;"><span></span></span></span></span></span></span></span></span></span> 而不是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>h</mi><mi>c</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup></mrow><annotation encoding="application/x-tex">h^{(i)}_c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.161392em;vertical-align:-0.11659199999999997em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.5834080000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.11659199999999997em;"><span></span></span></span></span></span></span></span></span></span>。在我们的实验中，我们观察到将<code>GEP</code>和<code>GEPC</code>结合使用与单独使用任一方法相比，性能有显著提升。</p>
<h4 id="弹性细胞相似度"><a class="markdownIt-Anchor" href="#弹性细胞相似度"></a> 弹性细胞相似度</h4>
<p>这个微调目标通过使用<code>相似度学习损失</code>来增强细胞表示：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi mathvariant="script">L</mi><mtext>ECS</mtext></msub><mo>=</mo><mo>−</mo><mo stretchy="false">(</mo><mtext>sim</mtext><mo stretchy="false">(</mo><msubsup><mi mathvariant="bold">h</mi><mi>c</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup><mo separator="true">,</mo><msubsup><mi mathvariant="bold">h</mi><mi>c</mi><mrow><mo stretchy="false">(</mo><msup><mi>i</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo stretchy="false">)</mo></mrow></msubsup><mo stretchy="false">)</mo><mo>−</mo><mi>β</mi><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mtext>                                               </mtext><mo stretchy="false">(</mo><mn>20</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\mathcal{L}_{\text {ECS}} = -(\text {sim}(\mathbf h^{(i)}_c, \mathbf h^{(i&#x27;)}_c) - \beta)^2~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~(20)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord mathcal">L</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">ECS</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.24248em;vertical-align:-0.25em;"></span><span class="mord">−</span><span class="mopen">(</span><span class="mord text"><span class="mord">sim</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathbf">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathbf">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.99248em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8278285714285715em;"><span style="top:-2.931em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.1141079999999999em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mopen">(</span><span class="mord">2</span><span class="mord">0</span><span class="mclose">)</span></span></span></span></span></p>
<p>其中 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>sim</mtext></mrow><annotation encoding="application/x-tex">\text {sim}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66786em;vertical-align:0em;"></span><span class="mord text"><span class="mord">sim</span></span></span></span></span> 表示余弦相似度函数，而 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathnormal">i</span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>i</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow><annotation encoding="application/x-tex">i&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.751892em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal">i</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span> 指的是小批量内的两个细胞。此外，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>β</mi></mrow><annotation encoding="application/x-tex">β</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span></span></span></span> 表示预定义的阈值，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>ECS</mtext></mrow><annotation encoding="application/x-tex">\text {ECS}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord text"><span class="mord">ECS</span></span></span></span></span> 是弹性细胞相似度。这种方法的基本思想是增强相似度值高于 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>β</mi></mrow><annotation encoding="application/x-tex">β</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span></span></span></span> 的配对之间的相似性，从而使它们更加相似。相反，不相似的配对则被鼓励进一步分开。</p>
<h4 id="通过反向反向传播进行域适应"><a class="markdownIt-Anchor" href="#通过反向反向传播进行域适应"></a> 通过反向反向传播进行域适应</h4>
<p>由于测序技术引入的非生物学批次差异导致的批次效应，会妨碍细胞表示的学习。为了缓解这个问题，我们使用一个独特的<code>MLP</code>分类器来预测每个输入细胞的测序批次（基于它们的细胞表示 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>h</mi><mi>c</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup></mrow><annotation encoding="application/x-tex">h^{(i)}_c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.161392em;vertical-align:-0.11659199999999997em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.5834080000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.11659199999999997em;"><span></span></span></span></span></span></span></span></span></span>），并通过在模型内反转梯度来修改反向传播过程。这种方法借鉴了<code>Ganin</code>和<code>Lempitsky</code>提出的鲁棒域适应方法的见解。</p>
<h4 id="细胞类型分类"><a class="markdownIt-Anchor" href="#细胞类型分类"></a> 细胞类型分类</h4>
<p>这个微调目标旨在利用学习到的细胞表示来注释单细胞。我们使用一个单独的<code>MLP</code>分类器从细胞表示 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>h</mi><mi>c</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup></mrow><annotation encoding="application/x-tex">h^{(i)}_c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.161392em;vertical-align:-0.11659199999999997em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.5834080000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.11659199999999997em;"><span></span></span></span></span></span></span></span></span></span> 中预测细胞类型。这个微调目标通过预测的细胞类型概率和真实标签之间的交叉熵损失<code>ce</code>进行优化。</p>
<h3 id="下游任务的微调"><a class="markdownIt-Anchor" href="#下游任务的微调"></a> 下游任务的微调</h3>
<h4 id="细胞类型注释"><a class="markdownIt-Anchor" href="#细胞类型注释"></a> 细胞类型注释</h4>
<p>对于<code>细胞类型注释</code>任务，我们在具有真实标签的参考集上对模型进行微调，并在保留的查询集上验证注释性能。保留预训练基础模型和参考集之间的共同基因标记集。在模型微调之前，基因表达值经过归一化、对数转换和分箱处理。除了输出细胞类型分类器（随机初始化）外，所有预训练模型权重都用于初始化微调模型。在训练中使用所有具有零和非零表达值的基因标记。使用细胞类型分类微调目标来最小化分类损失。</p>
<h4 id="基因扰动响应预测"><a class="markdownIt-Anchor" href="#基因扰动响应预测"></a> 基因扰动响应预测</h4>
<p>为了针对扰动预测任务进行微调，我们在模型训练前选择了<code>高变异基因</code>并对表达值进行了预处理。嵌入层和<code>transformer层</code>的参数从预训练模型中初始化。在微调过程中，包含了所有零值和非零值表达的基因标记。针对扰动预测任务的输入进行了两个显著的改变：</p>
<p>首先，我们使用了<code>log1p转换</code>后的表达值作为输入和目标值，而不是分箱值，以更好地预测扰动后的绝对表达；其次，我们在每个输入基因位置添加了二元条件标记，以指示该基因是否被扰动。</p>
<p>我们采用了<code>perturb-GEP</code>微调目标，并对训练设置进行了进一步修改。不同于使用同一细胞的遮罩和未遮罩表达值作为输入和学习目标，我们使用对照细胞作为输入，扰动细胞作为目标。这是通过将每个扰动细胞与随机配对的非扰动对照细胞构建输入-目标对来实现的。输入值包含了对照细胞中所有基因的表达值。因此，模型学会了基于对照基因表达和扰动标记来预测扰动后的反应。</p>
<h4 id="整合多个scrna-seq数据集的批次校正"><a class="markdownIt-Anchor" href="#整合多个scrna-seq数据集的批次校正"></a> 整合多个scRNA-seq数据集的批次校正</h4>
<p>当输入原始计数矩阵包含来自不同测序批次或技术的多个数据集时，批次效应可能是细胞类型聚类中的一个主要混淆因素。因此，在整合多个<code>scRNA-seq</code>数据集时，我们的目标是在保持生物学差异的同时校正批次效应。对于这个整合任务的微调，我们保留了预训练基础模型和当前数据集之间的共同基因标记集。我们进一步从共同集中选择了一部分<code>HVGs</code>作为输入。我们在模型训练前对表达值进行了预处理，类似于细胞类型注释任务。所有预训练模型权重都被用来初始化微调模型。默认情况下，训练中使用了所有具有零值和非零表达值的基因标记。除了<code>GEP</code>和<code>GEPC</code>之外，<code>ECS</code>、通过反向传播的域适应（<code>DAR</code>）和<code>DSBN</code>微调目标被同时优化，通过反向传播和特定域归一化来增强细胞对比学习和显式批次校正。</p>
<h4 id="scmultiomic数据的整合表示学习"><a class="markdownIt-Anchor" href="#scmultiomic数据的整合表示学习"></a> scMultiomic数据的整合表示学习</h4>
<p><code>scMultiomic</code>数据可能在实验批次间包含不同的测序模态。我们研究了<code>scMultiomic</code>数据的两种数据整合设置：配对设置（<code>paired</code>）和镶嵌设置（<code>mosaic</code>）。</p>
<p>在<code>配对设置</code>中，所有样本（细胞）共享所有测序的数据模态。在<code>镶嵌设置</code>中，一些批次共享少数共同的数据模态，但不是全部。由于存在额外的<code>ATAC</code>（和/或）蛋白质标记，我们仅继承了RNA数据的训练基因嵌入，并从头开始训练额外的标记嵌入和模型的其余部分。如果数据集包含额外的蛋白质数据，训练中仅使用非零表达值的标记。否则，默认情况下使用零值和非零表达值。我们使用了一组额外的模态标记来指示每个标记的数据类型（即基因、区域或蛋白质），并促进<code>GEP</code>和<code>GEPC</code>微调目标中的掩蔽基因和值预测。默认情况下，模型使用<code>GEP</code>和<code>GEPC</code>微调目标进行优化。如果存在多个批次，则包含<code>DAR</code>以促进多模态批次校正。</p>
<h4 id="基因调控网络推断"><a class="markdownIt-Anchor" href="#基因调控网络推断"></a> 基因调控网络推断</h4>
<p>对于图5中基于基因嵌入的<code>GRN</code>推断，在零样本设置中，我们基于<code>k-最近邻</code>从<code>scGPT</code>的预训练基因嵌入构建了基因相似性网络。在微调设置中，我们以类似的方式从在人类免疫数据集上微调的<code>scGPT</code>模型构建了基因相似性网络。我们进一步对相似性图进行了<code>Leiden</code>聚类，并从包含五个或更多基因的基因簇中提取基因程序。</p>
<p>对于图6中基于注意力的目标基因选择，我们在Adamson扰动数据集上微调了<code>scGPT</code>血液模型，该数据集包含了在白血病细胞系上进行的<code>87个CRISPR</code>干扰实验。我们在图6a中展示了目标基因选择流程。对于每个感兴趣的扰动基因，我们首先通过分别输入扰动和对照细胞集，获得了两组注意力图谱（扰动组和对照组）。</p>
<p>注意，原始注意力分数是从模型最后一个注意力层的所有8个注意力头中获得的。原始注意力分数随后经过两轮秩归一化，先按行后按列进行。然后对8个注意力头的秩归一化注意力分数进行平均，得到一个聚合注意力图谱。这就得到了用于最受影响基因选择的最终注意力图谱。对于每个感兴趣的扰动基因，我们通过对扰动基因所在列中的最终注意力图谱中的分数进行排序来选择其最受影响的基因。这反映了注意力图谱中的列表示感兴趣的基因对其他基因的影响程度这一直觉。我们提供了三种最受影响基因选择设置：来自对照注意力图谱的&quot;对照&quot;、来自扰动注意力图谱的&quot;扰动&quot;以及两者之差的&quot;差异&quot;。从对照注意力图谱选择的基因靶标应反映感兴趣基因参与的基础通路，而扰动注意力图谱则反映扰动后的效应。这两个注意力图谱之间的差异应突出显示从扰动前到扰动后基因网络中发生最大变化的边。</p>
<p>同样地，对于涉及多个转录因子的扩展注意力基因相互作用预测（补充说明7），我们在<code>Replogle</code>数据子集上微调了<code>scGPT</code>血液模型，并报告了来自&quot;扰动&quot;设置的最受影响基因。</p>
<h3 id="数据集"><a class="markdownIt-Anchor" href="#数据集"></a> 数据集</h3>
<h4 id="cellxgene-scrna-seq集合"><a class="markdownIt-Anchor" href="#cellxgene-scrna-seq集合"></a> CELLxGENE scRNA-seq集合</h4>
<p>我们从<code>CELLxGENE</code>门户网站（<a target="_blank" rel="noopener" href="https://cellxgene.cziscience.com/">https://cellxgene.cziscience.com/</a>）使用<code>Census API</code>收集了用于整个人类基础模型预训练的数据（<code>Census API</code>可在 <a target="_blank" rel="noopener" href="https://chanzuckerberg.github.io/cellxgene-census/python-api.html">https://chanzuckerberg.github.io/cellxgene-census/python-api.html</a> 获取，它定期托管和更新在线数据发布。我们使用了2023年5月15日的发布版本）。我们包含了<code>scRNA-seq</code>和<code>snRNA-seq</code>的测序协议，并过滤出没有疾病状况的样本。这最终得到了<code>3300万</code>个细胞的测序数据。</p>
<p>特别地，为了预训练<code>scGPT</code>血液模型，我们从<code>CELLxGENE</code>（<a target="_blank" rel="noopener" href="https://cellxgene.cziscience.com/">https://cellxgene.cziscience.com/</a>）获取了超过<code>1030万</code>个人类血液和骨髓<code>scRNA-seq</code>样本。通过对生物体（即<code>Homo sapiens</code>）、组织（即血液、骨髓）和疾病（即正常、<code>COVID-19</code>、流感）进行过滤，从<code>CELLxGENE</code>中总共收集了<code>65</code>个数据集。此外，我们收集了<code>570万</code>个各种癌症类型的细胞来训练泛癌症模型。</p>
<h4 id="多发性硬化症"><a class="markdownIt-Anchor" href="#多发性硬化症"></a> 多发性硬化症</h4>
<p><code>MS</code>数据集从<code>EMBL-EBI</code>（<a target="_blank" rel="noopener" href="https://www.ebi.ac.uk/gxa/sc/experiments/E-HCAD-35">https://www.ebi.ac.uk/gxa/sc/experiments/E-HCAD-35</a>）获取。数据集包含了9个健康对照样本和12个MS样本。我们将对照样本划分用于模型微调的参考集，并将MS样本作为查询集用于评估。这个设置作为分布外数据的示例。我们排除了三种细胞类型：<code>B细胞</code>、<code>T细胞</code>和<code>少突胶质前体细胞</code>，这些细胞类型仅存在于查询数据集中。最终的细胞数量在训练参考集中为<code>7,844</code>个，在查询集中为<code>13,468</code>个。使用原始发表文献中提供的细胞类型标签作为评估的真实标签。数据处理协议涉及选择<code>HVGs</code>以保留<code>3,000</code>个基因。</p>
<h4 id="骨髓样细胞"><a class="markdownIt-Anchor" href="#骨髓样细胞"></a> 骨髓样细胞</h4>
<p>骨髓样数据集可从基因表达综合数据库（<code>GEO</code>）使用登录号 <a target="_blank" rel="noopener" href="http://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE154763">GSE154763</a> 获取。该数据集包含九种不同的癌症类型，但为了训练和评估模型，六种癌症类型被选作参考集用于训练，而三种癌症类型用作查询集。参考集包含骨髓癌症类型<code>UCEC</code>、<code>PAAD</code>、<code>THCA</code>、<code>LYM</code>、<code>cDC2</code>和<code>kidney</code>，而查询集包含<code>MYE</code>、<code>OV-FTC</code>和<code>ESCA</code>。数据集也进行了随机抽样。最终的细胞数量在参考集中为<code>9,748</code>个，在查询集中为<code>3,430</code>个。在数据处理过程中选择了<code>3,000</code>个<code>HVGs</code>。</p>
<h4 id="人胰腺"><a class="markdownIt-Anchor" href="#人胰腺"></a> 人胰腺</h4>
<p>人胰腺数据集包含来自五个人胰腺细胞<code>scRNA-seq</code>研究的数据，这些数据由Chen<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mrow></mrow><mrow><mo stretchy="false">[</mo><mn>31</mn><mo stretchy="false">]</mo></mrow></msup></mrow><annotation encoding="application/x-tex">^{[31]}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8879999999999999em;vertical-align:0em;"></span><span class="mord"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">[</span><span class="mord mtight">3</span><span class="mord mtight">1</span><span class="mclose mtight">]</span></span></span></span></span></span></span></span></span></span></span></span>等人重新处理用于细胞类型注释任务。这五个数据集按数据来源分为参考集和查询集。参考集包含来自两个数据源的数据，查询集包含其他三个数据源的数据。参考集和查询集都保留了<code>3,000</code>个基因和来自原始发表文献的真实注释。参考集包含<code>13</code>个细胞群的<code>10,600</code>个细胞（<code>alpha</code>、<code>beta</code>、<code>导管</code>、<code>腺泡</code>、<code>delta</code>、<code>胰腺星状</code>、<code>胰腺多肽</code>、<code>内皮</code>、<code>巨噬细胞</code>、<code>肥大细胞</code>、<code>epsilon</code>、<code>施旺细胞</code>和<code>T细胞</code>）。查询集包含<code>11</code>个细胞群的<code>4,218</code>个细胞（<code>alpha</code>、<code>beta</code>、<code>导管</code>、<code>胰腺多肽</code>、<code>腺泡</code>、<code>delta</code>、<code>胰腺星状</code>、<code>内皮</code>、<code>epsilon</code>、<code>肥大细胞</code>和<code>MHC II类</code>）。</p>
<h4 id="pbmc-10k"><a class="markdownIt-Anchor" href="#pbmc-10k"></a> PBMC 10k</h4>
<p><code>PBMC 10k</code>数据集包括来自一位健康供体的两批<code>scRNA-seq</code>人类外周血单个核细胞。该数据集由Gayoso<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mrow></mrow><mrow><mo stretchy="false">[</mo><mn>41</mn><mo stretchy="false">]</mo></mrow></msup></mrow><annotation encoding="application/x-tex">^{[41]}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8879999999999999em;vertical-align:0em;"></span><span class="mord"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">[</span><span class="mord mtight">4</span><span class="mord mtight">1</span><span class="mclose mtight">]</span></span></span></span></span></span></span></span></span></span></span></span>等人重新处理，得到<code>3,346</code>个差异表达基因。第一批包含<code>7,982</code>个细胞，第二批包含<code>4,008</code>个细胞。使用<code>Seurat</code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mrow></mrow><mrow><mo stretchy="false">[</mo><mn>39</mn><mo stretchy="false">]</mo></mrow></msup></mrow><annotation encoding="application/x-tex">^{[39]}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8879999999999999em;vertical-align:0em;"></span><span class="mord"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">[</span><span class="mord mtight">3</span><span class="mord mtight">9</span><span class="mclose mtight">]</span></span></span></span></span></span></span></span></span></span></span></span>注释的细胞群包括九个类别，即<code>B细胞</code>、<code>CD4+ T细胞</code>、<code>CD8+ T细胞</code>、<code>CD14+单核细胞</code>、<code>树突状细胞</code>、<code>NK细胞</code>、<code>FCGR3A+单核细胞</code>、<code>巨核细胞</code>和其他。</p>
<h4 id="人类免疫"><a class="markdownIt-Anchor" href="#人类免疫"></a> 人类免疫</h4>
<p>人类免疫数据集包括五个<code>scRNA-seq</code>数据集：一个来自人类骨髓，四个来自人类外周血。使用了各种测序技术，包括<code>10x Genomics</code>、<code>10x Genomics (v.2)</code>、<code>10x Genomics (v.3)</code>和<code>Smart-seq2</code>。该数据集总共包含<code>33,506</code>个细胞和<code>12,303</code>个基因。根据供体来源定义了十个不同的批次。协调后的数据包含<code>16</code>个细胞群。我们使用了由Luecken<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mrow></mrow><mrow><mo stretchy="false">[</mo><mn>50</mn><mo stretchy="false">]</mo></mrow></msup></mrow><annotation encoding="application/x-tex">^{[50]}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8879999999999999em;vertical-align:0em;"></span><span class="mord"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">[</span><span class="mord mtight">5</span><span class="mord mtight">0</span><span class="mclose mtight">]</span></span></span></span></span></span></span></span></span></span></span></span>等人重新处理的数据和注释。</p>
<h4 id="近嗅皮层perirhinal-cortex"><a class="markdownIt-Anchor" href="#近嗅皮层perirhinal-cortex"></a> 近嗅皮层（Perirhinal cortex）</h4>
<p>近嗅皮层数据集包括两个不同的样本，取自Siletti<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mrow></mrow><mrow><mo stretchy="false">[</mo><mn>42</mn><mo stretchy="false">]</mo></mrow></msup></mrow><annotation encoding="application/x-tex">^{[42]}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8879999999999999em;vertical-align:0em;"></span><span class="mord"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">[</span><span class="mord mtight">4</span><span class="mord mtight">2</span><span class="mclose mtight">]</span></span></span></span></span></span></span></span></span></span></span></span>等人的一项更大规模研究，该研究最初包含<code>606</code>个高质量样本，涵盖十个不同的脑区。从近嗅皮层数据集选取的两个批次都包含大量细胞，第一批包含<code>8,465</code>个细胞，第二批包含<code>9,070</code>个细胞。这些数据集包含了范围广泛的<code>59,357</code>个基因。我们使用了原始研究中提供的十种独特细胞类型的注释。</p>
<h4 id="covid-19"><a class="markdownIt-Anchor" href="#covid-19"></a> COVID-19</h4>
<p><code>COVID-19</code>数据集来源于Lotfollahi<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mrow></mrow><mrow><mo stretchy="false">[</mo><mn>12</mn><mo stretchy="false">]</mo></mrow></msup></mrow><annotation encoding="application/x-tex">^{[12]}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8879999999999999em;vertical-align:0em;"></span><span class="mord"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">[</span><span class="mord mtight">1</span><span class="mord mtight">2</span><span class="mclose mtight">]</span></span></span></span></span></span></span></span></span></span></span></span>等人的工作，分为<code>18</code>个不同的批次，包含来自肺组织、<code>PBMCs</code>和骨髓的多样化细胞。该数据集最初包含<code>274,346</code>个细胞和<code>18,474</code>个基因，为了本研究的目的，已被抽样至总共<code>20,000</code>个细胞。我们使用了原始研究提供的注释。对于参考映射评估，我们随机选择了<code>12</code>个样本批次作为参考数据集，另外<code>6</code>个批次作为查询数据集。最终的参考数据集包含<code>15,997</code>个细胞，查询数据集包含<code>4,003</code>个细胞。</p>
<h4 id="adamson"><a class="markdownIt-Anchor" href="#adamson"></a> Adamson</h4>
<p>Adamson扰动数据集包含通过<code>Perturb-seq</code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mrow></mrow><mrow><mo stretchy="false">[</mo><mn>33</mn><mo stretchy="false">]</mo></mrow></msup></mrow><annotation encoding="application/x-tex">^{[33]}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8879999999999999em;vertical-align:0em;"></span><span class="mord"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">[</span><span class="mord mtight">3</span><span class="mord mtight">3</span><span class="mclose mtight">]</span></span></span></span></span></span></span></span></span></span></span></span>扰动的<code>K562</code>白血病细胞系的基因表达数据。该数据集包括<code>87</code>个独特的单基因<code>CRISPR</code>干扰扰动，每个扰动在大约<code>100</code>个细胞中重复。</p>
<h4 id="norman"><a class="markdownIt-Anchor" href="#norman"></a> Norman</h4>
<p>Norman扰动数据集包含通过<code>Perturb-seq</code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mrow></mrow><mrow><mo stretchy="false">[</mo><mn>35</mn><mo stretchy="false">]</mo></mrow></msup></mrow><annotation encoding="application/x-tex">^{[35]}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8879999999999999em;vertical-align:0em;"></span><span class="mord"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">[</span><span class="mord mtight">3</span><span class="mord mtight">5</span><span class="mclose mtight">]</span></span></span></span></span></span></span></span></span></span></span></span>扰动的<code>K562</code>白血病细胞系的基因表达数据。该数据集有<code>131</code>个双基因扰动和<code>105</code>个单基因扰动。每个扰动在约<code>300-700</code>个细胞中重复。</p>
<h4 id="replogle"><a class="markdownIt-Anchor" href="#replogle"></a> Replogle</h4>
<p>Replogle扰动数据集包含对<code>K562</code>白血病细胞系进行<code>CRISPR</code>干扰<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mrow></mrow><mrow><mo stretchy="false">[</mo><mn>34</mn><mo stretchy="false">]</mo></mrow></msup></mrow><annotation encoding="application/x-tex">^{[34]}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8879999999999999em;vertical-align:0em;"></span><span class="mord"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">[</span><span class="mord mtight">3</span><span class="mord mtight">4</span><span class="mclose mtight">]</span></span></span></span></span></span></span></span></span></span></span></span>的全基因组扰动。考虑到数据质量，我们保留了与原始研究中识别的<code>1,973</code>个具有强转录表型扰动相匹配的数据子集。我们还删除了<code>150</code>个在测序数据中没有扰动基因表达记录的扰动。我们进一步为每个扰动保留了<code>100</code>个样本和<code>2,500</code>个对照样本。处理后的完整数据集包括来自<code>1,823</code>个扰动的<code>171,542</code>个样本，其中<code>99</code>个是转录因子的扰动。测试集包括<code>456</code>个扰动，其中<code>25</code>个是转录因子的扰动。</p>
<h4 id="multiome-pbmc"><a class="markdownIt-Anchor" href="#multiome-pbmc"></a> Multiome PBMC</h4>
<p><a target="_blank" rel="noopener" href="https://support.10xgenomics.com/single-cell-multiome-atac-gex/datasets/1.0.0/pbmc_granulocyte_sorted_10k">10x Multiome PBMC</a> 数据集包含来自人类<code>PBMC</code>细胞的配对单细胞<code>RNA</code>和<code>ATAC</code>数据，这些数据是通过<code>10x Single Cell Multiome</code>协议测序获得的。在该数据集中，所有样本都来自同一位健康供体。每个细胞都具有基因表达和染色质可及性测量。处理后的数据<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mrow></mrow><mrow><mo stretchy="false">[</mo><mn>13</mn><mo stretchy="false">]</mo></mrow></msup></mrow><annotation encoding="application/x-tex">^{[13]}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8879999999999999em;vertical-align:0em;"></span><span class="mord"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">[</span><span class="mord mtight">1</span><span class="mord mtight">3</span><span class="mclose mtight">]</span></span></span></span></span></span></span></span></span></span></span></span>来自<code>9,631</code>个细胞，包含来自<code>29,095</code>个基因和<code>107,194</code>个染色质区域的读数计数。注释包括<code>19</code>个细胞群（<code>CD14+单核细胞</code>、<code>CD16+单核细胞</code>、<code>CD4+初始</code>、<code>CD4+ TCM</code>、<code>CD4+ TEM</code>、<code>CD8+初始</code>、<code>CD8+ TEM 1</code>、<code>CD8+ TEM 2</code>、<code>HSPCs</code>、<code>中间B细胞</code>、<code>MAIT</code>、<code>记忆B细胞</code>、<code>NK</code>、<code>初始B细胞</code>、<code>浆细胞</code>、<code>Treg</code>、<code>cDC</code>、<code>gdT</code>和<code>pDC</code>）。</p>
<h4 id="bmmc"><a class="markdownIt-Anchor" href="#bmmc"></a> BMMC</h4>
<p><code>BMMC</code>数据集包含通过<code>CITE-seq</code>协议<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mrow></mrow><mrow><mo stretchy="false">[</mo><mn>45</mn><mo stretchy="false">]</mo></mrow></msup></mrow><annotation encoding="application/x-tex">^{[45]}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8879999999999999em;vertical-align:0em;"></span><span class="mord"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">[</span><span class="mord mtight">4</span><span class="mord mtight">5</span><span class="mclose mtight">]</span></span></span></span></span></span></span></span></span></span></span></span>测序的<code>BMMCs</code>配对单细胞RNA和蛋白质丰度测量。这些细胞来自<code>12</code>位健康人类供体，在该数据集中构成<code>12</code>个批次。处理后的数据代表<code>90,261</code>个细胞，包含来自<code>13,953</code>个基因和<code>134</code>个表面蛋白的测量。注释包含<code>45</code>个详细的免疫细胞亚型。</p>
<h4 id="asap-pbmc"><a class="markdownIt-Anchor" href="#asap-pbmc"></a> ASAP PBMC</h4>
<p><code>ASAP PBMC</code>数据集包含四个测序批次，具有三种数据模态（基因表达、染色质可及性和蛋白质丰度）<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mrow></mrow><mrow><mo stretchy="false">[</mo><mn>46</mn><mo stretchy="false">]</mo></mrow></msup></mrow><annotation encoding="application/x-tex">^{[46]}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8879999999999999em;vertical-align:0em;"></span><span class="mord"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">[</span><span class="mord mtight">4</span><span class="mord mtight">6</span><span class="mclose mtight">]</span></span></span></span></span></span></span></span></span></span></span></span>。四个批次分别包含<code>5,023</code>、<code>3,666</code>、<code>3,517</code>和<code>4,849</code>个细胞。在批次1和2中，所有样本都有来自<code>CITE-seq</code>的<code>4,768</code>个基因和<code>216</code>个蛋白质测量。在批次3和4中，所有样本都有<code>17,742</code>个区域和来自<code>ASAP-seq</code>的相同<code>216</code>个蛋白质测量。注释<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mrow></mrow><mrow><mo stretchy="false">[</mo><mn>46</mn><mo stretchy="false">]</mo></mrow></msup></mrow><annotation encoding="application/x-tex">^{[46]}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8879999999999999em;vertical-align:0em;"></span><span class="mord"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">[</span><span class="mord mtight">4</span><span class="mord mtight">6</span><span class="mclose mtight">]</span></span></span></span></span></span></span></span></span></span></span></span>包含四个细胞群（<code>B细胞</code>、<code>髓样细胞</code>、<code>NK细胞</code>和<code>T细胞</code>）。</p>
<h4 id="lung-kim"><a class="markdownIt-Anchor" href="#lung-kim"></a> Lung-Kim</h4>
<p>该数据集包括<code>14</code>个<a target="_blank" rel="noopener" href="https://www.weizmann.ac.il/sites/3CA/lung">原发性人类肺腺癌样本</a>，总共<code>32,493</code>个细胞。该数据集可通过策展癌症细胞图谱公开访问。对于我们的研究，我们将其分为十个样本的参考集和四个样本的查询集。最初，该数据集包括<code>11</code>个细胞群：<code>B细胞</code>、<code>树突状细胞</code>、<code>内皮细胞</code>、<code>上皮细胞</code>、<code>成纤维细胞</code>、<code>巨噬细胞</code>、<code>恶性细胞</code>、<code>肥大细胞</code>、<code>NK细胞</code>、<code>T细胞</code>和一个未确定类别。在预处理中，我们移除了未确定类别并选择了<code>3,000</code>个<code>HVGs</code>用于下游评估。最终数据集包含<code>30,472</code>个细胞。对于参考映射评估，我们随机选择了十个患者样本作为参考数据集，另外四个患者样本作为查询数据集。最终的参考数据集包含<code>24,746</code>个细胞，查询数据集包含<code>7,747</code>个细胞。</p>
<h3 id="基准测试实验设置"><a class="markdownIt-Anchor" href="#基准测试实验设置"></a> 基准测试实验设置</h3>
<h4 id="单细胞rna测序细胞类型注释"><a class="markdownIt-Anchor" href="#单细胞rna测序细胞类型注释"></a> 单细胞RNA测序细胞类型注释</h4>
<p>我们在骨髓、多发性硬化症和人类胰腺数据集上，将<code>scGPT</code>与两种最新的基于<code>transformer</code>的细胞类型注释方法（<code>scBERT</code>和<code>TOSICA</code>）进行了基准测试对比。对于每个数据集，如前文所述，我们使用参考数据划分进行模型训练和验证。对查询集预测的细胞类型标签用于评估。</p>
<p>我们基于四个标准分类指标评估细胞类型分配的性能：<code>准确率</code>、<code>精确率</code>、<code>召回率</code>和<code>宏观F1值</code>。<code>准确率</code>、<code>精确率</code>和<code>召回率</code>是针对整体性能进行全局计算，而<code>宏观F1值</code>则是按类别平均以增加稀有细胞类型的权重。我们还报告了按细胞类型&quot;精确率&quot;的归一化混淆矩阵以提供更多细节。</p>
<h4 id="单细胞rna测序扰动"><a class="markdownIt-Anchor" href="#单细胞rna测序扰动"></a> 单细胞RNA测序扰动</h4>
<p>我们将<code>scGPT</code>与最新的扰动预测方法<code>GEARS</code>和线性回归模型进行了比较。线性回归模型将对照细胞的基因表达值和每个基因的扰动状态二进制编码作为输入特征。该模型通过最小化回归误差，使用输入特征的线性组合来估计每个基因的扰动后表达。为确保一致性，我们遵循了Roohani等人在其基准测试中概述的预处理步骤。将<code>25%</code>的扰动划分为测试集，在训练期间保持未见。</p>
<p>虽然<code>GEARS</code>研究报告<code>CPA</code>方法表现次优，我们在实验中证实了这些发现。然而，我们认为这种性能差距主要归因于实验设置的差异。<code>CPA</code>主要设计用于学习适用于未见细胞类型的共享扰动嵌入，这与我们专注于完全未见扰动的目标有所偏离。为确保公平的基准测试，我们将<code>CPA</code>从最终比较中排除。</p>
<p>我们在相同的设置下训练了所有模型并报告评估结果。首先，使用所有基因的总计数对每个细胞的基因表达值进行标准化，并应用对数转换。随后，我们选择了<code>5,000</code>个高变异基因，并将任何最初未考虑的受扰动基因纳入基因集。在实验中，对于所有三个数据集中的单基因扰动，对扰动进行拆分以确保测试扰动在训练中未见过，即训练集中的细胞未经历过任何测试扰动。对于Norman等人数据集中的双基因扰动，训练-测试分割包括三个难度递增的场景：</p>
<ol>
<li>
<p>训练集中两个基因都见过；</p>
</li>
<li>
<p>训练集中一个基因未见过；</p>
</li>
<li>
<p>训练集中两个基因都未见过。</p>
</li>
</ol>
<p>为评估扰动预测的准确性，我们检查了扰动后和对照细胞状态之间的表达变化（&quot;<code>delta</code>&quot;）。我们计算了预测和观察到的数据表达变化之间的皮尔逊相关性，表示为<code>Pearson delta</code>。我们还报告了这些皮尔逊指标在表达差异最大的前20个基因上的结果。因此，我们为差异表达条件提供了额外的评估指标，即差异表达基因上的<code>Pearson delta</code>。此外，我们测试了预测基因表达与真实表达值之间的皮尔逊相关性（<code>Pearson</code>）。在补充说明9中进行的比较分析表明，基于<code>delta</code>的评估比仅与真实表达水平的相关性能更真实地反映模型性能。</p>
<p>对于基于聚类的生物学验证，我们首先从<code>scGPT</code>模型中获取了每个扰动条件的代表性基因表达谱。<code>scGPT</code>从单个样本对照基因表达向量（即大小为<code>1×M</code>基因）预测每个扰动条件的代表性扰动响应，该向量是通过对数据集中所有对照细胞的基因表达取平均值获得的。Norman等人的数据集包含<code>105</code>个独特的受扰动基因，这产生了总共<code>5,565</code>个独特的扰动组合需要预测。</p>
<p>我们将高维预测扰动响应投影到二维<code>UMAP</code>上。我们首先将<code>UMAP</code>图与Norman等人原始论文中发现的功能组进行了比较，其中<code>236</code>个扰动实验是基于真实扰动响应进行聚类，并通过标记基因表达注释其功能角色。我们检查了<code>scGPT</code>预测的<code>UMAP</code>投影与原始论文中发现的功能分组之间的一致性。然后，我们分析了<code>scGPT</code>预测的<code>UMAP</code>中存在的亚聚类。使用<code>0.5</code>的<code>Leiden</code>聚类分辨率，在预测扰动响应的<code>UMAP</code>中识别出<code>54</code>个亚聚类。我们用最频繁出现的受扰动基因作为其主导基因来注释每个聚类。</p>
<p>对于反向扰动预测任务，我们从Norman数据集中选择了<code>20</code>个基因来构建扰动用例，并微调和测试新的扰动模型。这个<code>20</code>个基因的子集是通过最大化基于<code>scGPT</code>训练-测试分割的训练和测试案例的真实扰动数据比例来选择的。该选定子空间在<code>210</code>个独特扰动组合中包含<code>39</code>个训练案例、<code>3</code>个验证案例和<code>7</code>个测试案例。其余为无实验结果的未见案例。</p>
<p>反向扰动预测遵循<code>top-K</code>检索任务设置：我们使用所有<code>210</code>个扰动条件的预测响应作为参考数据，使用七个测试案例的真实响应作为查询集。目标是检索产生最相似响应的顶部扰动条件。对于参考数据，我们从<code>30</code>个随机采样的对照细胞获得预测响应，以增加多样性，而不是每个扰动条件只有一个代表性基因表达谱。这产生了包含<code>6,300</code>个预测后扰动基因表达谱的参考数据库。对于每个<code>X+Y</code>扰动的测试案例，我们使用所有经历过<code>X+Y</code>扰动的细胞的真实基因表达谱作为查询集。</p>
<p>对于<code>top-K</code>检索，我们设计了一个包含两轮选择的集成投票策略。在第一轮中，每个单独的查询细胞通过欧氏距离从参考数据集中选择其最相似的<code>K</code>个表达谱。在第二轮中，我们根据所有查询细胞的投票数对候选扰动条件进行排名。我们报告第二轮集成投票后得票最多的<code>K</code>个扰动条件作为预测的源扰动条件。</p>
<p>我们通过修改后的<code>top-K</code>准确率指标评估检索性能，包括正确检索（即精确匹配）和相关检索（即与实际扰动组合中至少匹配一个基因）。我们报告了<code>scGPT</code>在五次不同随机种子运行的平均分数。我们将<code>scGPT</code>的检索性能与<code>GEARS</code>和差异基因进行了基准对比。对于与<code>GEARS</code>的基准对比，我们使用<code>GEARS</code>预测的表达谱作为参考数据库，并报告相同的<code>top-K</code>检索指标。对于差异基因，我们通过Wilcoxon秩和检验在受扰动细胞和对照细胞之间识别每个测试扰动的前两个差异表达基因。我们将这两个差异表达最显著的基因视为预测的top-1双基因扰动组合。我们仅报告差异表达的top-1检索指标，因为随着差异表达基因列表的扩大，扰动组合变得模糊不清。</p>
<h4 id="单细胞rna测序批次整合"><a class="markdownIt-Anchor" href="#单细胞rna测序批次整合"></a> 单细胞RNA测序批次整合</h4>
<p>在这项工作中，我们将<code>scGPT</code>的性能与其他三种方法进行了比较，即<code>Seurat</code>、<code>Harmony</code>和<code>scVI</code>。评估涵盖了三个整合数据集的批次校正和细胞类型聚类：<code>COVID-19</code>、<code>PBMC 10k</code>和<code>perirhinal cortex</code>（外周皮层）。<code>Harmony</code>和<code>scVI</code>在最近的整合基准测试中被强调为表现最佳的方法。为确保公平比较，所有方法都使用相同数量的<code>1,200</code>个高变异基因（<code>HVGs</code>）作为输入。通过考虑所有基因的总计数对每个细胞的基因表达值进行标准化，随后进行对数转换。训练完成后获得集成的细胞嵌入，用于评估。</p>
<p>对集成的细胞嵌入的评估是使用生物学保守性指标进行的。这些指标包括<code>NMIcell</code>、<code>ARIcell</code>和<code>ASWcell</code>。这些分数用于衡量派生的细胞类型聚类与真实标签之间的一致性。为便于比较，我们还计算了这些指标的平均值，称为<code>AvgBIO</code>。</p>
<p>此外，我们报告了批次校正指标来评估批次混合效果。批次校正性能通过批次聚类的平均轮廓宽度的倒数（表示为<code>ASWbatch</code>）和图连通性度量（表示为<code>GraphConn</code>）来量化。我们计算<code>ASWbatch</code>和<code>GraphConn</code>的平均值作为<code>AvgBATCH</code>，以总结批次混合性能。此外，我们引入了一个总体得分，它是<code>AvgBIO</code>和<code>AvgBATCH</code>的加权和，这与最近的基准研究中采用的方法一致。</p>
<h4 id="单细胞多组学整合-2"><a class="markdownIt-Anchor" href="#单细胞多组学整合-2"></a> 单细胞多组学整合</h4>
<p>我们在两种整合设置（配对和镶嵌）中对<code>scGPT</code>进行了基准测试，与最近的单细胞多组学整合方法<code>Seurat (v.4)</code>、<code>scGLUE</code>和<code>scMoMat</code>进行比较。在配对数据整合实验中，我们首先使用<code>10x Multiome PBMC</code>数据集（包含RNA和<code>ATAC-seq</code>数据）对<code>scGPT</code>与<code>scGLUE</code>和<code>Seurat (v.4)</code>进行了基准比较。所有方法都使用相同的<code>1,200</code>个高变异基因和<code>4,000</code>个高变异峰值作为输入。</p>
<p>我们进一步在<code>BMMC</code>数据集（包含配对的RNA和蛋白质数据）上将<code>scGPT</code>与<code>Seurat (v.4)</code>进行了基准比较。在这种情况下，我们没有对<code>scGLUE</code>进行基准测试，因为该方法并非专门设计用于建模蛋白质数据，这是为了公平比较。同样，使用相同的<code>1,200</code>个高变异基因和所有<code>134</code>个蛋白质作为输入。</p>
<p>在镶嵌数据整合实验中，我们在<code>ASAP PBMC</code>数据集上将<code>scGPT</code>与<code>scMoMat</code>进行了基准比较。总共使用<code>1,200</code>个高变异基因、<code>4,000</code>个高变异峰值和所有<code>216</code>个蛋白质特征作为两种方法的输入。在保持输入特征集一致的同时，我们使用每种方法的自定义预处理流程来标准化表达值。训练完成后获取集成的细胞嵌入用于评估。</p>
<p>在配对和镶嵌数据整合设置的所有三个数据集中，我们使用四个生物学保守性指标来评估细胞嵌入质量：<code>NMIcell</code>、<code>ARIcell</code>、<code>ASWcell</code>和<code>AvgBIO</code>。由于在这三个数据集中，<code>BMMC</code>（配对）和<code>ASAP PBMC</code>（镶嵌）包含多个批次，我们进一步使用三个批次校正指标评估了不同组学批次的混合情况：<code>ASWbatch</code>、<code>GraphConn</code>和<code>AvgBATCH</code>。在镶嵌整合实验中还报告了一个总体得分。</p>
<h4 id="基因调控网络推断-2"><a class="markdownIt-Anchor" href="#基因调控网络推断-2"></a> 基因调控网络推断</h4>
<p>我们对<code>scGPT</code>基因嵌入相似性网络进行了验证，将其与已知的<code>HLA</code>和<code>CD</code>基因网络进行比较。</p>
<p>对于每个网络，我们首先通过筛选具有特定前缀（即<code>HLA-</code>和<code>CD-</code>）的基因名称来定义相关基因集。然后，我们筛选了来自<code>Reactome 2022</code>数据库中免疫系统<code>R-HSA-168256</code>通路中涉及的基因。对于<code>CD</code>基因，我们使用了来自免疫人类数据集的高变异基因的共同基因集，以便于比较预训练和微调模型。</p>
<p>我们从<code>scGPT</code>模型中提取这些选定基因的基因嵌入，并构建了一个k近邻相似性网络。通过选择<code>余弦相似度</code>大于特定阈值的边（即<code>HLA</code>网络为<code>0.5</code>，<code>CD</code>基因网络为<code>0.4</code>），我们突出显示了强连接的子网络。然后，我们将这些子网络与免疫系统中已知的功能群进行了比较。</p>
<p>此外，我们通过通路富集分析验证了由<code>scGPT</code>模型提取的基因程序的质量。我们使用每个基因程序作为输入基因列表，并选择具有统计显著性的通路作为&quot;通路命中&quot;。P值阈值经过<code>Bonferroni</code>校正后设定为<code>0.05</code>（<a target="_blank" rel="noopener" href="https://mathworld.wolfram.com/BonferroniCorrection.html">https://mathworld.wolfram.com/BonferroniCorrection.html</a>），校正基于总测试次数，即基因程序数量乘以通路测试数量。我们报告了在<code>Reactome 2022</code>数据库（<a target="_blank" rel="noopener" href="https://reactome.org/">https://reactome.org/</a>）中的通路命中数。</p>
<p>作为基准，我们将结果与从基线<code>共表达图</code>中提取的基因程序进行了比较。共表达图是通过免疫人类数据集中基因标准化表达的<code>Pearson</code>相关性定义的。为确保与<code>scGPT</code>网络具有相似的模块性，我们将该图稀疏化为k近邻相似性网络（<code>k=15</code>）。按照与<code>scGPT</code>相同的流程，我们通过<code>Leiden</code>聚类从基因集群中识别基因程序。</p>
<p>作为敏感性分析，我们报告了<code>scGPT</code>和共表达方法在不同<code>Leiden</code>分辨率（<code>1</code>、<code>5</code>、<code>10</code>、<code>20</code>、<code>30</code>、<code>40</code>、<code>50</code>和<code>60</code>）下的通路命中情况。我们进一步在<code>Leiden</code>分辨率<code>40</code>下检查了每种方法识别的共同和独特通路，以深入了解性能差异。</p>
<p>我们在<code>ChIP-Atlas</code>数据库中验证了基于<code>scGPT</code>注意力的最受影响基因选择方法，该数据库包含已知转录因子的实验验证基因靶点。我们首先通过将<code>Adamson</code>扰动数据集中的扰动基因列表与<code>ChIP-Atlas</code>交叉检查，选择了两个示例转录因子，它们由<code>DDIT3</code>和<code>BHLHE40</code>编码。对于每个转录因子，我们通过将&quot;差异&quot;设置下注意力选择的前<code>20</code>个最受影响基因与已验证的基因靶点进行比较来进行验证。需要注意的是，在&quot;差异&quot;设置下，前<code>20</code>个基因是基于扰动后变化通过检查扰动注意力图和对照注意力图之间的差异来选择的。</p>
<p>真实的基因靶点列表是通过从<code>ChIP-Atlas</code>中筛选人类基因（<code>hg38</code>）获得的，这些基因的转录起始位点位于转录因子峰值调用区间的<code>10kb</code>距离内。我们报告了注意力选择的前<code>20</code>个基因靶点与真实靶点基因之间的重叠数量。</p>
<p>随后，我们比较了三种最受影响基因选择方法（即对照组、扰动组和差异组）中前<code>100</code>个选定基因之间的重叠情况。这三组前<code>100</code>个基因集合的重叠和差异通过<code>Venn</code>图进行可视化。我们还在<code>Reactome</code>数据库中进一步验证了这些顶部基因与转录因子一起参与的通路。通路命中和基因重叠百分比通过热图进行可视化。</p>
<p>我们进一步验证了功能相关转录因子组的最受影响基因选择分析。我们使用了由<code>Replogle</code>等人确定的两个示例扰动组，这些组分别与<code>mRNA</code>多聚腺苷化和组蛋白乙酰化相关。通过与<code>ChIP-Atlas</code>数据库交叉检验，我们从扰动基因列表中选择了转录因子。因此，我们得到了以下具有功能注释的转录因子基因组：</p>
<ol>
<li>
<p>用于<code>mRNA</code>多聚腺苷化的<code>CPSF2</code>、<code>CPSF3</code>、<code>CPSF4</code>和<code>CSTF3</code>；</p>
</li>
<li>
<p>用于组蛋白乙酰化的<code>KAT8</code>、<code>MCRS1</code>和<code>YEATS4</code>。</p>
</li>
</ol>
<p>需要注意的是，<code>KANSL3</code>和<code>CPSF1</code>也被<code>Replogle</code>等人列入这两个功能组。然而，由于这些基因对应的转录因子在用于构建注意力图的<code>1,200</code>个<code>HVG</code>中有超过十个注释的基因靶点，因此在后续分析中将其排除。</p>
<p>按照之前对单个转录因子的分析方法，我们首先使用&quot;扰动&quot;设置为每个转录因子选择前<code>20</code>个最受影响的基因，并在<code>ChIP-Atlas</code>数据库中验证基因靶点。对于每个功能组，我们随后报告了所有转录因子（连同转录因子本身）的前<code>100</code>个最受影响基因富集的<code>Reactome</code>通路。具体而言，对于<code>mRNA</code>多聚腺苷化，我们从<code>CPSF2</code>、<code>CPSF3</code>、<code>CPSF4</code>和<code>CSTF3</code>的前<code>25</code>个最受影响基因的并集中获得前<code>100</code>个最受影响基因；对于组蛋白乙酰化，则从<code>KAT8</code>、<code>MCRS</code>和<code>YEATS4</code>的前<code>33</code>个最受影响基因的并集中获得。</p>
<p>为了验证，我们将富集的<code>Reactome</code>通路与<code>Replogle</code>等人的功能注释特定术语进行比较。我们还通过文献检索进一步验证了相关通路。如果满足以下两个标准之一，则认为某个术语是相关的：</p>
<ol>
<li>
<p>它包含一个或多个转录因子；</p>
</li>
<li>
<p>其与功能注释的关联得到现有文献支持。</p>
</li>
</ol>
<h3 id="实现细节"><a class="markdownIt-Anchor" href="#实现细节"></a> 实现细节</h3>
<p>预训练的基础模型具有<code>512</code>的嵌入大小，由<code>12</code>个堆叠的转换器块组成，每个块有<code>8</code>个注意力头。全连接层的隐藏层大小为<code>512</code>。在使用<code>3300</code>万个细胞的全人类模型预训练中，我们随机拆分数据，使用<code>99.7%</code>的数据用于训练，<code>0.3%</code>用于验证。对于其他模型（包括器官特异性模型和泛癌症模型）的预训练，我们随机拆分数据，使用<code>97%</code>的数据用于训练，<code>3%</code>用于验证。注意，在预训练中，只有非零表达的基因才会输入到模型中。我们设置最大输入长度为<code>1,200</code>。对于非零基因数量大于最大输入长度的细胞，会在每次迭代时随机采样<code>1,200</code>个输入基因。我们设置要生成的基因比率从<code>0.25</code>、<code>0.50</code>和<code>0.75</code>三个选项中均匀采样。模型使用<code>Adam</code>优化器进行优化，小批量大小为<code>32</code>，初始学习率为<code>0.0001</code>，每个周期后权重衰减<code>0.9</code>。模型总共训练了<code>6</code>个周期。</p>
<p>对于<code>scRNA-seq</code>批次整合、细胞类型注释和扰动预测任务，我们使用了从预训练模型继承的相同模型层配置。在微调过程中，我们以<code>0.0001</code>的学习率开始，每个周期后衰减到<code>90%</code>。对于整合任务，<code>GEP</code>和<code>GEPC</code>的掩码比率设置为<code>0.4</code>，而<code>ECS</code>中的参数<code>β</code>设置为<code>0.6</code>。当与其他损失函数结合时，<code>ECS</code>被赋予权重<code>10</code>。为了将数据集划分为训练集和验证集，我们使用了<code>9:1</code>的比例。模型训练固定持续了<code>15</code>个周期，在每个周期后，在验证集上评估<code>GEP</code>损失值。报告的结果对应于具有最佳验证分数的模型。</p>
<p>对于多组学整合任务，我们加载了预训练模型的基因嵌入，并对任何新的标记（即基因、<code>ATAC</code>峰值或蛋白质）使用相同的<code>512</code>嵌入大小。主模型设置为具有<code>4</code>个堆叠的转换器块，每个块有<code>8</code>个注意力头和<code>512</code>的隐藏层大小。除了预训练的嵌入权重外，所有层都重新初始化。每个数据集以<code>9:1</code>的比例分为训练集和评估集。我们对批次整合使用了<code>1.0</code>的<code>DAR</code>权重。我们使用<code>0.001</code>的初始学习率，每个周期后权重衰减<code>0.95</code>。我们以<code>16</code>的批量大小训练模型固定<code>25</code>个周期，并同样报告了最佳验证模型。</p>
<p>我们使用<code>PyTorch</code>来实现<code>scGPT</code>神经网络模型。<code>Scanpy Python</code>库用于基因表达预处理，包括标准化、对数转换和<code>HVG</code>选择。我们在染色质可及性数据上使用<code>EpiScanpy Python</code>库进行高变异峰值选择。在<code>scRNA-seq</code>批次整合和<code>scMultiomic</code>整合任务中，使用<code>scib.metrics</code>中的实现计算评估指标。在细胞注释任务中，使用<code>scikit-learn</code>包实现评估指标。在<code>GRN</code>推断任务中，使用<code>Scanpy</code>库进行相似性图构建和<code>Leiden</code>聚类。使用<code>GSEApy</code>包实现通路富集分析。其他依赖项包括<code>torchtext 0.14.0</code>、<code>torch-geometric 2.3.0</code>、<code>flash-attn 1.0.1</code>、<code>pandas 1.3.5</code>、<code>cell-gears 0.0.1</code>、<code>umap-learn 0.5.3</code>、<code>leidenalg 0.8.10</code>和<code>wandb 0.12.3</code>。</p>
<h2 id="数据可用性"><a class="markdownIt-Anchor" href="#数据可用性"></a> 数据可用性</h2>
<p>所有使用的数据集来源都已在数据集部分中报告。预训练数据集可以从<code>CELLxGENE</code>普查数据库（<code>2023</code>年<code>5</code>月<code>15</code>日发布版本）获取：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://chanzuckerberg.github.io/cellxgene-census/python-api.html">https://chanzuckerberg.github.io/cellxgene-census/python-api.html</a></li>
<li><a target="_blank" rel="noopener" href="https://cellxgene.cziscience.com/">https://cellxgene.cziscience.com/</a></li>
</ul>
<p>对于注释任务，<code>MS</code>数据集从：<a target="_blank" rel="noopener" href="https://www.ebi.ac.uk/gxa/sc/experiments/E-HCAD-35">https://www.ebi.ac.uk/gxa/sc/experiments/E-HCAD-35</a>获取。髓样细胞数据集可以通过<code>GEO</code>数据库访问号<code>GSE154763</code>公开获取。处理后的人类胰腺数据集从：<a target="_blank" rel="noopener" href="https://github.com/JackieHanLab/TOSICA">https://github.com/JackieHanLab/TOSICA</a> 获取。</p>
<p>对于参考映射，<code>Lung-Kim</code>数据集可通过曲率癌细胞图谱公开获取：<a target="_blank" rel="noopener" href="https://www.weizmann.ac.il/sites/3CA/lung">https://www.weizmann.ac.il/sites/3CA/lung</a>。处理后的<code>COVID-19</code>数据集从：<a target="_blank" rel="noopener" href="https://github.com/theislab/scarches-reproducibility">https://github.com/theislab/scarches-reproducibility</a> 获取。对于扰动预测任务，<code>Norman</code>和<code>Adamson</code>数据集分别从：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://dataverse.harvard.edu/api/access/datafile/6154020">https://dataverse.harvard.edu/api/access/datafile/6154020</a></li>
<li><a target="_blank" rel="noopener" href="https://dataverse.harvard.edu/api/access/datafile/6154417">https://dataverse.harvard.edu/api/access/datafile/6154417</a></li>
</ul>
<p>获取。<code>Replogle</code>数据集从：<a target="_blank" rel="noopener" href="https://gwps.wi.mit.edu/">https://gwps.wi.mit.edu/</a> 获取。</p>
<p>对于批次整合任务，<code>PBMC 10k</code>数据集从<code>scVI tools</code>（ <a target="_blank" rel="noopener" href="https://scvi-tools.org/">https://scvi-tools.org/</a> ）获取，外周皮层数据集从<code>CELLxGENE</code>人类脑细胞图谱1.0版本获取：<a target="_blank" rel="noopener" href="https://cellxgene.cziscience.com/collections/283d65eb-dd53-496d-adb7-7570c7caa443">https://cellxgene.cziscience.com/collections/283d65eb-dd53-496d-adb7-7570c7caa443</a> 。</p>
<p>对于多组学整合任务，<code>10x Multiome PBMC</code>数据集从：<a target="_blank" rel="noopener" href="https://scglue.readthedocs.io/en/latest/data.html">https://scglue.readthedocs.io/en/latest/data.html</a> 获取，<code>BMMC</code>数据集可通过<code>GEO</code>数据库访问号<code>GSE194122</code>获取，<code>ASAP PBMC</code>数据集从：<a target="_blank" rel="noopener" href="https://github.com/PeterZZQ/scMoMaT/tree/main/data/real/ASAP-PBMC">https://github.com/PeterZZQ/scMoMaT/tree/main/data/real/ASAP-PBMC</a> 获取。</p>
<p>对于<code>GRN</code>分析，处理后的免疫人类数据集从：<a target="_blank" rel="noopener" href="https://doi.org/10.6084/m9.figshare.12420968.v8">https://doi.org/10.6084/m9.figshare.12420968.v8</a> 获取。所有处理后的数据集都可以从：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/bowang-lab/scGPT">https://github.com/bowang-lab/scGPT</a></li>
<li><a target="_blank" rel="noopener" href="https://doi.org/10.6084/m9.figshare.24954519.v1">https://doi.org/10.6084/m9.figshare.24954519.v1</a></li>
</ul>
<p>获取。</p>
<h2 id="代码可用性"><a class="markdownIt-Anchor" href="#代码可用性"></a> 代码可用性</h2>
<p><code>scGPT</code>的代码库在<code>GitHub</code>上公开可用（ <a target="_blank" rel="noopener" href="https://github.com/bowang-lab/scGPT">https://github.com/bowang-lab/scGPT</a> ），并在<code>Zenodo</code>存储库（ <a target="_blank" rel="noopener" href="https://doi.org/10.5281/zenodo.10466117">https://doi.org/10.5281/zenodo.10466117</a> ）中提供，采用<code>MIT</code>许可证。</p>
<h1 id="补充信息"><a class="markdownIt-Anchor" href="#补充信息"></a> 补充信息</h1>
<p><code>补充信息1–12</code>，<code>表1–7</code>和<code>图1–13</code>请在这里查看：<a target="_blank" rel="noopener" href="https://static-content.springer.com/esm/art%3A10.1038%2Fs41592-024-02201-0/MediaObjects/41592_2024_2201_MOESM1_ESM.pdf">41592_2024_2201_MOESM1_ESM.pdf</a> 。</p>
<h1 id="参考文献"><a class="markdownIt-Anchor" href="#参考文献"></a> 参考文献</h1>
<ol>
<li>
<p>Silverman, A. D., Karim, A. S. &amp; Jewett, M. C. Cell-free gene expression: an expanded repertoire of applications. Nat. Rev. Genet. 21, 151-170 (2020).</p>
</li>
<li>
<p>Preissl, S., Gaulton, K. J. &amp; Ren, B. Characterizing cis-regulatory elements using single-cell epigenomics. Nat. Rev. Genet. 24, 21-43 (2022).</p>
</li>
<li>
<p>Ding, J., Sharon, N. &amp; Bar-Joseph, Z. Temporal modelling using single-cell transcriptomics. Nat. Rev. Genet. 23, 355-368 (2022).</p>
</li>
<li>
<p>Wagner, D. E. &amp; Klein, A. M. Lineage tracing meets single-cell omics: opportunities and challenges. Nat. Rev. Genet. 21, 410-427 (2020).</p>
</li>
<li>
<p>Regev, A. Science Forum: the Human Cell Atlas. eLife 6, e27041 (2017).</p>
</li>
<li>
<p>Han, X. Mapping the mouse cell atlas by Microwell-seq. Cell 172, 1091-1107 (2018).</p>
</li>
<li>
<p>Angerer, P. et al. Single cells make big data: new challenges and opportunities in transcriptomics. Curr. Opin. Syst. Biol. 4, 85-91 (2017).</p>
</li>
<li>
<p>Subramanian, I., Verma, S., Kumar, S., Jere, A. &amp; Anamika, K. Multi-omics data integration, interpretation, and its application. Bioinform. Biol. Insights 14, 1177932219899051 (2020).</p>
</li>
<li>
<p>Miao, Z., Humphreys, B. D., McMahon, A. P. &amp; Kim, J. Multi-omics integration in the age of million single-cell data. Nat. Rev. Nephrol. 17, 710-724 (2021).</p>
</li>
<li>
<p>Lotfollahi, M., Wolf, F. A. &amp; Theis, F. J. scGen predicts single-cell perturbation responses. Nat. Methods 16, 715-721 (2019).</p>
</li>
<li>
<p>Lotfollahi, M. Predicting cellular responses to complex perturbations in high-throughput screens. Mol. Syst. Biol. 19, e11517 (2023).</p>
</li>
<li>
<p>Lotfollahi, M. Mapping single-cell data to reference atlases by transfer learning. Nat. Biotechnol. 40, 121-130 (2022).</p>
</li>
<li>
<p>Cao, Z.-J. &amp; Gao, G. Multi-omics single-cell data integration and regulatory inference with graph-linked embedding. Nat. Biotechnol. 40, 1458-1466 (2022).</p>
</li>
<li>
<p>Zhang, Z. et al. scMoMat jointly performs single cell mosaic integration and multi-modal bio-marker detection. Nat. Commun. 14, 384 (2023).</p>
</li>
<li>
<p>Bommasani, R. et al. On the opportunities and risks of foundation models. Preprint at <a target="_blank" rel="noopener" href="https://doi.org/10.48550/arXiv.2108.07258">https://doi.org/10.48550/arXiv.2108.07258</a> (2021).</p>
</li>
<li>
<p>Moor, M. et al. Foundation models for generalist medical artificial intelligence. Nature 616, 259-265 (2023).</p>
</li>
<li>
<p>Vaswani, A. et al. Attention is all you need. Adv. Neural Inf. Process. Syst. 6000-6010 (NeurIPS, 2017).</p>
</li>
<li>
<p>Ramesh, A., Dhariwal, P., Nichol, A., Chu, C. &amp; Chen, M. Hierarchical text-conditional image generation with CLIP latents. Preprint at <a target="_blank" rel="noopener" href="https://doi.org/10.48550/arXiv.2204.06125">https://doi.org/10.48550/arXiv.2204.06125</a> (2022).</p>
</li>
<li>
<p>Brown, T. Language models are few-shot learners. Adv. Neural. Inf. Process. Syst. 1877-1901 (NeurIPS, 2020).</p>
</li>
<li>
<p>OpenAI team. GPT-4 technical report. Preprint at <a target="_blank" rel="noopener" href="https://doi.org/10.48550/arXiv.2303.08774">https://doi.org/10.48550/arXiv.2303.08774</a> (2023).</p>
</li>
<li>
<p>Avsec, Z. et al. Effective gene expression prediction from sequence by integrating long-range interactions. Nat. Methods 18, 1196-1203 (2021).</p>
</li>
<li>
<p>Gururangan, S. et al. Don’t stop pretraining: adapt language models to domains and tasks. In Proc. 58th Annual Meeting of the Association for Computational Linguistics 8342-8360 (ACL, 2020).</p>
</li>
<li>
<p>Qiu, X. et al. Pre-trained models for natural language processing: a survey. Sci. China Technol. Sci. 63, 1872-1897 (2020).</p>
</li>
<li>
<p>Liu, J., Fan, Z., Zhao, W. &amp; Zhou, X. Machine intelligence in single-cell data analysis: advances and new challenges. Front. Genet. 12, 655536 (2021).</p>
</li>
<li>
<p>Oller-Moreno, S., Kloiber, K., Machart, P. &amp; Bonn, S. Algorithmic advances in machine learning for single-cell expression analysis. Curr. Opin. Syst. Biol. 25, 27-33 (2021).</p>
</li>
<li>
<p>Ji, Y., Lotfollahi, M., Wolf, F. A. &amp; Theis, F. J. Machine learning for perturbational single-cell omics. Cell Syst. 12, 522-537 (2021).</p>
</li>
<li>
<p>Theodoris, C. V. et al. Transfer learning enables prediction in network biology. Nature 618, 616-624 (2023).</p>
</li>
<li>
<p>McInnes, L., Healy, J. &amp; Melville, J. UMAP: uniform manifold approximation and projection for dimension reduction. Preprint at <a target="_blank" rel="noopener" href="https://doi.org/10.48550/arXiv.1802.03426">https://doi.org/10.48550/arXiv.1802.03426</a> (2018).</p>
</li>
<li>
<p>Schirmer, L. Neuronal vulnerability and multilineage diversity in multiple sclerosis. Nature 573, 75-82 (2019).</p>
</li>
<li>
<p>Cheng, S. A pan-cancer single-cell transcriptional atlas of tumor infiltrating myeloid cells. Cell 184, 792-809 (2021).</p>
</li>
<li>
<p>Chen, J. et al. Transformer for one stop interpretable cell type annotation. Nat. Commun. 14, 223 (2023).</p>
</li>
<li>
<p>Yang, F. et al. scBERT as a large-scale pretrained deep language model for cell type annotation of single-cell RNA-seq data. Nat. Mach. Intell. 4, 852-866 (2022).</p>
</li>
<li>
<p>Adamson, B. A multiplexed single-cell CRISPR screening platform enables systematic dissection of the unfolded protein response. Cell 167, 1867-1882 (2016).</p>
</li>
<li>
<p>Replogle, J. M. Mapping information-rich genotype-phenotype landscapes with genome-scale Perturb-seq. Cell 185, 2559-2575 (2022).</p>
</li>
<li>
<p>Norman, T. M. et al. Exploring genetic interaction manifolds constructed from rich single-cell phenotypes. Science 365, 786-793 (2019).</p>
</li>
<li>
<p>Roohani, Y., Huang, K. &amp; Leskovec, J. Predicting transcriptional outcomes of novel multigene perturbations with GEARS. Nat. Biotechnol. <a target="_blank" rel="noopener" href="https://doi.org/10.1038/s41587-023-01905-6">https://doi.org/10.1038/s41587-023-01905-6</a> (2023).</p>
</li>
<li>
<p>Traag, V. A., Waltman, L. &amp; Van Eck, N. J. From Louvain to Leiden: guaranteeing well-connected communities. Sci. Rep. 9, 5233 (2019).</p>
</li>
<li>
<p>Lopez, R., Regier, J., Cole, M. B., Jordan, M. I. &amp; Yosef, N. Deep generative modeling for single-cell transcriptomics. Nat. Methods 15, 1053-1058 (2018).</p>
</li>
<li>
<p>Satija, R., Farrell, J. A., Gennert, D., Schier, A. F. &amp; Regev, A. Spatial reconstruction of single-cell gene expression data. Nat. Biotechnol. 33, 495-502 (2015).</p>
</li>
<li>
<p>Korsunsky, I. et al. Fast, sensitive and accurate integration of single-cell data with Harmony. Nat. Methods 16, 1289-1296 (2019).</p>
</li>
<li>
<p>Gayoso, A. A Python library for probabilistic analysis of single-cell omics data. Nat. Biotechnol. 40, 163-166 (2022).</p>
</li>
<li>
<p>Siletti, K. Transcriptomic diversity of cell types across the adult human brain. Science 382, eadd7046 (2023).</p>
</li>
<li>
<p>PBMC from a healthy donor, single cell multiome ATAC gene expression demonstration data by Cell Ranger ARC 1.0.0. 10X Genomics <a target="_blank" rel="noopener" href="https://support.10xgenomics.com/single-cell-multiome-atac-gex/datasets/1.0.0/pbmc_granulocyte_sorted_10k">https://support.10xgenomics.com/single-cell-multiome-atac-gex/datasets/1.0.0/pbmc_granulocyte_sorted_10k</a> (2020).</p>
</li>
<li>
<p>Hao, Y. Integrated analysis of multimodal single-cell data. Cell 184, 3573-3587 (2021).</p>
</li>
<li>
<p>Luecken, M. et al. A sandbox for prediction and integration of DNA, RNA, and proteins in single cells. In Proceedings of the Neural Information Processing Systems Track on Datasets and Benchmarks 13 (NeurIPS, 2021).</p>
</li>
<li>
<p>Mimitou, E. P. Scalable, multimodal profiling of chromatin accessibility, gene expression and protein levels in single cells. Nat. Biotechnol. 39, 1246-1258 (2021).</p>
</li>
<li>
<p>Pratapa, A., Jalihal, A. P., Law, J. N., Bharadwaj, A. &amp; Murali, T. M. Benchmarking algorithms for gene regulatory network inference from single-cell transcriptomic data. Nat. Methods 17, 147-154 (2020).</p>
</li>
<li>
<p>Choo, S. Y. The HLA system: genetics, immunology, clinical testing, and clinical implications. Yonsei Med. J. 48, 11-23 (2007).</p>
</li>
<li>
<p>Norman, P. S. Immunobiology: the immune system in health and disease. J. Allergy Clin. Immunol. 96, 274 (1995).</p>
</li>
<li>
<p>Luecken, M. D. Benchmarking atlas-level data integration in single-cell genomics. Nat. Methods 19, 41-50 (2022).</p>
</li>
<li>
<p>Zou, Z., Ohta, T., Miura, F. &amp; Oki, S. ChIP-Atlas 2021 update: a data-mining suite for exploring epigenomic landscapes by fully integrating ChIP-seq, ATAC-seq and Bisulfite-seq data. Nucleic Acids Res. 50, W175-W182 (2022).</p>
</li>
<li>
<p>Yang, H., Niemeijer, M., van de Water, B. &amp; Beltman, J. B. ATF6 is a critical determinant of CHOP dynamics during the unfolded protein response. iScience 23, 100860 (2020).</p>
</li>
<li>
<p>Yoshida, H. et al. ATF6 activated by proteolysis binds in the presence of NF-Y (CBF) directly to the cis-acting element responsible for the mammalian unfolded protein response. Mol. Cell. Biol. 20, 6755-6767 (2000).</p>
</li>
<li>
<p>Kaplan, J. et al. Scaling laws for neural language models. Preprint at <a target="_blank" rel="noopener" href="https://doi.org/10.48550/arXiv.2001.08361">https://doi.org/10.48550/arXiv.2001.08361</a> (2020).</p>
</li>
<li>
<p>Haque, A., Engel, J., Teichmann, S. A. &amp; Lönnberg, T. A practical guide to single-cell RNA-sequencing for biomedical research and clinical applications. Genome Med. 9, 1-12 (2017).</p>
</li>
<li>
<p>Devlin, J., Chang, M. W., Lee, K. &amp; Toutanova, K. BERT: pre-training of deep bidirectional transformers for language understanding. In Proc. 2019 Conference of the North American Chapter of the Association for Computational Linguistics 4171-4186 (ACL, 2019).</p>
</li>
<li>
<p>Dao, T., Fu, D., Ermon, S., Rudra, A. &amp; Ré, C. FlashAttention: fast and memory-efficient exact attention with IO-Awareness. Adv. Neural. Inf. Process. Syst. 16344-16359 (NeurIPS, 2022).</p>
</li>
<li>
<p>Wang, S., Li, B. Z., Khabsa, M., Fang, H. &amp; Ma, H. Linformer: self-attention with linear complexity. Preprint at <a target="_blank" rel="noopener" href="https://doi.org/10.48550/arXiv.2006.04768">https://doi.org/10.48550/arXiv.2006.04768</a> (2020).</p>
</li>
<li>
<p>Katharopoulos, A., Vyas, A., Pappas, N. &amp; Fleuret, F. Transformers are RNNs: fast autoregressive transformers with linear attention. In Proc. 37th International Conference on Machine Learning 5156-5165 (PMLR, 2020).</p>
</li>
<li>
<p>Liu, Y. RoBERTa: a robustly optimized BERT pretraining approach. Preprint at <a target="_blank" rel="noopener" href="https://doi.org/10.48550/arXiv.1907.11692">https://doi.org/10.48550/arXiv.1907.11692</a> (2019).</p>
</li>
<li>
<p>Bubeck, S. et al. Sparks of artificial general intelligence: early experiments with GPT-4. Preprint at <a target="_blank" rel="noopener" href="https://doi.org/10.48550/arXiv.2303.12712">https://doi.org/10.48550/arXiv.2303.12712</a> (2023).</p>
</li>
<li>
<p>Liu, C. et al. Guided similarity separation for image retrieval. Adv. Neural. Inf. Process. Syst. 1556-1566 (NeurIPS, 2019).</p>
</li>
<li>
<p>Eisenstein, M. Single-cell RNA-seq analysis software providers scramble to offer solutions. Nat. Biotechnol. 38, 254-257 (2020).</p>
</li>
<li>
<p>Tran, H. T. N. et al. A benchmark of batch-effect correction methods for single-cell RNA sequencing data. Genome Biol. 21, 12 (2020).</p>
</li>
<li>
<p>Ganin, Y. &amp; Lempitsky, V. Unsupervised domain adaptation by backpropagation. In Proc. 32nd International Conference on Machine Learning 1180-1189 (PMLR, 2015).</p>
</li>
<li>
<p>Cecilia, N. Identification of transcriptional programs using dense vector representations defined by mutual information with GeneVector. Nat. Commun. 14, 4400 (2023).</p>
</li>
<li>
<p>Kim, N. Single-cell RNA sequencing demonstrates the molecular and cellular reprogramming of metastatic lung adenocarcinoma. Nat. Commun. 11, 2285 (2020).</p>
</li>
<li>
<p>Paszke, A. PyTorch: an imperative style, high-performance deep learning library. Adv. Neural Inf. Process. Sys. 1-12 (NeurIPS, 2019).</p>
</li>
<li>
<p>Wolf, F. A., Angerer, P. &amp; Theis, F. J. Scanpy: large-scale single-cell gene expression data analysis. Genome Biol. 19, 15 (2018).</p>
</li>
<li>
<p>Danese, A. et al. EpiScanpy: integrated single-cell epigenomic analysis. Nat. Commun. 12, 5228 (2021).</p>
</li>
<li>
<p>Fang, Z., Liu, X. &amp; Peltz, G. GSEApy: a comprehensive package for performing gene set enrichment analysis in Python. Bioinformatics 39, btac757 (2023).</p>
</li>
<li>
<p>Wang, C. Processed datasets used in the scGPT foundation model. Figshare <a target="_blank" rel="noopener" href="https://doi.org/10.6084/m9.figshare.24954519.v1">https://doi.org/10.6084/m9.figshare.24954519.v1</a> (2024).</p>
</li>
<li>
<p>Cui, H., Wang, C. &amp; Pang, K. Codebase for scGPT: towards building a foundation model for single-cell multi-omics using generative AI. Zenodo <a target="_blank" rel="noopener" href="https://doi.org/10.5281/zenodo.10466117">https://doi.org/10.5281/zenodo.10466117</a> (2024).</p>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      
        <blockquote class="article-copyright">
    <p><strong>本文作者：</strong>LuoYing @ 小小白的笔记屋</p>
    <p><strong>本文链接：</strong><a href="https://luoying.netlify.app/2024/12/16/vazgz0k2/">https://luoying.netlify.app/2024/12/16/vazgz0k2/</a></p>
    <p><strong>本文标题：</strong>scGPT：利用生成式AI构建单细胞多组学基础模型</p>
    
    
    <p><strong>本文版权：</strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener external nofollow noreferrer" target="_blank"><span class="icon-creative-commons"></span>BY-NC-SA</a> 许可协议。转载请注明出处！</p>
    <span class="icon-creative-commons article-copyright-bg"></span>
  </blockquote>
      
      
      
      
      
      
      
      

    </footer>
  </div>
  
  <nav id="article-nav" data-aos="fade-up">
    
      <div class="article-nav-link-wrap article-nav-link-left">
        
          
          
            <img data-src="/covers/文件41.jpg" data-sizes="auto" alt="国产之光DeepSeek，比肩ChatGPT？" class="lazyload">
          
        
        <a href="/2025/01/05/r9y0mne6/"></a>
        <div class="article-nav-caption">前一篇</div>
        <h3 class="article-nav-title">
          
            国产之光DeepSeek，比肩ChatGPT？
          
        </h3>
      </div>
    
    
    <div class="article-nav-link-wrap article-nav-link-right">
      
        
        
          <img data-src="/covers/文件36.jpg" data-sizes="auto" alt="Enformer：通过整合长程相互作用从序列中有效预测基因表达" class="lazyload">
        
      
      <a href="/2024/11/26/906k2592/"></a>
      <div class="article-nav-caption">后一篇</div>
      <h3 class="article-nav-title">
        
          Enformer：通过整合长程相互作用从序列中有效预测基因表达
        
      </h3>
    </div>
    
  </nav>


</article>






</section>
          
        </div>
        <footer id="footer">
  <div style="width: 100%; overflow: hidden">
    <div class="footer-line"></div>
  </div>
  <div id="footer-info">
    
    <div>
      <span class="icon-copyright"></span>
      2020-2025
      <span class="footer-info-sep rotate"></span>
      LuoYing
    </div>
    
      <div>
        基于&nbsp;<a href="https://hexo.io/" rel="noopener external nofollow noreferrer" target="_blank">Hexo</a>&nbsp;
        Theme.<a href="https://github.com/D-Sketon/hexo-theme-reimu" rel="noopener external nofollow noreferrer" target="_blank">Reimu</a>
      </div>
    
    
      <div>
        <span class="icon-brush"></span>
        285.3k
        &nbsp;|&nbsp;
        <span class="icon-coffee"></span>
        18:26
      </div>
    
    
    
    
      <div>
        <span class="icon-eye"></span>
        <span id="busuanzi_container_site_pv">总访问量&nbsp;<span id="busuanzi_value_site_pv"></span></span>
        &nbsp;|&nbsp;
        <span class="icon-user"></span>
        <span id="busuanzi_container_site_uv">总访客量&nbsp;<span id="busuanzi_value_site_uv"></span></span>
      </div>
    
  </div>
</footer>

        
          <div class="sidebar-top">
            <div class="sidebar-top-taichi rotate"></div>
            <div class="arrow-up"></div>
          </div>
        
        <div id="mask" class="hide"></div>
      </div>
      <nav id="mobile-nav">
  <div class="sidebar-wrap">
    
      <div class="sidebar-toc-sidebar"><div class="sidebar-toc">
  <h3 class="toc-title">文章目录</h3>
  <div class="sidebar-toc-wrapper toc-div-class" >
      
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%96%87%E7%AB%A0%E9%93%BE%E6%8E%A5"><span class="toc-number">1.</span> <span class="toc-text"> 文章链接</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-number">2.</span> <span class="toc-text"> 简介</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%91%98%E8%A6%81"><span class="toc-number">3.</span> <span class="toc-text"> 摘要</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%9B%E6%96%B0%E7%82%B9"><span class="toc-number">4.</span> <span class="toc-text"> 创新点</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%BB%E8%A6%81%E5%86%85%E5%AE%B9"><span class="toc-number">5.</span> <span class="toc-text"> 主要内容</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%BB%E5%89%8D%E9%A1%BB%E7%9F%A5"><span class="toc-number">5.1.</span> <span class="toc-text"> 读前须知</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%95%E8%A8%80"><span class="toc-number">5.2.</span> <span class="toc-text"> 引言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E6%9E%9C"><span class="toc-number">5.3.</span> <span class="toc-text"> 结果</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E7%BB%86%E8%83%9E-transformer-%E5%9F%BA%E7%A1%80%E6%A8%A1%E5%9E%8B%E6%A6%82%E8%BF%B0"><span class="toc-number">5.3.1.</span> <span class="toc-text"> 单细胞 transformer 基础模型概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#scgpt%E6%8F%90%E9%AB%98%E7%BB%86%E8%83%9E%E7%B1%BB%E5%9E%8B%E6%B3%A8%E9%87%8A%E7%9A%84%E7%B2%BE%E7%A1%AE%E5%BA%A6"><span class="toc-number">5.3.2.</span> <span class="toc-text"> scGPT提高细胞类型注释的精确度</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#scgpt%E9%A2%84%E6%B5%8B%E6%9C%AA%E8%A7%81%E8%BF%87%E7%9A%84%E5%9F%BA%E5%9B%A0%E6%89%B0%E5%8A%A8%E5%93%8D%E5%BA%94"><span class="toc-number">5.3.3.</span> <span class="toc-text"> scGPT预测未见过的基因扰动响应</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%AA%E8%A7%81%E8%BF%87%E7%9A%84%E5%9F%BA%E5%9B%A0%E6%89%B0%E5%8A%A8%E9%A2%84%E6%B5%8B"><span class="toc-number">5.3.3.1.</span> <span class="toc-text"> 未见过的基因扰动预测</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%93%E5%A4%96%E9%80%86%E5%90%91%E6%89%B0%E5%8A%A8%E9%A2%84%E6%B5%8B"><span class="toc-number">5.3.3.2.</span> <span class="toc-text"> 体外逆向扰动预测</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#scgpt%E5%AE%9E%E7%8E%B0%E5%A4%9A%E6%89%B9%E6%AC%A1%E5%92%8C%E5%A4%9A%E7%BB%84%E5%AD%A6%E6%95%B4%E5%90%88"><span class="toc-number">5.3.4.</span> <span class="toc-text"> scGPT实现多批次和多组学整合</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E6%89%B9%E6%AC%A1scrna-seq%E6%95%B4%E5%90%88"><span class="toc-number">5.3.4.1.</span> <span class="toc-text"> 多批次scRNA-seq整合</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E7%BB%86%E8%83%9E%E5%A4%9A%E7%BB%84%E5%AD%A6%E6%95%B4%E5%90%88"><span class="toc-number">5.3.4.2.</span> <span class="toc-text"> 单细胞多组学整合</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#scgpt%E6%8F%AD%E7%A4%BA%E7%89%B9%E5%AE%9A%E7%BB%86%E8%83%9E%E7%8A%B6%E6%80%81%E7%9A%84%E5%9F%BA%E5%9B%A0%E7%BD%91%E7%BB%9C"><span class="toc-number">5.3.5.</span> <span class="toc-text"> scGPT揭示特定细胞状态的基因网络</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%81%E7%A7%BB%E5%AD%A6%E4%B9%A0%E4%B8%AD%E7%9A%84%E8%A7%84%E6%A8%A1%E5%92%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E6%95%88%E5%BA%94"><span class="toc-number">5.3.6.</span> <span class="toc-text"> 迁移学习中的规模和上下文效应</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%A8%E8%AE%BA"><span class="toc-number">5.4.</span> <span class="toc-text"> 讨论</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%A8%E7%BA%BF%E5%86%85%E5%AE%B9"><span class="toc-number">5.5.</span> <span class="toc-text"> 在线内容</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B9%E6%B3%95"><span class="toc-number">5.6.</span> <span class="toc-text"> 方法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BE%93%E5%85%A5%E5%B5%8C%E5%85%A5"><span class="toc-number">5.6.1.</span> <span class="toc-text"> 输入嵌入</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E5%9B%A0%E6%A0%87%E8%AE%B0"><span class="toc-number">5.6.1.1.</span> <span class="toc-text"> 基因标记</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A1%A8%E8%BE%BE%E5%80%BC"><span class="toc-number">5.6.1.2.</span> <span class="toc-text"> 表达值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E6%A0%87%E8%AE%B0"><span class="toc-number">5.6.1.3.</span> <span class="toc-text"> 条件标记</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B5%8C%E5%85%A5%E5%B1%82"><span class="toc-number">5.6.1.4.</span> <span class="toc-text"> 嵌入层</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%86%E8%83%9E%E5%92%8C%E5%9F%BA%E5%9B%A0%E8%A1%A8%E8%BE%BE%E5%BB%BA%E6%A8%A1%E7%9A%84transformer"><span class="toc-number">5.6.2.</span> <span class="toc-text"> 细胞和基因表达建模的transformer</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#scgpt-transformer"><span class="toc-number">5.6.2.1.</span> <span class="toc-text"> scGPT transformer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%86%E8%83%9E%E8%A1%A8%E7%A4%BA"><span class="toc-number">5.6.2.2.</span> <span class="toc-text"> 细胞表示</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%B9%E6%AC%A1%E5%92%8C%E6%A8%A1%E6%80%81%E7%9A%84%E8%A1%A8%E7%A4%BA"><span class="toc-number">5.6.2.3.</span> <span class="toc-text"> 批次和模态的表示</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E5%BC%8F%E9%A2%84%E8%AE%AD%E7%BB%83"><span class="toc-number">5.6.3.</span> <span class="toc-text"> 生成式预训练</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E6%A8%A1%E5%9E%8B%E9%A2%84%E8%AE%AD%E7%BB%83"><span class="toc-number">5.6.3.1.</span> <span class="toc-text"> 基础模型预训练</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%A8%E4%BA%8E%E7%94%9F%E6%88%90%E5%BC%8F%E9%A2%84%E8%AE%AD%E7%BB%83%E7%9A%84%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%8E%A9%E7%A0%81"><span class="toc-number">5.6.3.2.</span> <span class="toc-text"> 用于生成式预训练的注意力掩码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%A6%E4%B9%A0%E7%9B%AE%E6%A0%87%E5%92%8C%E9%A2%84%E8%AE%AD%E7%BB%83"><span class="toc-number">5.6.3.3.</span> <span class="toc-text"> 学习目标和预训练</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%AE%E8%B0%83%E7%9B%AE%E6%A0%87"><span class="toc-number">5.6.4.</span> <span class="toc-text"> 微调目标</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E5%9B%A0%E8%A1%A8%E8%BE%BE%E9%A2%84%E6%B5%8B"><span class="toc-number">5.6.4.1.</span> <span class="toc-text"> 基因表达预测</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%A8%E4%BA%8E%E7%BB%86%E8%83%9E%E5%BB%BA%E6%A8%A1%E7%9A%84%E5%9F%BA%E5%9B%A0%E8%A1%A8%E8%BE%BE%E9%A2%84%E6%B5%8B"><span class="toc-number">5.6.4.2.</span> <span class="toc-text"> 用于细胞建模的基因表达预测</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%B9%E6%80%A7%E7%BB%86%E8%83%9E%E7%9B%B8%E4%BC%BC%E5%BA%A6"><span class="toc-number">5.6.4.3.</span> <span class="toc-text"> 弹性细胞相似度</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E5%8F%8D%E5%90%91%E5%8F%8D%E5%90%91%E4%BC%A0%E6%92%AD%E8%BF%9B%E8%A1%8C%E5%9F%9F%E9%80%82%E5%BA%94"><span class="toc-number">5.6.4.4.</span> <span class="toc-text"> 通过反向反向传播进行域适应</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%86%E8%83%9E%E7%B1%BB%E5%9E%8B%E5%88%86%E7%B1%BB"><span class="toc-number">5.6.4.5.</span> <span class="toc-text"> 细胞类型分类</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8B%E6%B8%B8%E4%BB%BB%E5%8A%A1%E7%9A%84%E5%BE%AE%E8%B0%83"><span class="toc-number">5.6.5.</span> <span class="toc-text"> 下游任务的微调</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%86%E8%83%9E%E7%B1%BB%E5%9E%8B%E6%B3%A8%E9%87%8A"><span class="toc-number">5.6.5.1.</span> <span class="toc-text"> 细胞类型注释</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E5%9B%A0%E6%89%B0%E5%8A%A8%E5%93%8D%E5%BA%94%E9%A2%84%E6%B5%8B"><span class="toc-number">5.6.5.2.</span> <span class="toc-text"> 基因扰动响应预测</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B4%E5%90%88%E5%A4%9A%E4%B8%AAscrna-seq%E6%95%B0%E6%8D%AE%E9%9B%86%E7%9A%84%E6%89%B9%E6%AC%A1%E6%A0%A1%E6%AD%A3"><span class="toc-number">5.6.5.3.</span> <span class="toc-text"> 整合多个scRNA-seq数据集的批次校正</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#scmultiomic%E6%95%B0%E6%8D%AE%E7%9A%84%E6%95%B4%E5%90%88%E8%A1%A8%E7%A4%BA%E5%AD%A6%E4%B9%A0"><span class="toc-number">5.6.5.4.</span> <span class="toc-text"> scMultiomic数据的整合表示学习</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E5%9B%A0%E8%B0%83%E6%8E%A7%E7%BD%91%E7%BB%9C%E6%8E%A8%E6%96%AD"><span class="toc-number">5.6.5.5.</span> <span class="toc-text"> 基因调控网络推断</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E9%9B%86"><span class="toc-number">5.6.6.</span> <span class="toc-text"> 数据集</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#cellxgene-scrna-seq%E9%9B%86%E5%90%88"><span class="toc-number">5.6.6.1.</span> <span class="toc-text"> CELLxGENE scRNA-seq集合</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E5%8F%91%E6%80%A7%E7%A1%AC%E5%8C%96%E7%97%87"><span class="toc-number">5.6.6.2.</span> <span class="toc-text"> 多发性硬化症</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%AA%A8%E9%AB%93%E6%A0%B7%E7%BB%86%E8%83%9E"><span class="toc-number">5.6.6.3.</span> <span class="toc-text"> 骨髓样细胞</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%BA%E8%83%B0%E8%85%BA"><span class="toc-number">5.6.6.4.</span> <span class="toc-text"> 人胰腺</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pbmc-10k"><span class="toc-number">5.6.6.5.</span> <span class="toc-text"> PBMC 10k</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%BA%E7%B1%BB%E5%85%8D%E7%96%AB"><span class="toc-number">5.6.6.6.</span> <span class="toc-text"> 人类免疫</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%91%E5%97%85%E7%9A%AE%E5%B1%82perirhinal-cortex"><span class="toc-number">5.6.6.7.</span> <span class="toc-text"> 近嗅皮层（Perirhinal cortex）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#covid-19"><span class="toc-number">5.6.6.8.</span> <span class="toc-text"> COVID-19</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#adamson"><span class="toc-number">5.6.6.9.</span> <span class="toc-text"> Adamson</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#norman"><span class="toc-number">5.6.6.10.</span> <span class="toc-text"> Norman</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#replogle"><span class="toc-number">5.6.6.11.</span> <span class="toc-text"> Replogle</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#multiome-pbmc"><span class="toc-number">5.6.6.12.</span> <span class="toc-text"> Multiome PBMC</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#bmmc"><span class="toc-number">5.6.6.13.</span> <span class="toc-text"> BMMC</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#asap-pbmc"><span class="toc-number">5.6.6.14.</span> <span class="toc-text"> ASAP PBMC</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#lung-kim"><span class="toc-number">5.6.6.15.</span> <span class="toc-text"> Lung-Kim</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E5%87%86%E6%B5%8B%E8%AF%95%E5%AE%9E%E9%AA%8C%E8%AE%BE%E7%BD%AE"><span class="toc-number">5.6.7.</span> <span class="toc-text"> 基准测试实验设置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E7%BB%86%E8%83%9Erna%E6%B5%8B%E5%BA%8F%E7%BB%86%E8%83%9E%E7%B1%BB%E5%9E%8B%E6%B3%A8%E9%87%8A"><span class="toc-number">5.6.7.1.</span> <span class="toc-text"> 单细胞RNA测序细胞类型注释</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E7%BB%86%E8%83%9Erna%E6%B5%8B%E5%BA%8F%E6%89%B0%E5%8A%A8"><span class="toc-number">5.6.7.2.</span> <span class="toc-text"> 单细胞RNA测序扰动</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E7%BB%86%E8%83%9Erna%E6%B5%8B%E5%BA%8F%E6%89%B9%E6%AC%A1%E6%95%B4%E5%90%88"><span class="toc-number">5.6.7.3.</span> <span class="toc-text"> 单细胞RNA测序批次整合</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E7%BB%86%E8%83%9E%E5%A4%9A%E7%BB%84%E5%AD%A6%E6%95%B4%E5%90%88-2"><span class="toc-number">5.6.7.4.</span> <span class="toc-text"> 单细胞多组学整合</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E5%9B%A0%E8%B0%83%E6%8E%A7%E7%BD%91%E7%BB%9C%E6%8E%A8%E6%96%AD-2"><span class="toc-number">5.6.7.5.</span> <span class="toc-text"> 基因调控网络推断</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E7%BB%86%E8%8A%82"><span class="toc-number">5.6.8.</span> <span class="toc-text"> 实现细节</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%8F%AF%E7%94%A8%E6%80%A7"><span class="toc-number">5.7.</span> <span class="toc-text"> 数据可用性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%8F%AF%E7%94%A8%E6%80%A7"><span class="toc-number">5.8.</span> <span class="toc-text"> 代码可用性</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%A1%A5%E5%85%85%E4%BF%A1%E6%81%AF"><span class="toc-number">6.</span> <span class="toc-text"> 补充信息</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE"><span class="toc-number">7.</span> <span class="toc-text"> 参考文献</span></a></li></ol>
      
  </div>
</div>
</div>
      <div class="sidebar-common-sidebar hidden"><div class="sidebar-author">
  <img data-src="/avatar/avatar.webp" data-sizes="auto" alt="LuoYing" class="lazyload">
  <div class="sidebar-author-name">LuoYing</div>
  <div class="sidebar-description">一方小筑，与君共勉</div>
</div>
<div class="sidebar-state">
  <div class="sidebar-state-article">
    <div>文章</div>
    <div class="sidebar-state-number">119</div>
  </div>
  <div class="sidebar-state-category">
    <div>分类</div>
    <div class="sidebar-state-number">15</div>
  </div>
  <div class="sidebar-state-tag">
    <div>标签</div>
    <div class="sidebar-state-number">2</div>
  </div>
</div>
<div class="sidebar-social">
  
</div>
<div class="sidebar-menu">
  
    
      <div class="sidebar-menu-link-wrap">
        <a class="sidebar-menu-link-dummy" href="/" aria-label="首页"></a>
        <div class="sidebar-menu-icon icon rotate">
          &#xe62b;
        </div>
        <div class="sidebar-menu-link">首页</div>
      </div>
    
      <div class="sidebar-menu-link-wrap">
        <a class="sidebar-menu-link-dummy" href="/archives" aria-label="归档"></a>
        <div class="sidebar-menu-icon icon rotate">
          &#xe62b;
        </div>
        <div class="sidebar-menu-link">归档</div>
      </div>
    
      <div class="sidebar-menu-link-wrap">
        <a class="sidebar-menu-link-dummy" href="/about" aria-label="关于"></a>
        <div class="sidebar-menu-icon icon rotate">
          &#xe62b;
        </div>
        <div class="sidebar-menu-link">关于</div>
      </div>
    
      <div class="sidebar-menu-link-wrap">
        <a class="sidebar-menu-link-dummy" href="/friend" aria-label="友链"></a>
        <div class="sidebar-menu-icon icon rotate">
          &#xe62b;
        </div>
        <div class="sidebar-menu-link">友链</div>
      </div>
    
  
</div>
</div>
    
  </div>
  
    <div class="sidebar-btn-wrapper">
      <div class="sidebar-toc-btn current"></div>
      <div class="sidebar-common-btn"></div>
    </div>
  
</nav>

    </div>
    
      <div class="site-search">
        <div class="reimu-popup popup">
          <div class="reimu-search">
            <div class="reimu-search-input-icon"></div>
            <div class="reimu-search-input" id="reimu-search-input"></div>
            <div class="popup-btn-close"></div>
          </div>
          <div class="reimu-results">
            <div id="reimu-stats"></div>
            <div id="reimu-hits"></div>
            <div id="reimu-pagination" class="reimu-pagination"></div>
          </div>
          <img class="reimu-bg" src="/images/reimu.png"/>
        </div>
      </div>
    
    
<script src="https://npm.webcache.cn/lazysizes@5.3.2/lazysizes.min.js" integrity="sha384-3gT&#x2F;vsepWkfz&#x2F;ff7PpWNUeMzeWoH3cDhm&#x2F;A8jM7ouoAK0&#x2F;fP&#x2F;9bcHHR5kHq2nf+e" crossorigin="anonymous"></script>


<script src="https://npm.webcache.cn/clipboard@2.0.11/dist/clipboard.min.js" integrity="sha384-J08i8An&#x2F;QeARD9ExYpvphB8BsyOj3Gh2TSh1aLINKO3L0cMSH2dN3E22zFoXEi0Q" crossorigin="anonymous"></script>



<script src="/js/script.js"></script>



  
<script src="/js/aos.js"></script>

  <script>
    var aosInit = () => {
      AOS.init({
        duration: 1000,
        easing: "ease",
        once: true,
        offset: 50,
      });
    };
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', aosInit);
    } else {
      aosInit();
    }
  </script>



<script src="/js/pjax_script.js" data-pjax></script>



  
<script src="/js/generator_search.js" defer></script>






  
<script src="https://npm.webcache.cn/mouse-firework@0.0.6/dist/index.umd.js" integrity="sha384-vkGvf25gm1C1PbcoD5dNfc137HzNL&#x2F;hr1RKA5HniJOaawtvUmH5lTVFgFAruE9Ge" crossorigin="anonymous"></script>

  <script>
    window.firework && window.firework(JSON.parse('{"excludeElements":["a","button"],"particles":[{"shape":"circle","move":["emit"],"easing":"easeOutExpo","colors":["#ff5252","#ff7c7c","#ffafaf","#ffd0d0"],"number":20,"duration":[1200,1800],"shapeOptions":{"radius":[16,32],"alpha":[0.3,0.5]}},{"shape":"circle","move":["diffuse"],"easing":"easeOutExpo","colors":["#ff0000"],"number":1,"duration":[1200,1800],"shapeOptions":{"radius":20,"alpha":[0.2,0.5],"lineWidth":6}}]}'))
  </script>








<div id="lazy-script">
  <div>
    
    
      
        
<script src="/js/insert_highlight.js" data-pjax></script>

      
    
    
      <script type="module" data-pjax>
        const PhotoSwipeLightbox = (await safeImport("https://npm.webcache.cn/photoswipe@5.4.4/dist/photoswipe-lightbox.esm.min.js", "sha384-DiL6M/gG+wmTxmCRZyD1zee6lIhawn5TGvED0FOh7fXcN9B0aZ9dexSF/N6lrZi/")).default;
        
        const pswp = () => {
          if (_$$('.article-entry a.article-gallery-item').length > 0) {
            new PhotoSwipeLightbox({
              gallery: '.article-entry',
              children: 'a.article-gallery-item',
              pswpModule: () => safeImport("https://npm.webcache.cn/photoswipe@5.4.4/dist/photoswipe.esm.min.js", "sha384-WkkO3GCmgkC3VQWpaV8DqhKJqpzpF9JoByxDmnV8+oTJ7m3DfYEWX1fu1scuS4+s")
            }).init();
          }
          if(_$$('.article-gallery a.article-gallery-item').length > 0) {
            new PhotoSwipeLightbox({
              gallery: '.article-gallery',
              children: 'a.article-gallery-item',
              pswpModule: () => safeImport("https://npm.webcache.cn/photoswipe@5.4.4/dist/photoswipe.esm.min.js", "sha384-WkkO3GCmgkC3VQWpaV8DqhKJqpzpF9JoByxDmnV8+oTJ7m3DfYEWX1fu1scuS4+s")
            }).init();
          }
          window.lightboxStatus = 'done';
          window.removeEventListener('lightbox:ready', pswp);
        }
        if(window.lightboxStatus === 'ready') {
          pswp()
        } else {
          window.addEventListener('lightbox:ready', pswp);
        }
      </script>
      








    
  </div>
</div>


  <script>
    console.log(String.raw`%c 
 ______     ______     __     __    __     __  __    
/\  == \   /\  ___\   /\ \   /\ "-./  \   /\ \/\ \   
\ \  __<   \ \  __\   \ \ \  \ \ \-./\ \  \ \ \_\ \  
 \ \_\ \_\  \ \_____\  \ \_\  \ \_\ \ \_\  \ \_____\ 
  \/_/ /_/   \/_____/   \/_/   \/_/  \/_/   \/_____/ 
                                                  
`,'color: #ff5252;')
    console.log('%c Theme.Reimu v' + '1.1.0' + ' %c https://github.com/D-Sketon/hexo-theme-reimu ', 'color: white; background: #ff5252; padding:5px 0;', 'padding:4px;border:1px solid #ff5252;')
  </script>
  

<script data-pjax>
  var updateTime = _$('#post-update-time')?.innerHTML;

  if (updateTime) {
    const update = new Date(updateTime);
    const now = new Date();
    const diff = now - update;
    const days = diff / 86400000;
    const { daysAgo, message: template } = window.REIMU_CONFIG.outdate;
    if (days >= daysAgo) {
      const message = template.replace(/{time}/, updateTime);
      const blockquote = _$('#outdate-blockquote');
      if (blockquote) {
        blockquote.querySelector('p').innerText = message;
        blockquote.style.display = 'block';
      }
    }
  }
</script>


  
<script src="https://npm.webcache.cn/busuanzi@2.3.0/bsz.pure.mini.js" integrity="sha384-0M75wtSkhjIInv4coYlaJU83+OypaRCIq2SukQVQX04eGTCBXJDuWAbJet56id+S" crossorigin="anonymous" async></script>




<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.getRegistrations().then((registrations) => {
      for (let registration of registrations) {
        registration.unregister();
      }
    });
  }
</script>



  


  </body>
  </html>

